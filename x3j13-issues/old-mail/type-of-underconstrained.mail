*start*01381 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 21 SEP 88 02:49:16 PDTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 21 Sep 88  02:49:00 PDTReceived: from Cabernet.ms by ArpaGateway.ms ; 21 SEP 88 02:47:39 PDTDate: 21 Sep 88 02:47 PDTFrom: masinter.paSubject: Issue: TYPE-OF-UNDERCONSTRAINEDIn-reply-to: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>'s message of Tue, 13 Sep 88 10:22 EDTTo: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>cc: cl-cleanup@SAIL.STANFORD.EDUMessage-ID: <880921-024739-5696@Xerox>This is in response to mail under COERCE-FROM-TYPE and TYPE-OF. I would preferto constrain TYPE-OF to be at least as specific as (CLASS-NAME (CLASS-OF x)). I'm less sure what to do about instances of unnamed classes; the Medley waywould be to return the class itself for an otherwise nameless class. This would disallow what is otherwise "legal" now: namely to have TYPE-OF returnT for everything but structure instances. I think it probably is reasonable also to constrain TYPE-OF to be something thatSUBTYPEP can deal with. (cf SUBTYPEP-TOO-VAGUE). If I don't here any objections, I'll try to write this up when I get back thatfar in the alphabet.Meanwhile, I'll make a pass on COERCE-INCOMPLETE.*start*01725 00024 USaReturn-Path: <Moon@STONY-BROOK.SCRC.Symbolics.COM>Received: from STONY-BROOK.SCRC.Symbolics.COM ([128.81.41.144]) by Xerox.COM ; 28 SEP 88 10:59:49 PDTReceived: from EUPHRATES.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 467081; Wed 28-Sep-88 14:00:01 EDTDate: Wed, 28 Sep 88 13:59 EDTFrom: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: TYPE-OF-UNDERCONSTRAINEDTo: masinter.pacc: cl-cleanup@SAIL.STANFORD.EDUIn-Reply-To: <880921-024739-5696@Xerox>Message-ID: <19880928175947.6.MOON@EUPHRATES.SCRC.Symbolics.COM>Line-fold: No    Date: 21 Sep 88 02:47 PDT    From: masinter.pa@Xerox.COM    This is in response to mail under COERCE-FROM-TYPE and TYPE-OF. I would prefer    to constrain TYPE-OF to be at least as specific as (CLASS-NAME (CLASS-OF x)). That seems like a reasonable idea.    I'm less sure what to do about instances of unnamed classes; the Medley way    would be to return the class itself for an otherwise nameless class. TYPE-OF could return NIL in that case, which is a subtype of everything (ha ha).Since CLOS says class objects are acceptable wherever type specifiers are,I think the Medley way is okay.    This would disallow what is otherwise "legal" now: namely to have TYPE-OF return    T for everything but structure instances.     I think it probably is reasonable also to constrain TYPE-OF to be something that    SUBTYPEP can deal with. (cf SUBTYPEP-TOO-VAGUE). I'm less sure of this, since I can't figure out if there are any ramifications.It's not worth putting a lot of effort into TYPE-OF, since if you want somethingwell-defined you definitely use CLASS-OF rather than TYPE-OF.*start*03991 00024 USfReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 01 DEC 88 16:38:30 PSTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 1 Dec 88  16:34:05 PSTReceived: from Semillon.ms by ArpaGateway.ms ; 01 DEC 88 16:27:03 PSTDate: 1 Dec 88 16:26 PSTFrom: masinter.paSubject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 1)To: cl-cleanup@SAIL.STANFORD.EDUMessage-ID: <881201-162703-5359@Xerox>I never wrote this up, even though it seems to be required in some of theCOERCE discussions.Should TYPE-OF be required to be more specific on condition subtypes?!Forum:	CleanupIssue:         TYPE-OF-UNDERCONSTRAINEDReferences:    TYPE-OF (CLtL)			88-002R (Class-of)			88-005, p 43f, Condition system typesRelated issues: SUBTYPEP-TOO-VAGUE		DATA-TYPE-HIERARCHY-UNDERSPECIFIED		FUNCTION-TYPE			Category:      CLARIFICATION/CHANGEEdit history:  Version 1,  1-Dec-88, MasinterProblem description:The specification of TYPE-OF in CLtL is so weak as to leave it useless forportable applications, outside of structures. In particular, there are noconstraints on the value that TYPE-OF might return for any of the built intypes. The only constraint placed is that for objects created by theconstructor function of DEFSTRUCT, the result of TYPE-OF is the name of thedefstruct.This means that implementations could return T for all other objects.Proposal (TYPE-OF-UNDERCONSTRAINED:ADD-CONSTRAINTS): Specify that the result of TYPE-OF must be at least as specific as follows:For any object for which (typep object built-in-type) is true whenbuilt-in-type is one of INTEGER, RATIO, FLOAT, SINGLE-FLOAT, DOUBLE-FLOAT, COMPLEX, NUMBERSYMBOL, STRING, VECTOR, ARRAY, CONS, STREAM, PACKAGE, CHARACTER, FUNCTION, READTABLE, HASH-TABLE, PATHNAMECONDITION, RESTART.the result of TYPE-OF will be a type specifier for which(subtypep (type-of object) built-in-type) returns T T, i.e., either thebuild-in-type or a recognized subtype of it.The result of TYPE-OF must satisfy (TYPEP object (TYPE-OF object)).The result of TYPE-OF must be an acceptable input to SUBTYPEP.The result of TYPE-OF cannot contain be a MEMBER type specifier, or T.For objects which are instances of anonymous classes (i.e., where(CLASS-NAME (CLASS-OF object)) is NIL), the result of TYPE-OF should be theclass object itself.(The CLOS specification has already specified that class objects areacceptable wherever type specifiers are, and in particular, as input toSUBTYPEP and TYPEP.)Examples:It is legal for (TYPE-OF "abc") to return (SIMPLE-STRING 3), or justSTRING. It is legal for (TYPE-OF 112312) to return SI:MEDIUM-SIZE-FIXNUM,as long as (SUBTYPEP 'SI:MEDIUM-SIZE-FIXNUM 'INTEGER).Rationale:The original specification for "TYPE-OF" was written to allowimplementation freedom, but the wording is in fact more vague than wasintended. Current practice:Most Common Lisp implementations seem to implement the proposal, at leastfor the types we've tried them on.Cost to Implementors:Even if there are implementations that do not currently implement theproposal, the required changes for them are likely to be minimal. Cost to Users:Apparently none.Cost of non-adoption:Inability to use TYPE-OF in portable code except for information display.Performance impact:Likely none.Benefits:Removal of "cost of non-adoption".Esthetics:Little effect.Discussion:Originally, TYPE-OF was concieved as being useful for information display.CLOS specified CLASS-OF far more precisely, in that it must return exactlythe class of an object. Unless TYPE-OF is removed from the language, itseems reasonable to require it to be at least as precise as CLASS-OF.This proposal presumes the (passed) proposalsDATA-TYPES-HIERARCHY-UNDERSPECIFIED:DISJOINT, FUNCTION-TYPE, andaccomodates the Condition System (version 18) and CLOS.*start*01910 00024 US Return-Path: <KMP@STONY-BROOK.SCRC.Symbolics.COM>Received: from STONY-BROOK.SCRC.Symbolics.COM ([128.81.41.144]) by Xerox.COM ; 02 DEC 88 03:24:24 PSTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 501670; Fri 2-Dec-88 06:25:03 ESTDate: Fri, 2 Dec 88 06:24 ESTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 1)To: Masinter.PAcc: CL-Cleanup@SAIL.Stanford.EDUIn-Reply-To: <881201-162703-5359@Xerox>Message-ID: <881202062445.4.KMP@BOBOLINK.SCRC.Symbolics.COM>Can you clarify what a "recognized subtype" is? Is it something thatCLtL readers would recognize (ie, a term introduced in CLtL) or issomething that SUBTYPEP would recognize (ie, spanning implementation-specifictypes).Is it really true that CLOS already presumes that TYPE-OF is in good order?I looked quickly at the spec and it seems to define CLASS-OF in terms ofTYPE-OF. If that quick impression is correct, then you should really mentionthis fact either in the problem description or the rationale to offer it theprominence its due since if this issue is not resolved, the portability ofall methods on built-in classes will have questionable value.On the other hand, if CLOS also offers information about how CLASS-OFcan get its info without going through TYPE-OF, then some verbiage belongsin the Proposal part saying that in all cases where CLASS-OF is well-definedand would return a class which has a proper name, then TYPE-OF should returnthat proper name -- no?I'm a bit tired at this point, so if I'm not completely coherent on theseissues, I apologize. But since I'm going away on vacation soon, I wanted toget my thoughts onto the books.My impression is that the wording of this proposal might need a littletightening here and there but that the general idea is right.*start*01242 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 02 DEC 88 14:04:13 PSTReceived: from ECLA.USC.EDU by SAIL.Stanford.EDU with TCP; 2 Dec 88  13:58:57 PSTDate: Fri, 2 Dec 88 13:54:11 PSTFrom: Kim A. Barrett <IIM@ECLA.USC.EDU>Subject: Re: Issue: TYPE-OF-UNDERCONSTRAINED (Version 1)To: KMP@SCRC-STONY-BROOK.ARPAcc: Masinter.PA, CL-Cleanup@SAIL.STANFORD.EDU, IIM@ECLA.USC.EDUIn-Reply-To: <881202062445.4.KMP@BOBOLINK.SCRC.Symbolics.COM>Message-ID: <12451292808.32.IIM@ECLA.USC.EDU>    Date: Fri, 2 Dec 88 06:24 EST    From: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>    Subject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 1)    ... in all cases where CLASS-OF is well-defined and would return a    class which has a proper name, then TYPE-OF should return that    proper name -- no?  Close, but I think the following is legitimate:(defvar *foo* (make-array 5 :element-type t))(class-name (class-of *foo*))  =>  SIMPLE-VECTOR(type-of *foo*)                =>  (SIMPLE-VECTOR 5)In other words, type-of should be permitted to return more informationthan class-name on class-of.kab-------*start*02655 00024 US Return-Path: <jonl@lucid.com>Received: from lucid.com ([192.26.25.1]) by Xerox.COM ; 06 DEC 88 21:22:38 PSTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA00856g; Tue, 6 Dec 88 21:20:49 PSTReceived: by bhopal id AA11470g; Tue, 6 Dec 88 21:22:42 PSTDate: Tue, 6 Dec 88 21:22:42 PSTFrom: Jon L White <jonl@lucid.com>Message-Id: <8812070522.AA11470@bhopal>To: masinter.paCc: cl-cleanup@SAIL.STANFORD.EDUIn-Reply-To: masinter.pa@Xerox.COM's message of 1 Dec 88 16:26 PST <881201-162703-5359@Xerox>Subject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 1)I like this proposal.  My reading of it is: "TYPE-OF may be purely``informational'', but at least the value returned should consistentas a type-specifier for the argument."  However, I think a fewemmendations are needed.-- It should include a reference to the issue    ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS.  In fact, the clause       The result of TYPE-OF must satisfy        (TYPEP object (TYPE-OF object)).   requires the acceptance of    ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS:UNIFY-UPGRADING.-- The "Cost of non-adoption:" section says:       Inability to use TYPE-OF in portable code except for        information display.   However, the fact that (TYPE-OF 112312) is still permitted to   return SI:MEDIUM-SIZE-FIXNUM means that full use of TYPE-OF is   inherently non-portable anyway.  Hence this "inability" is moot.    Perhaps it would be better simply to focus on the inconsistency    permitted under the current loose definition.  I would also advise    changing the problem description part that claims the trouble is    with "portable applications"; it really is with an under-constrained   definition that can cause one trouble regardless of whether or   not he is "porting".-- The sentence:       The result of TYPE-OF cannot contain be a MEMBER type specifier, or T.   should be emmended to include a rejection of NIL.-- The first 15 lines or so the the Proposal section read like a   mechanical program.  I'd suggest moving the following section more   "up front", to better emphasize the intent of the proposal:      The result of TYPE-OF must satisfy       (TYPEP object (TYPE-OF object)).      The result of TYPE-OF must be an acceptable input to SUBTYPEP.   Or, maybe some lines like:      The result of TYPE-OF must be a type-specifier acceptable for use      as the second argument to TYPEP and as input to SUBTYPEP.  In      addition, the result must accurately describe the argument; that      is, for any object <x>, (TYPEP <x> (TYPE-OF <x>)) must be true.   would do it instead.-- JonL --*start*01057 00024 US Return-Path: <Rob.MacLachlan@fred.slisp.cs.cmu.edu>Received: from FRED.SLISP.CS.CMU.EDU ([128.2.250.114]) by Xerox.COM ; 07 DEC 88 15:36:04 PSTReceived: from FRED.SLISP.CS.CMU.EDU by FRED.SLISP.CS.CMU.EDU;  7 Dec 88 13:11:14 ESTTo: Jon L White <jonl@lucid.com>cc: masinter.pa, cl-cleanup@SAIL.STANFORD.EDUSubject: Re: Issue: TYPE-OF-UNDERCONSTRAINED (Version 1) In-reply-to: Your message of Tue, 06 Dec 88 21:22:42 -0800.             <8812070522.AA11470@bhopal> Date: Wed, 07 Dec 88 13:09:10 ESTFrom: Rob.MacLachlan@WB1.CS.CMU.EDU    Date: Tue, 6 Dec 88 21:22:42 PST    From: Jon L White <jonl@lucid.com>    Message-Id: <8812070522.AA11470@bhopal>    To: masinter.pa@Xerox.COM    Subject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 1)    [...]        -- The sentence:           The result of TYPE-OF cannot contain be a MEMBER type specifier, or T.       should be emmended to include a rejection of NIL.    I believe the TYPEP TYPE-OF consistency constraint implies this, since noobject is TYPEP to NIL.  Rob*start*01602 00024 US Return-Path: <jonl@lucid.com>Received: from lucid.com ([192.26.25.1]) by Xerox.COM ; 07 DEC 88 18:09:22 PSTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA00568g; Wed, 7 Dec 88 18:07:34 PSTReceived: by bhopal id AA01936g; Wed, 7 Dec 88 18:09:29 PSTDate: Wed, 7 Dec 88 18:09:29 PSTFrom: Jon L White <jonl@lucid.com>Message-Id: <8812080209.AA01936@bhopal>To: masinter.paCc: cl-cleanup@SAIL.STANFORD.EDUIn-Reply-To: masinter.pa@Xerox.COM's message of 1 Dec 88 16:26 PST <881201-162703-5359@Xerox>Subject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 1)Incidentally, I would really like to see TYPE-OF constrained to return a portable type-specifier for all the standard types.  This would mean that(TYPE-OF 112312) should not return SI:MEDIUM-SIZE-FIXNUM, but rather something like (SIGNED-BYTE 17) [if that's what SI:MEDIUM-SIZE-FIXNUM means.]Sure, it could return simply INTEGER; but by returning (SIGNED-BYTE 17),it gives an implementation-dependent cue,  in a portable way, thatSI:MEDIUM-SIZE-FIXNUM is meant.However, that's probably too much to ask for at this stage of the game.Further, I must also confess that Lucid's implementation returns somenon-portable, internal things like:  (type-of (make-array 5 :element-type '(unsigned-byte 8)))      ==> SYSTEM:SIMPLE-8BIT-VECTORInstead, I would want it to return (SIMPLE-ARRAY (UNSIGNED-BYTE 8) 1) --the equivalent type-specifier from CLtL.  [About 9 months ago, I started to rectify this; but it's a very low priority item, and hasn't made it to "prime time" yet.]-- JonL --*start*05750 00024 USfDate:  9 Dec 88 15:58 PSTSender: masinter.paTo: x3j13@sail.stanford.eduSubject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 2)From: cl-cleanup@sail.stanford.edureply-to: cl-cleanup@sail.stanford.educc: masinterline-fold: noThis issue arose during the discussion of issueCOERCE-INCOMPLETE, and was only recently cast as a formal proposal in its own right.Forum:	CleanupIssue:      TYPE-OF-UNDERCONSTRAINEDReferences: TYPE-OF (CLtL)            88-002R (Class-of)            88-005, p 43f, Condition system typesRelated issues: SUBTYPEP-TOO-VAGUE                DATA-TYPE-HIERARCHY-UNDERSPECIFIED                FUNCTION-TYPE                ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS                COERCE-INCOMPLETE			Category:       CLARIFICATION/CHANGEEdit history:   Version 1,  1-Dec-88, Masinter		    Version 2,  9-Dec-88, MasinterProblem description:The specification of TYPE-OF in CLtL is so weak as to leave it nearly useless, if any implementor actually took the specificationseriously.In particular, there are almost no constraints on thevalue that TYPE-OF might return for any of the built intypes. The only constraint placed is that for objects created by theconstructor function of DEFSTRUCT, the result of TYPE-OF is the name of thedefstruct.This means that implementations could return T for all other objects.Proposal (TYPE-OF-UNDERCONSTRAINED:ADD-CONSTRAINTS): Specify that the result of TYPE-OF satisfies the following:(a) For any object for which (typep object built-in-type) is true whenbuilt-in-type is one of INTEGER, RATIO, FLOAT, SINGLE-FLOAT, DOUBLE-FLOAT, COMPLEX, NUMBERSYMBOL, STRING, VECTOR, ARRAY, CONS, STREAM, PACKAGE, CHARACTER, FUNCTION, READTABLE, HASH-TABLE, PATHNAME,CONDITION, RESTART,the result of TYPE-OF will be a type specifier for which(subtypep (type-of object) built-in-type) returns T T, i.e., either thebuild-in-type or a subtype of it (a subtype that the implementation's SUBTYPEP can recognize.)(b)  For all objects, (TYPEP object (TYPE-OF object)) will be true.(this implies that it will not be NIL, since noobject is of type NIL.)(c) will be a MEMBER type specifier, or T.For objects created by the "constructor" function of a structuredefined with DEFSTRUCT without a :TYPE option, TYPE-OFwill return the structure name.For objects created by MAKE-INSTANCE, giving a namedclass, TYPE-OF will return the class name of the class. For objects which are instances of anonymous classes (i.e., where(CLASS-NAME (CLASS-OF object)) is NIL), the result of TYPE-OF should be theclass object itself.(The CLOS specification has already specified that class objects areacceptable wherever type specifiers are, and in particular, as input toSUBTYPEP and TYPEP.)This proposal is intended to be consistent with 88-002R, and not to conflict with any of the definitions in that document.Examples:It is legal for (TYPE-OF "abc") to return (SIMPLE-STRING 3), or justSTRING. It is legal for (TYPE-OF 112312) to return SI:MEDIUM-SIZE-FIXNUM,as long as (SUBTYPEP 'SI:MEDIUM-SIZE-FIXNUM 'INTEGER). Given:   (defvar *foo* (make-array 5 :element-type t))   (class-name (class-of *foo*))  =>  SIMPLE-VECTOR  It is legal for   (type-of *foo*)                =>  (SIMPLE-VECTOR 5)Rationale:The original specification for "TYPE-OF" was written to allowimplementation freedom, but the wording is in fact more vague than wasintended. Current practice:Most Common Lisp implementations seem to implement the proposal, at leastfor the types we've tried them on.Cost to Implementors:Even if there are implementations that do not currently implement theproposal, the required changes for them are likely to be minimal. Cost to Users:Apparently none.Cost of non-adoption:TYPE-OF would remain potentially inconsistent.Performance impact:Likely none.Benefits:Bring the specification of TYPE-OF in like with its commonimplementation, while requiring it to be generally useful.Esthetics:Little effect.Discussion:Originally, TYPE-OF was concieved as being useful for information display.CLOS specified CLASS-OF far more precisely, in that it must return exactlythe class of an object. Unless TYPE-OF is removed from the language, itseems reasonable to require it to be at least as precise as CLASS-OF.The accepted CLOS specification does not define CLASS-OFin terms of TYPE-OF, but an earlier draft did. This proposal presumes the (passed) proposalsDATA-TYPES-HIERARCHY-UNDERSPECIFIED:DISJOINT, FUNCTION-TYPE, andaccomodates the Condition System (version 18) and CLOS.If ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS does not pass, and this proposal does pass, it may be that the only way an implementation can satisfy (TYPEP array (TYPE-OF array))would be to have (TYPE-OF array) return VECTOR or ARRAYas appropriate, i.e., with no element type qualification.It is possible to constrain TYPE-OF further, e.g., to eliminatethe possibility that it might return a non-portable implementation-specific value. For example, (TYPE-OF 112312) should not return SI:MEDIUM-SIZE-FIXNUM, but rather something like (SIGNED-BYTE 17) [if that's what SI:MEDIUM-SIZE-FIXNUM means.]We would like to make this as an implementation recommendation,however, rather than as a constraint, at this point.        TITAN 
         TITAN 
           Z                                                `              Ω                            F             ‡       6      Õ       
      Ç              í              o              ã                            1                     
       x                                 “ &z∫*start*01031 00024 US Return-Path: <jonl@lucid.com>Received: from lucid.com ([192.26.25.1]) by Xerox.COM ; 10 DEC 88 03:47:21 PSTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA03444g; Sat, 10 Dec 88 03:45:20 PSTReceived: by bhopal id AA00267g; Sat, 10 Dec 88 03:47:17 PSTDate: Sat, 10 Dec 88 03:47:17 PSTFrom: Jon L White <jonl@lucid.com>Message-Id: <8812101147.AA00267@bhopal>To: cl-cleanup@sail.stanford.eduCc: x3j13@sail.stanford.edu, masinter.paIn-Reply-To: cl-cleanup@sail.stanford.edu's message of 9 Dec 88 15:58 PST <881209-155854-1325@Xerox>Subject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 2)I believe this issue was incorrectly mailed to X3J13.  By "cleanup" rules,only those issues that have "settled down in sub-committee" are to be mailed out now, and this issue has been under daily disucssion for the past week.  Furthermore, this version 2 has had no review whatsoever;worse yet, it appears to have an egregious bug in it (a logical inversion in one sentence).-- JonL --*start*01177 00024 USaReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 10 DEC 88 03:48:51 PSTReceived: from lucid.com by SAIL.Stanford.EDU with TCP; 10 Dec 88  03:48:01 PSTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA03444g; Sat, 10 Dec 88 03:45:20 PSTReceived: by bhopal id AA00267g; Sat, 10 Dec 88 03:47:17 PSTDate: Sat, 10 Dec 88 03:47:17 PSTFrom: Jon L White <jonl@lucid.com>Message-Id: <8812101147.AA00267@bhopal>To: cl-cleanup@sail.stanford.eduCc: x3j13@sail.stanford.edu, masinter.paIn-Reply-To: cl-cleanup@sail.stanford.edu's message of 9 Dec 88 15:58 PST <881209-155854-1325@Xerox>Subject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 2)I believe this issue was incorrectly mailed to X3J13.  By "cleanup" rules,only those issues that have "settled down in sub-committee" are to be mailed out now, and this issue has been under daily disucssion for the past week.  Furthermore, this version 2 has had no review whatsoever;worse yet, it appears to have an egregious bug in it (a logical inversion in one sentence).-- JonL --*start*05867 00024 US Date: 12 Dec 88 16:00 PSTSender: masinter.paTo: x3j13@sail.stanford.eduSubject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 3)From: cl-cleanup@sail.stanford.edureply-to: cl-cleanup@sail.stanford.educc: masinterline-fold: noAs JonL pointed out, Version 2 was missing a "not" in a key sentence in the proposal.Forum:	CleanupIssue:      TYPE-OF-UNDERCONSTRAINEDReferences: TYPE-OF (CLtL)            88-002R (Class-of)            88-005, p 43f, Condition system typesRelated issues: SUBTYPEP-TOO-VAGUE                DATA-TYPE-HIERARCHY-UNDERSPECIFIED                FUNCTION-TYPE                ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS                COERCE-INCOMPLETE			Category:       CLARIFICATION/CHANGEEdit history:   Version 1,  1-Dec-88, Masinter		    Version 2,  9-Dec-88, Masinter		    Version 3, 12-Dec-88, Masinter (fix "egregious bug")Problem description:The specification of TYPE-OF in CLtL is so weak as to leave it nearly useless, if any implementor actually took the specificationseriously.In particular, there are almost no constraints on thevalue that TYPE-OF might return for any of the built intypes. The only constraint placed is that for objects created by theconstructor function of DEFSTRUCT, the result of TYPE-OF is the name of thedefstruct.This means that implementations could return T for all other objects.Proposal (TYPE-OF-UNDERCONSTRAINED:ADD-CONSTRAINTS): Specify that the result of TYPE-OF satisfies the following:(a) For any object for which (typep object built-in-type) is true whenbuilt-in-type is one of INTEGER, RATIO, FLOAT, SINGLE-FLOAT, DOUBLE-FLOAT, COMPLEX, NUMBERSYMBOL, STRING, VECTOR, ARRAY, CONS, STREAM, PACKAGE, CHARACTER, FUNCTION, READTABLE, HASH-TABLE, PATHNAME,CONDITION, RESTART,the result of TYPE-OF will be a type specifier for which(subtypep (type-of object) built-in-type) returns T T, i.e., either thebuild-in-type or a subtype of it (a subtype that the implementation's SUBTYPEP can recognize.)(b)  For all objects, (TYPEP object (TYPE-OF object)) will be true.(this implies that it will not be NIL, since noobject is of type NIL.)(c) will not be a MEMBER type specifier, or T.For objects created by the "constructor" function of a structuredefined with DEFSTRUCT without a :TYPE option, TYPE-OFwill return the structure name.For objects created by MAKE-INSTANCE, giving a namedclass, TYPE-OF will return the class name of the class. For objects which are instances of anonymous classes (i.e., where(CLASS-NAME (CLASS-OF object)) is NIL), the result of TYPE-OF should be theclass object itself.(The CLOS specification has already specified that class objects areacceptable wherever type specifiers are, and in particular, as input toSUBTYPEP and TYPEP.)This proposal is intended to be consistent with 88-002R, and not to conflict with any of the definitions in that document.Examples:It is legal for (TYPE-OF "abc") to return (SIMPLE-STRING 3), or justSTRING. It is legal for (TYPE-OF 112312) to return SI:MEDIUM-SIZE-FIXNUM,as long as (SUBTYPEP 'SI:MEDIUM-SIZE-FIXNUM 'INTEGER). Given:   (defvar *foo* (make-array 5 :element-type t))   (class-name (class-of *foo*))  =>  SIMPLE-VECTOR  It is legal for   (type-of *foo*)                =>  (SIMPLE-VECTOR 5)Rationale:The original specification for "TYPE-OF" was written to allowimplementation freedom, but the wording is in fact more vague than wasintended. Current practice:Most Common Lisp implementations seem to implement the proposal, at leastfor the types we've tried them on.Cost to Implementors:Even if there are implementations that do not currently implement theproposal, the required changes for them are likely to be minimal. Cost to Users:Apparently none.Cost of non-adoption:TYPE-OF would remain potentially inconsistent.Performance impact:Likely none.Benefits:Bring the specification of TYPE-OF in like with its commonimplementation, while requiring it to be generally useful.Esthetics:Little effect.Discussion:Originally, TYPE-OF was concieved as being useful for information display.CLOS specified CLASS-OF far more precisely, in that it must return exactlythe class of an object. Unless TYPE-OF is removed from the language, itseems reasonable to require it to be at least as precise as CLASS-OF.The accepted CLOS specification does not define CLASS-OFin terms of TYPE-OF, but an earlier draft did. This proposal presumes the (passed) proposalsDATA-TYPES-HIERARCHY-UNDERSPECIFIED:DISJOINT, FUNCTION-TYPE, andaccomodates the Condition System (version 18) and CLOS.If ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS does not pass, and this proposal does pass, it may be that the only way an implementation can satisfy (TYPEP array (TYPE-OF array))would be to have (TYPE-OF array) return VECTOR or ARRAYas appropriate, i.e., with no element type qualification.It is possible to constrain TYPE-OF further, e.g., to eliminatethe possibility that it might return a non-portable implementation-specific value. For example, (TYPE-OF 112312) should not return SI:MEDIUM-SIZE-FIXNUM, but rather something like (SIGNED-BYTE 17) [if that's what SI:MEDIUM-SIZE-FIXNUM means.]We would like to make this as an implementation recommendation,however, rather than as a constraint, at this point.     ----- End Forwarded Messages -----        TITAN 
          TITAN 
        ; -(TEXTFONT 7 (TIMESROMAN 12) NIL (CLASSIC 10))            Z              ‘                                   `              Ω                            Å             ‡       6      —       
      Ç              í              o              ã                            1                     
       x                           ,       &z∫*start*05738 00024 USaReturn-Path: <X3J13-mailer@SAIL.Stanford.EDU>Received: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 12 DEC 88 16:23:53 PSTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 12 Dec 88  16:09:45 PSTReceived: from Cabernet.ms by ArpaGateway.ms ; 12 DEC 88 16:01:09 PSTDate: 12 Dec 88 16:00 PSTSender: masinter.paTo: x3j13@sail.stanford.eduSubject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 3)From: cl-cleanup@sail.stanford.edureply-to: cl-cleanup@sail.stanford.educc: masinter.paline-fold: noMessage-ID: <881212-160109-5511@Xerox>As JonL pointed out, Version 2 was missing a "not" in a key sentence in the proposal.!Forum:	CleanupIssue:      TYPE-OF-UNDERCONSTRAINEDReferences: TYPE-OF (CLtL)            88-002R (Class-of)            88-005, p 43f, Condition system typesRelated issues: SUBTYPEP-TOO-VAGUE                DATA-TYPE-HIERARCHY-UNDERSPECIFIED                FUNCTION-TYPE                ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS                COERCE-INCOMPLETE			Category:       CLARIFICATION/CHANGEEdit history:   Version 1,  1-Dec-88, Masinter		    Version 2,  9-Dec-88, Masinter		    Version 3, 12-Dec-88, Masinter (fix "egregious bug")Problem description:The specification of TYPE-OF in CLtL is so weak as to leave it nearly useless, if any implementor actually took the specificationseriously.In particular, there are almost no constraints on thevalue that TYPE-OF might return for any of the built intypes. The only constraint placed is that for objects created by theconstructor function of DEFSTRUCT, the result of TYPE-OF is the name of thedefstruct.This means that implementations could return T for all other objects.Proposal (TYPE-OF-UNDERCONSTRAINED:ADD-CONSTRAINTS): Specify that the result of TYPE-OF satisfies the following:(a) For any object for which (typep object built-in-type) is true whenbuilt-in-type is one of INTEGER, RATIO, FLOAT, SINGLE-FLOAT, DOUBLE-FLOAT, COMPLEX, NUMBERSYMBOL, STRING, VECTOR, ARRAY, CONS, STREAM, PACKAGE, CHARACTER, FUNCTION, READTABLE, HASH-TABLE, PATHNAME,CONDITION, RESTART,the result of TYPE-OF will be a type specifier for which(subtypep (type-of object) built-in-type) returns T T, i.e., either thebuild-in-type or a subtype of it (a subtype that the implementation's SUBTYPEP can recognize.)(b)  For all objects, (TYPEP object (TYPE-OF object)) will be true.(this implies that it will not be NIL, since noobject is of type NIL.)(c) will not be a MEMBER type specifier, or T.For objects created by the "constructor" function of a structuredefined with DEFSTRUCT without a :TYPE option, TYPE-OFwill return the structure name.For objects created by MAKE-INSTANCE, giving a namedclass, TYPE-OF will return the class name of the class. For objects which are instances of anonymous classes (i.e., where(CLASS-NAME (CLASS-OF object)) is NIL), the result of TYPE-OF should be theclass object itself.(The CLOS specification has already specified that class objects areacceptable wherever type specifiers are, and in particular, as input toSUBTYPEP and TYPEP.)This proposal is intended to be consistent with 88-002R, and not to conflict with any of the definitions in that document.Examples:It is legal for (TYPE-OF "abc") to return (SIMPLE-STRING 3), or justSTRING. It is legal for (TYPE-OF 112312) to return SI:MEDIUM-SIZE-FIXNUM,as long as (SUBTYPEP 'SI:MEDIUM-SIZE-FIXNUM 'INTEGER). Given:   (defvar *foo* (make-array 5 :element-type t))   (class-name (class-of *foo*))  =>  SIMPLE-VECTOR  It is legal for   (type-of *foo*)                =>  (SIMPLE-VECTOR 5)Rationale:The original specification for "TYPE-OF" was written to allowimplementation freedom, but the wording is in fact more vague than wasintended. Current practice:Most Common Lisp implementations seem to implement the proposal, at leastfor the types we've tried them on.Cost to Implementors:Even if there are implementations that do not currently implement theproposal, the required changes for them are likely to be minimal. Cost to Users:Apparently none.Cost of non-adoption:TYPE-OF would remain potentially inconsistent.Performance impact:Likely none.Benefits:Bring the specification of TYPE-OF in like with its commonimplementation, while requiring it to be generally useful.Esthetics:Little effect.Discussion:Originally, TYPE-OF was concieved as being useful for information display.CLOS specified CLASS-OF far more precisely, in that it must return exactlythe class of an object. Unless TYPE-OF is removed from the language, itseems reasonable to require it to be at least as precise as CLASS-OF.The accepted CLOS specification does not define CLASS-OFin terms of TYPE-OF, but an earlier draft did. This proposal presumes the (passed) proposalsDATA-TYPES-HIERARCHY-UNDERSPECIFIED:DISJOINT, FUNCTION-TYPE, andaccomodates the Condition System (version 18) and CLOS.If ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS does not pass, and this proposal does pass, it may be that the only way an implementation can satisfy (TYPEP array (TYPE-OF array))would be to have (TYPE-OF array) return VECTOR or ARRAYas appropriate, i.e., with no element type qualification.It is possible to constrain TYPE-OF further, e.g., to eliminatethe possibility that it might return a non-portable implementation-specific value. For example, (TYPE-OF 112312) should not return SI:MEDIUM-SIZE-FIXNUM, but rather something like (SIGNED-BYTE 17) [if that's what SI:MEDIUM-SIZE-FIXNUM means.]We would like to make this as an implementation recommendation,however, rather than as a constraint, at this point.     ----- End Forwarded Messages -----*start*02386 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 12 DEC 88 17:49:41 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 12 Dec 88  17:48:46 PSTReceived: from EUPHRATES.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 507596; Mon 12-Dec-88 20:48:08 ESTDate: Mon, 12 Dec 88 20:48 ESTFrom: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: TYPE-OF-UNDERCONSTRAINED (Version 3)To: cl-cleanup@sail.stanford.eduIn-Reply-To: <881212-160109-5511@Xerox>Message-ID: <19881213014819.6.MOON@EUPHRATES.SCRC.Symbolics.COM>[X3J13 removed]I approve this, but there are some obvious mistakes:Why is RANDOM-STATE missing from the list of built-in types?  Probably othersare missing as well, I did not check the list carefully.(SUBTYPEP (TYPE-OF x) (CLASS-OF x)) => T T for all x, seems tohave been intended but is not actually said.  I think this shouldbe added to the proposal section.The first three points in the proposal section are identified withletters, but the last three points are not.Re the discussion section:The comment about the relation of CLASS-OF and TYPE-OF, while it may betrue, only indicates confusion in an earlier CLOS spec and detracts fromunderstanding the point of this proposal.If you want "to eliminate the possibility that TYPE-OF might return anon-portable implementation-specific value" you will have to definethe concept of portable objects versus implementation-dependent objects,since obviously an implementation that has an entirely new kind ofobject cannot return a portable type-specifier for that object.  Also whatabout implementations that have implementation-dependent subtypes ofbuilt-in types, especially if those subtypes are defined with DEFSTRUCTor DEFCLASS -- the spec simultaneously requires TYPE-OF to return theclass name or structure name, and to return a portable value distinctfrom the class or structure name.  For a concrete example, Genera has animplementation-dependent subtype of PATHNAME for each type of filesystem supported, and TYPE-OF returns the class name.  I think theproposed implementation recommendation cannot be portably specifiedand hence should be discarded.*start*00613 00024 US Date:  7 Jan 89 22:04 PSTFrom: masinter.paSubject: Re: Issue: TYPE-OF-UNDERCONSTRAINED (Version 3)In-reply-to: your message of 12 Dec 88 16:00 PSTTo: cl-cleanup@sail.stanford.educc: masinter.paOn p. 317, CLtL gives an example(defstruct (binop (:type list))	(operator '? :type symbol)	operand-1	operand-2)and says in the running text ..."... and TYPE-OF will return LIST when given a BINOP structure."I guess if the example survives in the standard it should be fixed.... I don't see a compelling reason why(TYPE-OF '(A B C)) should be LIST instead of CONS, do you?*start*00974 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 07 JAN 89 22:12:28 PSTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 7 Jan 89  22:12:23 PSTReceived: from Cabernet.ms by ArpaGateway.ms ; 07 JAN 89 22:04:43 PSTDate: 7 Jan 89 22:04 PSTFrom: masinter.paSubject: Re: Issue: TYPE-OF-UNDERCONSTRAINED (Version 3)In-reply-to: your message of 12 Dec 88 16:00 PSTTo: cl-cleanup@sail.stanford.educc: masinter.paMessage-ID: <890107-220443-2934@Xerox>On p. 317, CLtL gives an example(defstruct (binop (:type list))	(operator '? :type symbol)	operand-1	operand-2)and says in the running text ..."... and TYPE-OF will return LIST when given a BINOP structure."I guess if the example survives in the standard it should be fixed.... Idon't see a compelling reason why(TYPE-OF '(A B C)) should be LIST instead of CONS, do you?*start*06143 00024 USfGV-Info: CL-Cleanup-mailer@SAIL.Stanford.EDU at 14-Mar-89 16:12:30 from AGReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 14 MAR 89 16:11:22 PSTReceived: from Think.COM by SAIL.Stanford.EDU with TCP; 14 Mar 89  16:11:32 PSTReceived: from fafnir.think.com by Think.COM; Tue, 14 Mar 89 16:46:54 ESTReturn-Path: <gls@Think.COM>Received: from verdi.think.com by fafnir.think.com; Tue, 14 Mar 89 16:48:13 ESTReceived: by verdi.think.com; Tue, 14 Mar 89 16:45:02 ESTDate: Tue, 14 Mar 89 16:45:02 ESTFrom: Guy Steele <gls@Think.COM>Message-Id: <8903142145.AA05320@verdi.think.com>To: cl-cleanup@sail.stanford.eduCc: gls@Think.COMSubject: TYPE-OF-UNDERCONSTRAINED, version 4This is a proposal to amend version 3, passed as amended (to includeRANDOM-STATE) in January 1989 in Kauai.Version 4 amends version 3 to add SHORT-FLOAT, LONG-FLOAT, and RATIONALto the list of types in part (a) of the proposal.Forum:	CleanupIssue:      TYPE-OF-UNDERCONSTRAINEDReferences: TYPE-OF (CLtL)            88-002R (Class-of)            88-005, p 43f, Condition system typesRelated issues: SUBTYPEP-TOO-VAGUE                DATA-TYPE-HIERARCHY-UNDERSPECIFIED                FUNCTION-TYPE                ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS                COERCE-INCOMPLETE			Category:       CLARIFICATION/CHANGEEdit history:   Version 1,  1-Dec-88, Masinter		    Version 2,  9-Dec-88, Masinter		    Version 3, 12-Dec-88, Masinter (fix "egregious bug")		Versino 4, 3-14-89 SteeleProblem description:The specification of TYPE-OF in CLtL is so weak as to leave it nearly useless, if any implementor actually took the specificationseriously.In particular, there are almost no constraints on thevalue that TYPE-OF might return for any of the built intypes. The only constraint placed is that for objects created by theconstructor function of DEFSTRUCT, the result of TYPE-OF is the name of thedefstruct.This means that implementations could return T for all other objects.Proposal (TYPE-OF-UNDERCONSTRAINED:ADD-CONSTRAINTS): Specify that the result of TYPE-OF satisfies the following:(a) For any object for which (typep object built-in-type) is true whenbuilt-in-type is one of INTEGER, RATIO, FLOAT, SINGLE-FLOAT, DOUBLE-FLOAT, COMPLEX, NUMBERSYMBOL, STRING, VECTOR, ARRAY, RANDOM-STATECONS, STREAM, PACKAGE, CHARACTER, FUNCTION, READTABLE, HASH-TABLE, PATHNAME,CONDITION, RESTART,RATIONAL, SHORT-FLOAT, LONG-FLOATthe result of TYPE-OF will be a type specifier for which(subtypep (type-of object) built-in-type) returns T T, i.e., either thebuild-in-type or a subtype of it (a subtype that the implementation's SUBTYPEP can recognize.)(b)  For all objects, (TYPEP object (TYPE-OF object)) will be true.(this implies that it will not be NIL, since noobject is of type NIL.)(c) will not be a MEMBER type specifier, or T.For objects created by the "constructor" function of a structuredefined with DEFSTRUCT without a :TYPE option, TYPE-OFwill return the structure name.For objects created by MAKE-INSTANCE, giving a namedclass, TYPE-OF will return the class name of the class. For objects which are instances of anonymous classes (i.e., where(CLASS-NAME (CLASS-OF object)) is NIL), the result of TYPE-OF should be theclass object itself.(The CLOS specification has already specified that class objects areacceptable wherever type specifiers are, and in particular, as input toSUBTYPEP and TYPEP.)This proposal is intended to be consistent with 88-002R, and not to conflict with any of the definitions in that document.Examples:It is legal for (TYPE-OF "abc") to return (SIMPLE-STRING 3), or justSTRING. It is legal for (TYPE-OF 112312) to return SI:MEDIUM-SIZE-FIXNUM,as long as (SUBTYPEP 'SI:MEDIUM-SIZE-FIXNUM 'INTEGER). Given:   (defvar *foo* (make-array 5 :element-type t))   (class-name (class-of *foo*))  =>  SIMPLE-VECTOR  It is legal for   (type-of *foo*)                =>  (SIMPLE-VECTOR 5)Rationale:The original specification for "TYPE-OF" was written to allowimplementation freedom, but the wording is in fact more vague than wasintended. Current practice:Most Common Lisp implementations seem to implement the proposal, at leastfor the types we've tried them on.Cost to Implementors:Even if there are implementations that do not currently implement theproposal, the required changes for them are likely to be minimal. Cost to Users:Apparently none.Cost of non-adoption:TYPE-OF would remain potentially inconsistent.Performance impact:Likely none.Benefits:Bring the specification of TYPE-OF in like with its commonimplementation, while requiring it to be generally useful.Esthetics:Little effect.Discussion:Originally, TYPE-OF was concieved as being useful for information display.CLOS specified CLASS-OF far more precisely, in that it must return exactlythe class of an object. Unless TYPE-OF is removed from the language, itseems reasonable to require it to be at least as precise as CLASS-OF.The accepted CLOS specification does not define CLASS-OFin terms of TYPE-OF, but an earlier draft did. This proposal presumes the (passed) proposalsDATA-TYPES-HIERARCHY-UNDERSPECIFIED:DISJOINT, FUNCTION-TYPE, andaccomodates the Condition System (version 18) and CLOS.If ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS does not pass, and this proposal does pass, it may be that the only way an implementation can satisfy (TYPEP array (TYPE-OF array))would be to have (TYPE-OF array) return VECTOR or ARRAYas appropriate, i.e., with no element type qualification.It is possible to constrain TYPE-OF further, e.g., to eliminatethe possibility that it might return a non-portable implementation-specific value. For example, (TYPE-OF 112312) should not return SI:MEDIUM-SIZE-FIXNUM, but rather something like (SIGNED-BYTE 17) [if that's what SI:MEDIUM-SIZE-FIXNUM means.]We would like to make this as an implementation recommendation,however, rather than as a constraint, at this point.*start*06948 00024 USfGV-Info: CL-Cleanup-mailer@SAIL.Stanford.EDU at 16-Mar-89 18:03:45 from AGReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 16 MAR 89 18:03:47 PSTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 16 Mar 89  18:02:00 PSTReceived: from Semillon.ms by ArpaGateway.ms ; 16 MAR 89 17:54:51 PSTDate: 16 Mar 89 17:40 PSTFrom: masinter.paTo: cl-cleanup@sail.stanford.eduSubject: Issue: TYPE-OF-UNDERCONSTRAINED, v.5Message-ID: <890316-175451-6328@Xerox>I think Guy missed a couple of the amendments that passedat the last meeting. This is what I started to send outto X3J13, but since I've tried to "patch" the wording a bitsince it seems that some of the constraints put on TYPE-OFby this proposal are overlapping, I thought I would sendit to cl-cleanup first. (Since this was raised at the lastmeeting, there's not a problem about the 'two-week' rule,I think.)Version 3 of this proposal was raised at the January 1989X3J13, and passed with three amendments:a) add RANDOM-STATE to the list of typesb) add the requirement that TYPE-OF is a subtype of CLASS-OFc) change the relation to CLOS to say "for all objects  for which CLASS-OF returns a class with a proper name, TYPE-OF returns  that proper name."It was noted that SHORT-FLOAT, LONG-FLOAT and RATIONAL were omitted inadvertently. We would like to ask that the proposalbe reconsidered so that these types could also be included.This version includes those amendments, and alsoadds SHORT-FLOAT, LONG-FLOAT, and RATIONALto the list of types in part (a) of the proposal.!Forum:	CleanupIssue:      TYPE-OF-UNDERCONSTRAINEDReferences: TYPE-OF (CLtL)            88-002R (Class-of)            88-005, p 43f, Condition system typesRelated issues: SUBTYPEP-TOO-VAGUE                DATA-TYPE-HIERARCHY-UNDERSPECIFIED                FUNCTION-TYPE                ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS                COERCE-INCOMPLETE			Category:       CLARIFICATION/CHANGEEdit history:   Version 1,  1-Dec-88, Masinter		    Version 2,  9-Dec-88, Masinter		    Version 3, 12-Dec-88, Masinter (fix "egregious bug")		Version 4, 3-14-89 Steele		Version 5, 16-Mar-89, Masinter (add other amendments)Problem description:The specification of TYPE-OF in CLtL is so weak as to leave it nearly useless, if any implementor actually took the specificationseriously.In particular, there are almost no constraints on thevalue that TYPE-OF might return for any of the built intypes. The only constraint placed is that for objects created by theconstructor function of DEFSTRUCT, the result of TYPE-OF is the name of thedefstruct.This means that implementations could return T for all other objects.Proposal (TYPE-OF-UNDERCONSTRAINED:ADD-CONSTRAINTS): Specify that the result of TYPE-OF satisfies the following:(a) For any object for which (typep object built-in-type) is true whenbuilt-in-type is one of INTEGER, RATIO, FLOAT, SINGLE-FLOAT, DOUBLE-FLOAT, COMPLEX, NUMBER,SYMBOL, STRING, VECTOR, ARRAY, RANDOM-STATE,CONS, STREAM, PACKAGE, CHARACTER, FUNCTION, READTABLE, HASH-TABLE, PATHNAME,CONDITION, RESTART,RATIONAL, SHORT-FLOAT, LONG-FLOATthe result of TYPE-OF will be a type specifier for which(subtypep (type-of object) built-in-type) returns T T, i.e., either thebuild-in-type or a subtype of it (a subtype that the implementation's SUBTYPEP can recognize.)(b)  For all objects, (TYPEP object (TYPE-OF object)) will be true.(this implies that it will not be NIL, since noobject is of type NIL.)(c) will not be a MEMBER type specifier, or T.The type returned by TYPE-OF is always a subtype of the classreturned by CLASS-OF.For all objects for which CLASS-OF returns a class with a proper name,TYPE-OF returns that proper name.In particular, for objects created by the "constructor" functionof a structure defined with DEFSTRUCT without a :TYPE option,TYPE-OF will return the structure name.For all objects for which (CLASS-NAME (CLASS-OF object)) is NIL),the result of TYPE-OF will return the class object itself.(The CLOS specification has already specified that class objects areacceptable wherever type specifiers are, and in particular, as input toSUBTYPEP and TYPEP.)This proposal is intended to be consistent with 88-002R, and not to conflict with any of the definitions in that document.Examples:It is legal for (TYPE-OF "abc") to return (SIMPLE-STRING 3), or justSTRING. It is legal for (TYPE-OF 112312) to return SI:MEDIUM-SIZE-FIXNUM,as long as (SUBTYPEP 'SI:MEDIUM-SIZE-FIXNUM 'INTEGER). Given:   (defvar *foo* (make-array 5 :element-type t))   (class-name (class-of *foo*))  =>  SIMPLE-VECTOR  It is legal for   (type-of *foo*)                =>  (SIMPLE-VECTOR 5)Rationale:The original specification for "TYPE-OF" was written to allowimplementation freedom, but the wording is in fact more vague than wasintended. Current practice:Most Common Lisp implementations seem to implement the proposal, at leastfor the types we've tried them on.Cost to Implementors:Even if there are implementations that do not currently implement theproposal, the required changes for them are likely to be minimal. Cost to Users:Apparently none.Cost of non-adoption:TYPE-OF would remain potentially inconsistent.Performance impact:Likely none.Benefits:Bring the specification of TYPE-OF in like with its commonimplementation, while requiring it to be generally useful.Esthetics:Little effect.Discussion:Originally, TYPE-OF was concieved as being useful for information display.CLOS specified CLASS-OF far more precisely, in that it must return exactlythe class of an object. Unless TYPE-OF is removed from the language, itseems reasonable to require it to be at least as precise as CLASS-OF.The accepted CLOS specification does not define CLASS-OFin terms of TYPE-OF, but an earlier draft did. This proposal presumes the (passed) proposalsDATA-TYPES-HIERARCHY-UNDERSPECIFIED:DISJOINT, FUNCTION-TYPE, andaccomodates the Condition System (version 18) and CLOS.If ARRAY-TYPE-ELEMENT-TYPE-SEMANTICS does not pass, and this proposal does pass, it may be that the only way an implementation can satisfy (TYPEP array (TYPE-OF array))would be to have (TYPE-OF array) return VECTOR or ARRAYas appropriate, i.e., with no element type qualification.It is possible to constrain TYPE-OF further, e.g., to eliminatethe possibility that it might return a non-portable implementation-specific value. For example, (TYPE-OF 112312) should not return SI:MEDIUM-SIZE-FIXNUM, but rather something like (SIGNED-BYTE 17) [if that's what SI:MEDIUM-SIZE-FIXNUM means.]We would like to make this as an implementation recommendation,however, rather than as a constraint, at this point.     ----- End Forwarded Messages -----*start*00754 00024 US GV-Info: gls@Think.COM at 17-Mar-89 12:10:41 from AGReturn-Path: <gls@Think.COM>Received: from Think.COM ([10.4.0.6]) by Xerox.COM ; 17 MAR 89 11:58:36 PSTReceived: from fafnir.think.com by Think.COM; Fri, 17 Mar 89 14:56:34 ESTReturn-Path: <gls@Think.COM>Received: from verdi.think.com by fafnir.think.com; Fri, 17 Mar 89 14:57:02 ESTReceived: by verdi.think.com; Fri, 17 Mar 89 14:53:50 ESTDate: Fri, 17 Mar 89 14:53:50 ESTFrom: Guy Steele <gls@Think.COM>Message-Id: <8903171953.AA09017@verdi.think.com>To: masinter.paCc: gls@Think.COMIn-Reply-To: masinter.pa@xerox.com's message of 16 Mar 89 17:40 PST <890316-175451-6328@Xerox>Subject: Issue: TYPE-OF-UNDERCONSTRAINED, v.5Ooops.  Thanks for fixing this, Larry.*start*03784 00024 US GV-Info: CL-Cleanup-mailer@SAIL.Stanford.EDU at 17-Mar-89 21:39:48 from AGReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 17 MAR 89 21:39:44 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 17 Mar 89  21:40:20 PSTReceived: from EUPHRATES.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via INTERNET with SMTP id 560258; 18 Mar 89 00:37:50 ESTDate: Sat, 18 Mar 89 00:37 ESTFrom: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: TYPE-OF-UNDERCONSTRAINED, v.5To: cl-cleanup@sail.stanford.eduIn-Reply-To: <890316-175451-6328@Xerox>Message-ID: <19890318053740.8.MOON@EUPHRATES.SCRC.Symbolics.COM>This version looks okay as far as making the amendments goes, butin reading it over I noticed some problems that are really withthe original proposal.  If we have to go over this issue again,I think we should consider fixing these problems too.(1) Why are the following types omitted from part (a), the listof types for which TYPE-OF must be specific:  BIT-VECTOR NULL SEQUENCEI constructed this list from 88-002R pp.1-16 and 1-17, and from thespecifications of which types are exhaustive partitions, I didn'tmake it up randomly.(2) Why are the following types omitted from part (a), the listof types for which TYPE-OF must be specific:  BIGNUM FIXNUM KEYWORD STANDARD-CHAR STRING-CHAR  (replace STRING-CHAR with BASE-CHARACTER if that proposal passes)Unlike the first list, I constructed this one randomly out of my head.It's all the standard "interesting" subtypes of the types that arealready listed in part (a), excluding the simple array subtypes.(3) The statement "For all objects for which CLASS-OF returns a classwith a proper name, TYPE-OF returns that proper name." is questionable.For example, part (a) requires that TYPE-OF a single-float must returnSINGLE-FLOAT or a subtype of it, but 88-002R requires that CLASS-OF asingle-float be a class whose proper name is FLOAT, or an implementationdependent subclass of that class.  This proposal will forceimplementations to create such subclasses, which should be done on itsown merits, not through the back door.  Another example is that forarrays, TYPE-OF will not be able to return a list that encodes theelement-type and dimensions, unless there are implementation dependentclasses corresponding to every such type specifier.  There is a reallybaroque way to get around this, which is to define an implementationdependent subclass of ARRAY that has a non-null name that is not itsproper name; this slips through a loophole in the proposal and allowsTYPE-OF to return any subtype of ARRAY.  I claim that loophole is abug too.To fix these bugs, I suggest removing the four paragraphs that containthe three references to CLASS-OF, and replacing them with:(d) The type returned by TYPE-OF is always a subtype of the classreturned by CLASS-OF, and is a subtype that the implementation'sSUBTYPEP can recognize.(e) For objects of metaclass STRUCTURE-CLASS or STANDARD-CLASS,TYPE-OF returns the proper name of the class returned by CLASS-OFif it has a proper name, and otherwise returns the class itself.In particular, for objects created by the "constructor" functionof a structure defined with DEFSTRUCT without a :TYPE option,TYPE-OF will return the structure name.(4) I suggest modifying part (c) to exclude SATISFIES, AND, OR,NOT, and VALUES in addition to MEMBER and T.  Of course part (c)is a very weak restriction, since TYPE-OF is perfectly free toreturn a symbol that is DEFTYPEd to one of these type specifiers,as long as the other requirements are met.*start*02056 00024 US GV-Info: CL-Cleanup-mailer@SAIL.Stanford.EDU at 17-Mar-89 22:22:38 from AGReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 17 MAR 89 22:22:36 PSTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 17 Mar 89  22:23:00 PSTReceived: from Semillon.ms by ArpaGateway.ms ; 17 MAR 89 22:14:13 PSTDate: 17 Mar 89 22:09 PSTFrom: masinter.paSubject: Re: Issue: TYPE-OF-UNDERCONSTRAINED, v.5In-reply-to: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>'s message of Sat, 18 Mar 89 00:37 ESTTo: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>cc: cl-cleanup@sail.stanford.eduMessage-ID: <890317-221413-3463@Xerox>I think BIT-VECTOR might have been an omission.NULL was left out because it seemed silly and at odds with current practiceto require that (TYPE-OF 'NIL) = NULL.  However, if (CLASS-OF 'NIL) is thespecial NULL class, then we would have to reconsider.SEQUENCE was left out because it is an 'abstract' class and is (as far asthe standard is concerned) exhaustively partitioned by VECTOR and LISTwhich are already "lower bounds" of TYPE-OF.BIGNUM and FIXNUM were left out because their division was implementationdependent.KEYWORD was left out because under odd circumstances it is possible todynamically change the 'type' (e.g., by UNINTERN).STANDARD-CHAR and STRING-CHAR were left out for the same reasons theyaren't built-in classes.- - - - -I like your proposed fixes to the CLASS-OF wording.- - - - -About part (c): the restriction on T is meaningless, since the CLASS-OFrestriction dominates it. The restriction on MEMBER is OK, just to keepTYPE-OF from being the silly definition that (type-of x) = `(member ,x).  Ithink we're running out of good reasons to leave out SATISFIES, AND, OR,NOT, and VALUES; they're probably no more useful, but we're probablyoverspecifying for no good reason.However, I'll be happy to go along with whatever you feel is right on thisone...*start*02064 00024 US GV-Info: Moon@STONY-BROOK.SCRC.Symbolics.COM at 17-Mar-89 22:58:20 from AGReturn-Path: <Moon@STONY-BROOK.SCRC.Symbolics.COM>Received: from STONY-BROOK.SCRC.Symbolics.COM ([128.81.41.144]) by Xerox.COM ; 17 MAR 89 22:58:12 PSTReceived: from EUPHRATES.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 560300; Sat 18-Mar-89 01:57:45 ESTDate: Sat, 18 Mar 89 01:57 ESTFrom: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Subject: Re: Issue: TYPE-OF-UNDERCONSTRAINED, v.5To: masinter.pacc: cl-cleanup@sail.stanford.eduIn-Reply-To: <890317-221413-3463@Xerox>Message-ID: <19890318065727.3.MOON@EUPHRATES.SCRC.Symbolics.COM>Line-fold: No    Date: 17 Mar 89 22:09 PST    From: masinter.pa@Xerox.COM    I think BIT-VECTOR might have been an omission.    NULL was left out because it seemed silly and at odds with current practice    to require that (TYPE-OF 'NIL) = NULL.  However, if (CLASS-OF 'NIL) is the    special NULL class, then we would have to reconsider.In Symbolics Genera 7.4, (TYPE-OF 'NIL) => NULL, so that's some currentpractice.  88-002R mandates (SUBTYPEP (CLASS-OF 'NIL) (FIND-CLASS 'NULL)).    SEQUENCE was left out because it is an 'abstract' class and is (as far as    the standard is concerned) exhaustively partitioned by VECTOR and LIST    which are already "lower bounds" of TYPE-OF.It is not an exhaustive partition, according to CLtL p.35.  I putSEQUENCE in so that if an implementation adds a third kind of SEQUENCE,TYPE-OF can't be any less specific than SEQUENCE.  This is the same reasonthat RATIONAL, FLOAT, and NUMBER are in.    BIGNUM and FIXNUM were left out because their division was implementation    dependent.    KEYWORD was left out because under odd circumstances it is possible to    dynamically change the 'type' (e.g., by UNINTERN).    STANDARD-CHAR and STRING-CHAR were left out for the same reasons they    aren't built-in classes.I'll buy the above three paragraphs, although I don't think any of themare 100% compelling.*start*01182 00024 US Date:  4 Apr 89 13:32 PDTSender: CL-Cleanup-mailer%SAIL.Stanford:EDU:XeroxFrom: KMP%STONY-BROOK.SCRC.Symbolics:COM:XeroxSubject: Issue: TYPE-OF-UNDERCONSTRAINEDTo: CL-Cleanup%SAIL.Stanford:EDU:XeroxGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: TYPE-OF-UNDERCONSTRAINEDTo: CL-Cleanup@SAIL.Stanford.EDUReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 04 APR 89 13:12:02 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM by SAIL.Stanford.EDU with TCP; 4 Apr 89  12:47:07 PDTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 571292; Tue 4-Apr-89 15:46:55 EDTOriginal-Date: Tue, 4 Apr 89 15:46 EDTMessage-ID: <890404154630.0.KMP@BOBOLINK.SCRC.Symbolics.COM>GVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVSome people had some concerns about a previous version of this that passed.We wanted to reconsider this, but didn't have the right hardcopy.No action was taken. This will probably come up next meeting.*start*00906 00024 US GV-Info: CL-Cleanup-mailer@SAIL.Stanford.EDU at 10-Apr-89 00:07:07 from AGReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 10 APR 89 00:07:06 PDTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 10 Apr 89  00:06:14 PDTReceived: from Semillon.ms by ArpaGateway.ms ; 10 APR 89 00:05:53 PDTDate: 10 Apr 89 00:05 PDTFrom: masinter.paSubject: Re: Issue: TYPE-OF-UNDERCONSTRAINEDIn-reply-to: KMP%STONY-BROOK.SCRC.Symbolics:COM:Xerox's message of 4 Apr 89 13:32 PDTTo: KMP@Symbolics.COMcc: CL-Cleanup@SAIL.Stanford.EDUMessage-ID: <890410-000553-3516@Xerox>Actually, Mary's notes and my recollection is that there was a motion toreconsider that was tabled. I'm not sure this is the same as "no action wastabled", but I think it definitely will come up next meeting.