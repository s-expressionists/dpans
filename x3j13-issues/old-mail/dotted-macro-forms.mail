*start*05194 00024 USfReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([10.0.0.11]) by Xerox.COM ; 28 JUN 88 13:49:33 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 28 Jun 88  13:47:49 PDTReceived: from RIO-DE-JANEIRO.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 426049; Tue 28-Jun-88 16:47:36 EDTDate: Tue, 28 Jun 88 16:47 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: DOTTED-MACRO-FORMS (Version 1)To: CL-Cleanup@SAIL.Stanford.EDUcc: goldman@VAXA.ISI.EDUReferences: The message of 14 Jun 88 17:32 EDT from goldman@VAXA.ISI.EDUMessage-ID: <880628164723.5.KMP@RIO-DE-JANEIRO.SCRC.Symbolics.COM>Issue:        DOTTED-MACRO-FORMSReferences:   forms (p54), lists and dotted lists (pp26-27),	      DEFMACRO (p145), destructuring macro arguments (p146)Category:     CLARIFICATIONEdit history: 28-Jun-88, Version 1 by PitmanStatus:	      For Internal DiscussionProblem Description:  CLtL is not explicit about whether macro forms may be dotted lists.  p54 says that only certain forms are "meaningful": self-evaluating   forms, symbols, and "lists".  pp26-27 defines "list" and "dotted list". It goes on to say   ``Throughout this manual, unless otherwise specified, it is an   error to pass a dotted list to a function that is specified   to require a list as an argument.''  p146 states that in DEFMACRO destructuring, ``the argument   form that would match the parameter is treated as a   (possibly dotted) list, to be used as an argument forms list   for satisfying the parameters in the embedded lambda list.''   It goes on to say that ". var" is treated like "&rest var"   at any level of the defmacro lambda-list.Test Case:  #1: (DEFMACRO MACW (&WHOLE W &REST R) `(- ,(CDR W)))      (MACW . 1) => ??  #2: (DEFMACRO MACR (&REST R) `(- ,R))      (MACR . 1) => ??  #3: (DEFMACRO MACX (&WHOLE W) `(- ,(CDR W)))      (MACX . 1)Current Practice:  A. Some implementations bind W to (MACW . 1) in #1 and #3   		      and bind R to 1 in #1 and #2.  B. Some implementations bind W to (MACW . 1) in #3		      and signal a syntax error in #1 and #2.  C. Some implementations signal a syntax error in #1, #2, and #3.     Symbolics Genera is such an implementation.Proposal (DOTTED-MACRO-FORMS:EXPLICITLY-VAGUE):  Clarify that it is an error for a macro form to be a dotted list.  Rationale:      Makes current practice explicit.      Dotted lists are a possible symptom of program syntax error.    Allowing implementations to check for this error may catch enough    errors to justify the loss of program flexibility.  Test Case:    (MACW . 1) would be an error under this proposal.    (MACR . 1) would be an error under this proposal.  Cost to Implementors:      None. This is merely a clarification of existing practice.    Cost to Users:      None. Users already can't rely on this behavior since it varies    widely between implementations already.  Proposal (DOTTED-MACRO-FORMS:ALLOW):  Clarify that if &REST occurs in a DEFMACRO lambda-list, it is permitted  to match an atom or dotted list.  Rationale:      This is more flexible, and there is no efficiency or compatibility    argument for not allowing it.    Test Case:    (MACW . 1) would reliably return -1 under this proposal.    (MACR . 1) would reliably return -1 under this proposal.  Cost to Implementors:      Generally trivial. In most cases, some error checking might have to    be removed or the algorithm used by the destructuring bind primitives    might have to be modified slightly.    Cost to Users:      None. Users already can't rely on this behavior since it varies    widely between implementations already.  Cost of Non-Adoption:  Some users would continue to incorrectly believe the behavior  was well-defined, and portability problems would result.Benefits:  People would know what to expect.Aesthetics:  Some people believe that dotted forms are ugly. Disallowing dotted forms  would make them happier.  Some people believe that there's no reason to unnecessarily restrict  &WHOLE and/or &REST since there is no computational overhead and since  the interpretation, if there is one at all, is pretty well agreed upon.  Most importantly, however, we should be clear about what we intend or allow.  If this is well-defined, we should say how.  If this is not well-defined, we should say so.Discussion:  Goldman@VAXA.ISI.EDU raised this issue on Common-Lisp.  Pitman converted Goldman's mail to this formal proposal, but some  parts had to change in the process because of some apparent confusion  in the original message about the number of arguments permitted when  an &WHOLE variable is the only variable in a lambda list. Pitman  believes you must write (&WHOLE W &REST IGNORE) in the case where  Goldman as using just (&WHOLE W).  Goldman's message seemed to suggest we adopt something similar to  DOTTED-MACRO-FORMS:ALLOW.  Pitman supports DOTTED-MACRO-FORMS:EXPLICITLY-VAGUE.*start*00758 00024 USaReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([10.0.0.11]) by Xerox.COM ; 29 JUN 88 09:32:55 PDTReceived: from hudson.dec.com by SAIL.Stanford.EDU with TCP; 29 Jun 88  09:31:52 PDTDate: 29 Jun 88 12:27:00 EDTFrom: "AITG::VANROGGEN" <vanroggen%aitg.decnet@hudson.dec.com>To: "cl-cleanup" <cl-cleanup@sail.stanford.edu>Reply-To: "AITG::VANROGGEN" <vanroggen%aitg.decnet@hudson.dec.com>Although VAX LISP happens to conform to DOTTED-MACRO-FORMS:ALLOW, Ithink making dotted macro forms be an error is the right thing to do.It's best to avoid blurring the data/code distinction too much, particularlyfor people who are new to Lisp.			---Walter------*start*03940 00024 US Originator: Common-Lisp-mailer%SAIL.Stanford:EDU:XeroxDate: 14 Jun 88 12:11From: goldman%vaxa.isi:EDU:XeroxSubject: (macro . atom)To: common-lisp%sail.stanford:EDU:XeroxReturn-Path: <Common-Lisp-mailer@SAIL.Stanford.EDU>Redistributed: Xerox-Common-Lisp^.xReceived: from SAIL.Stanford.EDU by Xerox.COM ; 14 JUN 88 12:12:03 PDTReceived: from vaxa.isi.edu by SAIL.Stanford.EDU with TCP; 14 Jun 88  11:33:05 PDTPosted-Date: Tue, 14 Jun 88 11:32:48 PDTMessage-Id: <8806141832.AA16045@vaxa.isi.edu>Received: from LOCALHOST by vaxa.isi.edu (5.54/5.51)	id AA16045; Tue, 14 Jun 88 11:32:51 PDTOriginal-Date: Tue, 14 Jun 88 11:32:48 PDTConsider the following macro definitions:		  (defmacro MACW (&whole w) `(- ,(cdr w)))		  (defmacro MACR (&rest r) `(- ,r ))and  uses of them:(a)				(MACW . 1)(b)				(MACR . 1)I tried these on 3 CL implementations, with the following results:1) Implementation 1 accepted both forms, binding w to (MACW . 1) in (a)   and r to T in (b)2) Implementation 2 treated case (a) the same as implementation 1, but    rejected (b), saying that T was not a list.3) Implementation 3 rejected both cases, saying that T was not a list.   Interestingly, it gladly accepted both forms as arguments to   MACROEXPAND-1, binding w and r the same as implementation 1.Question#1 -- what is the allowable behavior of an implementation in  the case of (MACR . T)?  Are all 3 valid?Question#2  -- what about the case of (MACW . T)?  Should my MACW code   be portable, or am I just lucky that 2 of these implementations let me   get away with it?  ----------------------------------------------------------------Relevant sections of CLtL:  On P.54, it states that only certain forms are "meaningful":self-evaluating forms, symbols, and "lists".  If (MACW . T) and (MACR . T)are "meaningful", they must be lists.  On Pp. 26-27, we have definitions of LIST and DOTTED LIST.  (My examplesare dotted lists).  In the middle of P.27 is a rather odd paragraph.  Firstit seems to say that uses of the term LIST in the book include dottedlists, and the the term "true list" will be used if dotted lists areto be excluded.  It then says that if the book specifies that anargument must be a "list",  it really means "true list"; that adotted list is an error. A discussion of Destructuring macro arguments appears on P.146 .  Itallows dotted lists as or within individual arguments in macrocalls -- e.g. (mac (foo . fum)), (mac (3 (foo . fum) 4)), and I read intothat an implication that I can expect &rest args (at least embedded ones)to bind to dotted lists or non-NIL atoms.  [I'd like to think that thereis nothing special about non-embedded &rest args -- that they, too, couldbind to dotted lists or non-NIL atoms.   But I can't say that anythingon P.146 really implies that.]P.146 also allows dotted lists in the lambda list of a macro definition, butstates that they are equivalent to something that could be written with&rest.----------------------------------------------------------------So, just what is the intent of the use of "list" on pp. 54-59?  Are dottedlists portable as macro calls?  If so, is &whole the only portable wayto accept them?  What about as function calls? [there is no &wholefor function lambda lists.]Incidentally, I believe I have a justifiable reason to want a dotted listto be acceptable as a macro form.  It would be slightly more convenientif I could use a macro lambda list with an &REST in it, rather thanresorting to &WHOLE, but that's no big deal.I would like to see the issue clarified so thata) dotted lists are legal as macro calls (but not as function calls if   that forces added run-time costs in APPLY or ordinary function calling.)b) &rest parameters in  macro lambda lists may bind to dotted lists or   non-NIL atoms.  This applies to top-level as well as embedded &rest   parameters.Neil*start*00938 00024 US Return-Path: <vanroggen%aitg.DEC@decwrl.dec.com>Received: from decwrl.dec.com ([128.45.9.1]) by Xerox.COM ; 07 JUL 88 06:52:46 PDTReceived: by decwrl.dec.com (5.54.4/4.7.34)	id AA24788; Thu, 7 Jul 88 06:52:40 PDTDate: Thu, 7 Jul 88 06:52:40 PDTMessage-Id: <8807071352.AA24788@decwrl.dec.com>From: vanroggen%aitg.DEC@decwrl.dec.comTo: masinter.paSubject: Re: (reply to message)  I don't think you should confuse what is good programming practice with what the  standard says. Good standards define unambigous behavior even in the face of bad programs.Are you saying that we should avoid the CLtL "is an error" situationsas much as possible?  Or do you think we should allow dotted macro callsbecause it could be well defined?I think just a clarification that only true list forms are legal programstructure--we shouldn't allow dotted lists or circular lists-- is all that'sneeded.			---Walter*start*01121 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([10.0.0.11]) by Xerox.COM ; 15 SEP 88 11:28:51 PDTMessage-ID: <1GbcLg@SAIL.Stanford.EDU>Date: 14 Sep 88 22:07 PDTFrom: System Files <SYS@SAIL.Stanford.EDU>Subject: Re: Issue: DOTTED-MACRO-FORMS (Version 1)Received: from Xerox.COM by SAIL.Stanford.EDU with TCP; 14 Sep 88  22:07:44 PDTReceived: from Cabernet.ms by ArpaGateway.ms ; 14 SEP 88 22:00:22 PDTDate: 14 Sep 88 22:00 PDTFrom: masinter.pa@Xerox.COMSubject: Re: Issue: DOTTED-MACRO-FORMS (Version 1)In-reply-to: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>'s message of Tue, 28 Jun 88 16:47 EDTTo: CL-Cleanup@SAIL.Stanford.EDU, goldman@VAXA.ISI.EDUMessage-ID: <880914-220022-1881@Xerox>I apparently only responded privately to Walter last July, rather than to thewhole list.I am in favor of DOTTED-MACRO-FORMS:ALLOW, with an addendum that a comment beadded to the standard where appropriate which says that such usage, whileallowed, is not good progamming practice and should be discouraged.*start*01248 00024 USaReturn-Path: <KMP@STONY-BROOK.SCRC.Symbolics.COM>Received: from STONY-BROOK.SCRC.Symbolics.COM ([128.81.41.144]) by Xerox.COM ; 20 SEP 88 20:00:16 PDTReceived: from GRYPHON.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 462902; Tue 20-Sep-88 23:00:16 EDTDate: Tue, 20 Sep 88 22:59 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Re: Issue: DOTTED-MACRO-FORMS (Version 1)To: Masinter.PAcc: CL-Cleanup@SAIL.Stanford.EDU, goldman@VAXA.ISI.EDUIn-Reply-To: <880914-220022-1881@Xerox>Message-ID: <880920225958.7.KMP@GRYPHON.SCRC.Symbolics.COM>    Date: 14 Sep 88 22:00 PDT    From: masinter.pa@Xerox.COM    ... I am in favor of DOTTED-MACRO-FORMS:ALLOW, with an addendum that    a comment be added to the standard where appropriate which says that    such usage, while allowed, is not good progamming practice and should    be discouraged.Then why not just make it "an error" (per EXPLICITLY-VAGUE) and letimplementors phase it out over a period of time they feel is comfortable?I'm generally not a fan of saying things are "legal but discouraged",and especially I don't want to get into a lot of that in a standard wewant to hang around for a while.*start*00903 00024 US Date: 21 Sep 88 00:50 PDTFrom: masinter.paSubject: Re: Issue: DOTTED-MACRO-FORMS (Version 1)In-reply-to: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>'s message of Tue, 20 Sep 88 22:59 EDTTo: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>cc: Masinter.PA, CL-Cleanup@SAIL.Stanford.EDU, goldman@VAXA.ISI.EDUThere's a category of programs that are "usually bad style except when they're not". I have a harder time defining when that is, but I think dotted macro forms falls into that category. There may be a few occasions where saying  (frob a b . c) where you know frob is a macro with an &REST argument is a good idea. I think we could allow it in the standard, it wouldn't cost any implementations any performance, I wouldn't want students normally writing their homework that way, but it might occasionally be just the right thing.But I don't care much....*start*06137 00024 US Return-Path: <goldman@vaxa.isi.edu>Received: from vaxa.isi.edu ([128.9.0.33]) by Xerox.COM ; 28 SEP 88 16:18:52 PDTPosted-Date: Wed, 28 Sep 88 15:17:11 PSTMessage-Id: <8809282317.AA00889@vaxa.isi.edu>Received: from LOCALHOST by vaxa.isi.edu (5.54/5.51)	id AA00889; Wed, 28 Sep 88 16:17:45 PDTTo: CL-Cleanup@sail.stanford.eduFrom: goldman@vaxa.isi.eduSubject: Re: Issue: DOTTED-MACRO-FORMS (Version 1)Cc: KMP@stony-brook.scrc.symbolics.com, goldman@vaxa.isi.edu, masinter.paDate: Wed, 28 Sep 88 15:17:11 PSTSender: goldman@vaxa.isi.eduFirst, thank you guys for getting this issue considered and keeping theball rolling.  Since I guess I am the one who suggested that it shouldbe dealt with,  I think I should at least state why I thought dottedmacro forms should not be outlawed out of hand.  1) Like Larry, I don't like macro extensions that encourage source codeprograms to have a "dotted list" representation.  But I don't think Iunderstand why I don't like them well enough to feel comfortablemaking them officially "discouraged".  It may be that it is only thePRINTED REPRESENTATION I don't like -- that pretty printers I have useddon't seem to format them the way I would choose to, and that the "."doesn't stand out sufficiently and I miss it when looking at theprinted representation.2) The situation that brought this issue to my attention had to do withprograms generated not by people, but by an "automatic programmer"(or a hairy set of macros, if you prefer a more earthy characterization.)The dotted macro form was not intended to ever be written or seen by ahuman programmer; just processed by the compiler if it happened to beproduced by these other macros.  Here is a synopsis.  See if you thinkit meets Larry's characterization as "occasionally ... just the right thing.":Our automatic programmer produces and compiles high-level queries to adatabase.  A query is representated by a well-formed-formula (WFF).  Aprimitive WFF consists of a list -- (<relation-name> arg1 ... argn) --e.g. (GRADE student course grade).These primitive WFFs can be negated, combined with AND and OR, andembedded in quantifiers.  So a compound WFF might be:"did s1 outperform s2 in any course?" (exists (course g1 g2) (AND (GRADE s1 course g1)	                     (GRADE s2 course g2)	                     (GRADE> g1 g2)))The syntax we chose for posing a query to the database from a lisp programis (?? . WFF).  Notice that the syntax for WFFs guarantees that they areall pure lists, so (?? . WFF) will never be a dotted macro form.[WFFs are also used in many other parts of our embedded language.]We also have a "simplifier" for wffs.  It is logically possible fora wff to be simplifiable to the point that its truth is independent of thecontents of the database -- e.g.,  (OR (GRADE s c g) (NOT (GRADE s c g)))is tautologically true, while other WFFs might be provably true or falsebased on reasoning about constraints known about the data.  We neededto represent two logical constants, and we chose to represent them bythe symbols TRUE and FALSE.  It turns out that these logical constants madesense wherever WFFs made sense; in particular,   (?? . TRUE)is a perfectly fine query; it is one that no programmer would everwrite DIRECTLY, but might be produced by some automatic programmer tool.We defined the macroexpander for ?? so that (?? . TRUE) macroexpands to T,and (?? . FALSE) to NIL.  But now we had introduced the possibiltiy ofdotted macro forms, and discovered, when testing, that various implementationswere inconsistent (sometimes even self-inconsistent) in their treatment ofthese forms.3) I don't remember whether I ever expressed my opinion on how this issuewould be best resolved.  My apologies if the following is a repetition ofan earlier submission.  I do think that support for portable dotted macros should be provided.I don't think it would be so bad (in fact, I think it would be GOOD) ifthe "normal" case (the macro cannot be correctly used with a dottedargument list) caused dotted lists to be caught and an error signalled byLisp's macroexpander, rather than expecting the programmer's expansioncode detect it.  Pragmatically, I believe that most macros written with &rest are NOTprepared to deal with "dotted" lists in the &rest variable (or atomic, non-nil, values of the &rest variable).  If invoked with the &rest variableso bound, these macroexpanders will almost invariably eithera) produce an expansion which will propogate the dotted argument list   to another macro or function (postponing detection of the error), orb) cause an expansion-time error by doing car/cdr on a non list,   which the programmer will trace back to being caused by the dotted argument   list, orc) (by poor programming) terminate cdring down the &rest list with a consp   test  nstead of an endp check, masking the error entirely.If LISP were REQUIRED to signal an error when an &rest macro parameter"matched" a dotted list, or non-nil atom, then macro writers would nothave to check the condition themselves to get good error messages.However, a declaration could be provided:      (defmacro foo (x &optional y &rest z)		(declare (allow-dotted z))	...)in which case an error would NOT be signalled on (foo x1 y1 z1 . z2)I have not seen many actual uses of &WHOLE.  Certainly the same declaration could be used to control whether or not and &WHOLE parametercould bind to a dotted list.  Is there anything about the use of &WHOLEthat would lead you to expect its "normal" usage would make a default of"dotted lists are an error" less reasonable than for &rest ?For instance, if it is mostly used in the idiom:   (defmacro MW (&whole form)     <record something about form>     `(MW-INTERNAL ,. (rest form)))where MW-INTERNAL is another macro, then it would bebetter to let MW-INTERNAL be responsible for controlling whetherdotted arglists were acceptable, and never complain about binding themto &WHOLE parameters.----------------------------------------------------------------Neil*start*04456 00024 UU?Sender: Common-Lisp-mailer%SAIL.Stanford:EDU:XeroxDate:  1 Oct 88 15:19From: masinter:PA:XeroxSubject: Issue: DOTTED-MACRO-FORMS (Version 2)To: Common-Lisp%sail.stanford:EDU:Xeroxcc: goldman%vaxa.isi:EDU:XeroxReturn-Path: <Common-Lisp-mailer@SAIL.Stanford.EDU>Redistributed: Xerox-Common-Lisp^.xReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 01 OCT 88 15:19:12 PDTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 1 Oct 88  14:49:47 PDTReceived: from Salvador.ms by ArpaGateway.ms ; 01 OCT 88 14:47:21 PDTOriginal-Date: 1 Oct 88 14:47 PDTMessage-ID: <881001-144721-2149@Xerox>Well, there is a large cost associated with adding another declaration thathas semantic import. Didn't we have some issue about whether(EQ L (APPLY #'(LAMBDA (&REST X) X)  L))and was(APPLY #'(LAMBDA (&REST X) X)  '(A B . C))an error?although I forget its name offhand. Isn't this related? I.e., can't weassume that argument lists don't end in dotted pairs?I'd hope that they'd be resolved consistantly. My implementor's hat wouldlike to see APPLY have the ability to spread its arguments and make &RESTcons if it had to. Somewhat inconsistent with my original opinion on dottedmacros.I guess I wasn't convinced by Neil's example, so I think I'm going tosupport :DISALLOW.!Issue:        DOTTED-MACRO-FORMSReferences:   forms (p54), lists and dotted lists (pp26-27),	      DEFMACRO (p145), destructuring macro arguments (p146)Category:     CLARIFICATIONEdit history: 28-Jun-88, Version 1 by Pitman			 1-Oct-88, Version 2 by MasinterProblem Description:  CLtL is not explicit about whether macro forms may be dotted lists.  p54 says that only certain forms are "meaningful": self-evaluating   forms, symbols, and "lists".  pp26-27 defines "list" and "dotted list". It goes on to say   ``Throughout this manual, unless otherwise specified, it is an   error to pass a dotted list to a function that is specified   to require a list as an argument.''  p146 states that in DEFMACRO destructuring, ``the argument   form that would match the parameter is treated as a   (possibly dotted) list, to be used as an argument forms list   for satisfying the parameters in the embedded lambda list.''   It goes on to say that ". var" is treated like "&rest var"   at any level of the defmacro lambda-list.Proposal (DOTTED-MACRO-FORMS:DISALLOW): Specify that it is an error for a macro form to be a dotted list.Rationale:      Dotted lists are a possible symptom of program syntax error.    Allowing implementations to check for this error may catch enough    errors to justify the loss of program flexibility.Test Case:  #1: (DEFMACRO MACW (&WHOLE W &REST R) `(- ,(CDR W)))      (MACW . 1) => ??  #2: (DEFMACRO MACR (&REST R) `(- ,R))      (MACR . 1) => ??  #3: (DEFMACRO MACX (&WHOLE W) `(- ,(CDR W)))      (MACX . 1)    (MACW . 1) would be an error under this proposal.    (MACR . 1) would be an error under this proposal.Current Practice:  A. Some implementations bind W to (MACW . 1) in #1 and #3   		      and bind R to 1 in #1 and #2.  B. Some implementations bind W to (MACW . 1) in #3		      and signal a syntax error in #1 and #2.  C. Some implementations signal a syntax error in #1, #2, and #3.     Symbolics Genera is such an implementation.Cost to Implementors:  As written, this proposal doesn't require implementations to check forthe error condition.  Cost to Users:   Some users depend on this behavior in current implementations, althoughsuch use is not widespread.  Benefits: People would know what to expect.Aesthetics:Mixed opinion; certainly it is better to specify whether they are allowed or an error than to be vague. Some feel that disallowing dotted macroforms makes the language cleaner.Discussion: Goldman@VAXA.ISI.EDU raised this issue on Common-Lisp.This issue came up primarily in the context of program-written programs;a macro used in the program generated code might occasionally usea dotted tail to a list to explicitly represent special conditions. Allowing dotted macro forms may blur the data/code distinction too much, particularly for people who are new to Lisp.Some people believe that there's no reason to unnecessarily restrict&WHOLE and/or &REST since there is no computational overhead and sincethe interpretation, if there is one at all, is pretty well agreed upon.*start*02156 00024 US Sender: Common-Lisp-mailer%SAIL.Stanford:EDU:XeroxDate:  2 Oct 88 19:31From: KMP%STONY-BROOK.SCRC.Symbolics:COM:XeroxSubject: Issue: DOTTED-MACRO-FORMS (Version 2)In-Reply-to: <881001-144721-2149@Xerox>To: masinter:PA:Xeroxcc: Common-Lisp%sail.stanford:EDU:Xerox, goldman%vaxa.isi:EDU:XeroxGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: DOTTED-MACRO-FORMS (Version 2)To: masinter.pacc: Common-Lisp@sail.stanford.edu, goldman@vaxa.isi.eduIn-Reply-To: <881001-144721-2149@Xerox>Return-Path: <Common-Lisp-mailer@SAIL.Stanford.EDU>Redistributed: Xerox-Common-Lisp^.xReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 02 OCT 88 19:31:30 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 2 Oct 88  19:08:53 PDTReceived: from GRYPHON.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 469179; Sun 2-Oct-88 22:07:31 EDTOriginal-Date: Sun, 2 Oct 88 22:06 EDTMessage-ID: <881002220656.7.KMP@GRYPHON.SCRC.Symbolics.COM>GVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVI'm pretty neutral on this issue.I agree Goldman's example is not very compelling. I don't seeany reason not to have done (?? WFF) rather than (?? . WFF).On the other hand, I think macro forms are "expressions outsidethe language" which the macro facility is responsible fortranslating to "forms", so I could buy a little flexibility here.But in the end there's little call for this and I think theerror checking arguments win out.Then again, disallowing dotted lists will make &REST etc. seemmore like they are in functions. There was a deliberate attemptto make these very syntactically similar in other ways, and Ithink it's worth carrying through on it.Since I could go for it either way, but I'm quite content withyour decision to present only the DISALLOW option (which I guessis effectively the same as what I called EXPLICITLY-VAGUE in theprevious writeup ... I guess you've been taking lessons from thepolitical campaigns on "spin control" ...).*start*01598 00024 US Return-Path: <KMP@STONY-BROOK.SCRC.Symbolics.COM>Received: from STONY-BROOK.SCRC.Symbolics.COM ([128.81.41.144]) by Xerox.COM ; 02 OCT 88 19:07:19 PDTReceived: from GRYPHON.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 469179; Sun 2-Oct-88 22:07:31 EDTDate: Sun, 2 Oct 88 22:06 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: DOTTED-MACRO-FORMS (Version 2)To: masinter.pacc: Common-Lisp@sail.stanford.edu, goldman@vaxa.isi.eduIn-Reply-To: <881001-144721-2149@Xerox>Message-ID: <881002220656.7.KMP@GRYPHON.SCRC.Symbolics.COM>I'm pretty neutral on this issue.I agree Goldman's example is not very compelling. I don't seeany reason not to have done (?? WFF) rather than (?? . WFF).On the other hand, I think macro forms are "expressions outsidethe language" which the macro facility is responsible fortranslating to "forms", so I could buy a little flexibility here.But in the end there's little call for this and I think theerror checking arguments win out.Then again, disallowing dotted lists will make &REST etc. seemmore like they are in functions. There was a deliberate attemptto make these very syntactically similar in other ways, and Ithink it's worth carrying through on it.Since I could go for it either way, but I'm quite content withyour decision to present only the DISALLOW option (which I guessis effectively the same as what I called EXPLICITLY-VAGUE in theprevious writeup ... I guess you've been taking lessons from thepolitical campaigns on "spin control" ...).*start*03135 00024 US Sender: Common-Lisp-mailer%SAIL.Stanford:EDU:XeroxDate:  3 Oct 88 13:44From: goldman%vaxa.isi:EDU:XeroxSubject: [Re: Issue: DOTTED-MACRO-FORMS (Version 2)]To: Common-Lisp%sail.stanford:EDU:Xeroxcc: masinter:PA:XeroxReturn-Path: <Common-Lisp-mailer@SAIL.Stanford.EDU>Redistributed: Xerox-Common-Lisp^.xReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 03 OCT 88 13:19:09 PDTReceived: from vaxa.isi.edu by SAIL.Stanford.EDU with TCP; 3 Oct 88  12:50:08 PDTPosted-Date: Mon, 03 Oct 88 11:48:31 PSTMessage-Id: <8810031948.AA20503@vaxa.isi.edu>Received: from LOCALHOST by vaxa.isi.edu (5.54/5.51)	id AA20503; Mon, 3 Oct 88 12:48:38 PDTOriginal-Date: Mon, 03 Oct 88 11:48:31 PST     Well, there is a large cost associated with adding another declaration      that has semantic import. I understand why adding declarations WITHOUT semantic import is alwayseasy on implementors.  But I don't understand how adding declarationsWITH semantic import is necessarily costly for them.  In particular, sincepeople whom I assume to be knowledgeable stated that it would be trivialform implementations to either accept or reject dotted macro forms, I don'tsee why a user declaration to control this on a per macro basis wouldbe very costly for them.  In particular, why would it be any more costlythan any other clarification of the dotted macro issue?  (Except for specifyingthat "it is an error" rather than "an error is signalled", whichwould let all the implementors continue to be inconsistent, but has noother redeeming characteristics in this situation.)   Didn't we have some issue about whether   (APPLY #'(LAMBDA (&REST X) X)  '(A B . C))   an error? although I forget its name offhand. Isn't this related? I.e.,    can't we assume that argument lists don't end in dotted pairs?Since it is not legal to APPLY macros, and since macro lambda lists alreadyhave a syntax that allows things NOT allowed in lambda lists ofAPPLYable lambda, the resolution of one issue doesn't NECESSARILY tellus how to resolve the other.However, I would very definitely see a virtue in having the languagedefined so that it was guaranteed that whenever I saw an &REST variableit was guaranteed to be bound to a non-dotted list (or NIL).I wouldn't be terribly bothered by totally outlawing dotted argument lists,if it were done uniformly (although I would prefer that they be allowedin cases where the programmer explicitly indicated a willingness toaccept them.)  But, unless I misunderstood the :DISALLOW proposal,only top-level dotted lists are disallowed.  One could still write		     (MY-MACRO (x . :all) (foo x) (fum x))where the dotted argument is not at the top level, andreceive the parameters with either   (var-and-control &body forms)or with   ((var . control) &body forms)or even    ((var &rest control) &body forms)which binds the &rest to (x . :all).Why are top-level dotted argument lists so much more objectionable thanembedded ones, so that it makes you want to have a different semantics forthe embedded lambda lists in the macro syntax?Neil*start*02922 00024 US Return-Path: <goldman@vaxa.isi.edu>Received: from vaxa.isi.edu ([128.9.0.33]) by Xerox.COM ; 03 OCT 88 12:48:53 PDTPosted-Date: Mon, 03 Oct 88 11:48:31 PSTMessage-Id: <8810031948.AA20503@vaxa.isi.edu>Received: from LOCALHOST by vaxa.isi.edu (5.54/5.51)	id AA20503; Mon, 3 Oct 88 12:48:38 PDTTo: Common-Lisp@sail.stanford.eduFrom: goldman@vaxa.isi.eduSubject: [Re: Issue: DOTTED-MACRO-FORMS (Version 2)]Cc: masinter.paDate: Mon, 03 Oct 88 11:48:31 PSTSender: goldman@vaxa.isi.edu     Well, there is a large cost associated with adding another declaration      that has semantic import. I understand why adding declarations WITHOUT semantic import is alwayseasy on implementors.  But I don't understand how adding declarationsWITH semantic import is necessarily costly for them.  In particular, sincepeople whom I assume to be knowledgeable stated that it would be trivialform implementations to either accept or reject dotted macro forms, I don'tsee why a user declaration to control this on a per macro basis wouldbe very costly for them.  In particular, why would it be any more costlythan any other clarification of the dotted macro issue?  (Except for specifyingthat "it is an error" rather than "an error is signalled", whichwould let all the implementors continue to be inconsistent, but has noother redeeming characteristics in this situation.)   Didn't we have some issue about whether   (APPLY #'(LAMBDA (&REST X) X)  '(A B . C))   an error? although I forget its name offhand. Isn't this related? I.e.,    can't we assume that argument lists don't end in dotted pairs?Since it is not legal to APPLY macros, and since macro lambda lists alreadyhave a syntax that allows things NOT allowed in lambda lists ofAPPLYable lambda, the resolution of one issue doesn't NECESSARILY tellus how to resolve the other.However, I would very definitely see a virtue in having the languagedefined so that it was guaranteed that whenever I saw an &REST variableit was guaranteed to be bound to a non-dotted list (or NIL).I wouldn't be terribly bothered by totally outlawing dotted argument lists,if it were done uniformly (although I would prefer that they be allowedin cases where the programmer explicitly indicated a willingness toaccept them.)  But, unless I misunderstood the :DISALLOW proposal,only top-level dotted lists are disallowed.  One could still write		     (MY-MACRO (x . :all) (foo x) (fum x))where the dotted argument is not at the top level, andreceive the parameters with either   (var-and-control &body forms)or with   ((var . control) &body forms)or even    ((var &rest control) &body forms)which binds the &rest to (x . :all).Why are top-level dotted argument lists so much more objectionable thanembedded ones, so that it makes you want to have a different semantics forthe embedded lambda lists in the macro syntax?Neil*start*03856 00024 UU?Date:  8 Oct 88 16:15 PDTSender: masinter.paSubject: DRAFT Issue: DOTTED-MACRO-FORMS (Version 2)From: cl-cleanup@sail.stanford.eduTo: x3j13@sail.stanford.eduREPLY-TO: cl-cleanup@sail.stanford.eduline-fold: NOcc: MasinterThe cleanup committee (and individual members of the committee)have mixed opinions about this issue.Issue:        DOTTED-MACRO-FORMSReferences:   forms (p54), lists and dotted lists (pp26-27),	      DEFMACRO (p145), destructuring macro arguments (p146)Category:     CLARIFICATIONEdit history: 28-Jun-88, Version 1 by Pitman			 1-Oct-88, Version 2 by MasinterProblem Description:  CLtL is not explicit about whether macro forms may be dotted lists.  p54 says that only certain forms are "meaningful": self-evaluating   forms, symbols, and "lists".  pp26-27 defines "list" and "dotted list". It goes on to say   ``Throughout this manual, unless otherwise specified, it is an   error to pass a dotted list to a function that is specified   to require a list as an argument.''  p146 states that in DEFMACRO destructuring, ``the argument   form that would match the parameter is treated as a   (possibly dotted) list, to be used as an argument forms list   for satisfying the parameters in the embedded lambda list.''   It goes on to say that ". var" is treated like "&rest var"   at any level of the defmacro lambda-list.Proposal (DOTTED-MACRO-FORMS:DISALLOW): Specify that it is an error for a macro form to be a dotted list.Rationale:      Dotted lists are a possible symptom of program syntax error.    Allowing implementations to check for this error may catch enough    errors to justify the loss of program flexibility.Test Case:  #1: (DEFMACRO MACW (&WHOLE W &REST R) `(- ,(CDR W)))      (MACW . 1) => ??  #2: (DEFMACRO MACR (&REST R) `(- ,R))      (MACR . 1) => ??  #3: (DEFMACRO MACX (&WHOLE W) `(- ,(CDR W)))      (MACX . 1)    (MACW . 1) would be an error under this proposal.    (MACR . 1) would be an error under this proposal.Current Practice:  A. Some implementations bind W to (MACW . 1) in #1 and #3   		      and bind R to 1 in #1 and #2.  B. Some implementations bind W to (MACW . 1) in #3		      and signal a syntax error in #1 and #2.  C. Some implementations signal a syntax error in #1, #2, and #3.     Symbolics Genera is such an implementation.Cost to Implementors:  As written, this proposal doesn't require implementations to check forthe error condition.  Cost to Users:   Some users depend on this behavior in current implementations, althoughsuch use is not widespread.  Benefits: People would know what to expect.Aesthetics:Mixed opinion; certainly it is better to specify whether they are allowed or an error than to be vague. Some feel that disallowing dotted macroforms makes the language cleaner.Discussion: Goldman@VAXA.ISI.EDU raised this issue on Common-Lisp.This issue came up primarily in the context of program-written programs;a macro used in the program generated code might occasionally usea dotted tail to a list to explicitly represent special conditions. Allowing dotted macro forms may blur the data/code distinction too much, particularly for people who are new to Lisp.Some people believe that there's no reason to unnecessarily restrict&WHOLE and/or &REST since there is no computational overhead and sincethe interpretation, if there is one at all, is pretty well agreed upon.- - - - - - - - Additional Discussion - - - - - -Allow them only with a declaration?This is an issue of error-checking vs flexibility, we think.There is a consistency argument: dotted arguments are definitelydisallowed in function argument lists, and almost certainly allowedin embedded macro arguments; which should the top-level macroargument lists be consistent with?*start*04180 00024 UU?Return-Path: <X3J13-mailer@SAIL.Stanford.EDU>Received: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 08 OCT 88 17:05:30 PDTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 8 Oct 88  16:50:41 PDTReceived: from Semillon.ms by ArpaGateway.ms ; 08 OCT 88 16:15:32 PDTDate: 8 Oct 88 16:15 PDTSender: masinter.paSubject: DRAFT Issue: DOTTED-MACRO-FORMS (Version 2)From: cl-cleanup@sail.stanford.eduTo: x3j13@sail.stanford.eduREPLY-TO: cl-cleanup@sail.stanford.eduline-fold: NOcc: Masinter.paMessage-ID: <881008-161532-2307@Xerox>The cleanup committee (and individual members of the committee)have mixed opinions about this issue.!Issue:        DOTTED-MACRO-FORMSReferences:   forms (p54), lists and dotted lists (pp26-27),	      DEFMACRO (p145), destructuring macro arguments (p146)Category:     CLARIFICATIONEdit history: 28-Jun-88, Version 1 by Pitman			 1-Oct-88, Version 2 by MasinterProblem Description:  CLtL is not explicit about whether macro forms may be dotted lists.  p54 says that only certain forms are "meaningful": self-evaluating   forms, symbols, and "lists".  pp26-27 defines "list" and "dotted list". It goes on to say   ``Throughout this manual, unless otherwise specified, it is an   error to pass a dotted list to a function that is specified   to require a list as an argument.''  p146 states that in DEFMACRO destructuring, ``the argument   form that would match the parameter is treated as a   (possibly dotted) list, to be used as an argument forms list   for satisfying the parameters in the embedded lambda list.''   It goes on to say that ". var" is treated like "&rest var"   at any level of the defmacro lambda-list.Proposal (DOTTED-MACRO-FORMS:DISALLOW): Specify that it is an error for a macro form to be a dotted list.Rationale:      Dotted lists are a possible symptom of program syntax error.    Allowing implementations to check for this error may catch enough    errors to justify the loss of program flexibility.Test Case:  #1: (DEFMACRO MACW (&WHOLE W &REST R) `(- ,(CDR W)))      (MACW . 1) => ??  #2: (DEFMACRO MACR (&REST R) `(- ,R))      (MACR . 1) => ??  #3: (DEFMACRO MACX (&WHOLE W) `(- ,(CDR W)))      (MACX . 1)    (MACW . 1) would be an error under this proposal.    (MACR . 1) would be an error under this proposal.Current Practice:  A. Some implementations bind W to (MACW . 1) in #1 and #3   		      and bind R to 1 in #1 and #2.  B. Some implementations bind W to (MACW . 1) in #3		      and signal a syntax error in #1 and #2.  C. Some implementations signal a syntax error in #1, #2, and #3.     Symbolics Genera is such an implementation.Cost to Implementors:  As written, this proposal doesn't require implementations to check forthe error condition.  Cost to Users:   Some users depend on this behavior in current implementations, althoughsuch use is not widespread.  Benefits: People would know what to expect.Aesthetics:Mixed opinion; certainly it is better to specify whether they are allowed or an error than to be vague. Some feel that disallowing dotted macroforms makes the language cleaner.Discussion: Goldman@VAXA.ISI.EDU raised this issue on Common-Lisp.This issue came up primarily in the context of program-written programs;a macro used in the program generated code might occasionally usea dotted tail to a list to explicitly represent special conditions. Allowing dotted macro forms may blur the data/code distinction too much, particularly for people who are new to Lisp.Some people believe that there's no reason to unnecessarily restrict&WHOLE and/or &REST since there is no computational overhead and sincethe interpretation, if there is one at all, is pretty well agreed upon.- - - - - - - - Additional Discussion - - - - - -Allow them only with a declaration?This is an issue of error-checking vs flexibility, we think.There is a consistency argument: dotted arguments are definitelydisallowed in function argument lists, and almost certainly allowedin embedded macro arguments; which should the top-level macroargument lists be consistent with?*start*01256 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 13 OCT 88 13:30:17 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 13 Oct 88  13:29:34 PDTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 475817; Thu 13-Oct-88 16:28:04 EDTDate: Thu, 13 Oct 88 16:27 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: DOTTED-MACRO-FORMS (Version 2)To: CL-Cleanup@SAIL.Stanford.EDUMessage-ID: <881013162756.2.KMP@BOBOLINK.SCRC.Symbolics.COM>My notes from Fairfax meeting...Cleanup meeting: Steele did some poking around in CLtL and verified that indeed, dotted lists are explicitly permitted at recursive levels of DEFMACRO destructuring. As such, it was decided that the most consistent approach would be to require them to be permitted at toplevel as well. KMP will write next draft of this issue, changing the sense as agreed.X3J13 meeting: JonL: Gratuitous: We shouldn't take any action that would cause work for       either users or implementors without substantial potential gain.*start*01086 00024 USaReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 13 OCT 88 13:43:03 PDTReceived: from cs.utah.edu by SAIL.Stanford.EDU with TCP; 13 Oct 88  13:43:13 PDTReceived: by cs.utah.edu (5.54/utah-2.0-cs)	id AA19231; Thu, 13 Oct 88 14:41:36 MDTReceived: by defun.utah.edu (5.54/utah-2.0-leaf)	id AA19850; Thu, 13 Oct 88 14:41:32 MDTFrom: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8810132041.AA19850@defun.utah.edu>Date: Thu, 13 Oct 88 14:41:31 MDTSubject: issue DOTTED-MACRO-FORMSTo: cl-cleanup@sail.stanford.eduI had a hard time initially understanding this writeup because itwasn't clear to me that "macro form" was being used to describe what Iwould term a "macro call".  How about calling it "macro call form" orsomething like that? The wording of the proposal suggests that (MACX . 1) is also supposedto be an error, but the test case section says only that the other twoexamples are in error.  Please clarify.-Sandra-------*start*00931 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 31 OCT 88 18:44:22 PSTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 31 Oct 88  18:42:55 PSTReceived: from Semillon.ms by ArpaGateway.ms ; 31 OCT 88 11:24:14 PSTDate: 31 Oct 88 11:22 PSTFrom: masinter.paSubject: Re: issue DOTTED-MACRO-FORMSIn-reply-to: sandra%defun@cs.utah.edu (Sandra J Loosemore)'s message of Thu, 13 Oct 88 14:41:31 MDTTo: sandra%defun@cs.utah.edu (Sandra J Loosemore)cc: cl-cleanup@sail.stanford.eduMessage-ID: <881031-112414-6056@Xerox>I think we decided in the cleanup meeting to explicitly allow dotted listsin macro calls; self-consistency of macros and macro expansions seemed moreimportant than consistency of macro expansion with function call.Kent is supposed to produce a new draft of this issue....*start*05140 00024 USfReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 15 NOV 88 15:43:17 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 15 Nov 88  15:39:02 PSTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 493088; Tue 15-Nov-88 18:38:58 ESTDate: Tue, 15 Nov 88 18:38 ESTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: DOTTED-MACRO-FORMS (Version 3)To: CL-Cleanup@SAIL.Stanford.EDUMessage-ID: <881115183844.8.KMP@BOBOLINK.SCRC.Symbolics.COM>Issue:        DOTTED-MACRO-FORMSReferences:   forms (p54), lists and dotted lists (pp26-27),	      DEFMACRO (p145), destructuring macro arguments (p146)Category:     CLARIFICATION/CHANGEEdit history: 28-Jun-88, Version 1 by Pitman   (explicitly-vague vs allow)	      01-Oct-88, Version 2 by Masinter (disallow)	      15-Nov-88, Version 3 by Pitman   (revive allow, flush disallow)Problem Description:  CLtL is not explicit about whether macro forms may be dotted lists.  p54 says that only certain forms are "meaningful": self-evaluating   forms, symbols, and "lists".  pp26-27 defines "list" and "dotted list". It goes on to say   ``Throughout this manual, unless otherwise specified, it is an   error to pass a dotted list to a function that is specified   to require a list as an argument.''  p146 states that in DEFMACRO destructuring, ``the argument   form that would match the parameter is treated as a   (possibly dotted) list, to be used as an argument forms list   for satisfying the parameters in the embedded lambda list.''   It goes on to say that ". var" is treated like "&rest var"   at any level of the defmacro lambda-list.Proposal (DOTTED-MACRO-FORMS:ALLOW): Define that it is permissible for a macro form (or subform) to be a dotted list when "&REST var" or ". var" is used to match it. It is the responsibility of the macro to recognize and deal with such situations.Rationale:   Some implementations permit dotted lists in macro forms at toplevel. Most or all implementations permit dotted lists in macro forms at embedded levels. This proposal makes the language internally consistent without requiring changes to existing code. Also, there's no reason to unnecessarily restrict &REST since there is no computational overhead and since there's no dispute about how to interpret programmer intent in this gray area.Test Case:  #1: (DEFMACRO MACW (&WHOLE W &REST R) `(- ,(CDR W)))      (MACW . 1) => ??  #2: (DEFMACRO MACR (&REST R) `(- ,R))      (MACR . 1) => ??  #3: (DEFMACRO MACX (&WHOLE W) `(- ,(CDR W)))      (MACX . 1)    (MACW . 1) => -1 under this proposal.    (MACR . 1) => -1 under this proposal.    (MACX . 1) is an error under CLtL semantics and is not	       changed by this proposal. The reason it is an	       error is that the argument pattern does not	       match. The pattern is dictated by the arguments	       -other than- the &WHOLE argument, so the pattern	       is () and MACX cannot be called with any arguments.Current Practice:  A. Some implementations bind W to (MACW . 1) in #1 and #3   		      and bind R to 1 in #1 and #2.  B. Some implementations bind W to (MACW . 1) in #3		      and signal a syntax error in #1 and #2.  C. Some implementations signal a syntax error in #1, #2, and #3.     Symbolics Genera is such an implementation.Cost to Implementors:   Some implementations would have to eliminate an error check. Some implementations which try to use APPLY of a normal lambda to accomplish part of the destructuring (in the non-recursive case) would have to be slightly more careful.  Cost to Users:   None. This change is upward compatible.  Benefits: People would know what to expect.Aesthetics: Mixed opinion: certainly it is better to specify whether they are allowed or an error than to be vague. Some feel that disallowing dotted macro forms helps catch syntax errors. Some feel that allowing dotted macro forms makes the language more regular.Discussion: Goldman@VAXA.ISI.EDU raised this issue on Common-Lisp. This issue came up primarily in the context of program-written programs; a macro used in the program generated code might occasionally use a dotted tail to a list to explicitly represent special conditions.  Allowing dotted macro forms may blur the data/code distinction too much,  particularly for people who are new to Lisp. On the other hand, some people argue that the point of macros is to help blur that distinction. Macro forms are data which must be translated to program, and only once the program claims to be macroexpanded ought syntax restrictions be imposed. This proposal was rewritten from `DISALLOW' to `ALLOW' after Steele pointed out in a recent meeting that dotted lists are allowed in subforms and  that permitting them at toplevel would be the most internally consistent interpretation. Pitman supports DOTTED-MACRO-FORMS:ALLOW.*start*01621 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 18 NOV 88 00:23:19 PSTReceived: from RELAY.CS.NET by SAIL.Stanford.EDU with TCP; 18 Nov 88  00:21:43 PSTReceived: from relay2.cs.net by RELAY.CS.NET id am17791; 18 Nov 88 0:54 ESTReceived: from draper.com by RELAY.CS.NET id ac02405; 17 Nov 88 15:51 ESTDate: Thu, 17 Nov 88 08:22 ESTFrom: "Steve Bacher (Batchman)" <SEB1525@draper.com>Subject: Re: Issue DOTTED-MACRO-FORMSTo: cl-cleanup@SAIL.STANFORD.EDUX-VMS-To: IN%"cl-cleanup@sail.stanford.edu",SEB1525Sounds like a good idea to me.  In fact, I think it would be useful to allowdotted function invocation forms.  It would make it simpler to code functionslike this:  (defun send-formatted-message (format-text &rest format-args)  (internal-send-message (apply #'format nil format-text format-args))) Why not be able to say  (defun send-formatted-message (format-text &rest format-args)  (internal-send-message (format nil format-text . format-args))) This would be meaningful only for functions that are defined to take &REST args,of course.   I suppose this is reminiscent of the old controversy about destructuring infunction lambda lists (which my implementation supports, mainly because itwould be a PITA to have the destructuring code arbitrarily signal an errorjust because it was parsing a DEFUN lambda list instead of a DEFMACROlambda list).  But I still think this is useful.  Sure, a compiler couldoptimize the (apply #'...), but why should it have to?*start*01374 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 21 NOV 88 11:20:48 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 21 Nov 88  11:19:12 PSTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 495962; Mon 21-Nov-88 14:19:10 ESTDate: Mon, 21 Nov 88 14:19 ESTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Re: Issue DOTTED-MACRO-FORMSTo: SEB1525@draper.comcc: CL-Cleanup@SAIL.Stanford.EDUIn-Reply-To: The message of 17 Nov 88 08:22 EST from "Steve Bacher (Batchman)" <SEB1525@draper.com>Message-ID: <881121141923.7.KMP@BOBOLINK.SCRC.Symbolics.COM>    Date: Thu, 17 Nov 88 08:22 EST    From: "Steve Bacher (Batchman)" <SEB1525@draper.com>    ... Why not be able to say ... (format nil format-text . format-args) ... People ask for this a lot. It would be fun in the situations where it works,but it's too error-prone. People like the ability to substitute one expressionfor another in an evaluable position. Consider, then, what happens if yousubstitute `(cons 'x format-args)' for `format-args' in the above expression: (format nil format-text . (cons 'x format-args)) >>Error: Unbound variable: CONS*start*05090 00024 US Date:  7 Dec 88 17:11 PSTSender: masinter.pato: x3j13@sail.stanford.eduSubject: Issue: DOTTED-MACRO-FORMS (Version 3)from: cl-cleanup@sail.stanford.edureply-to: cl-cleanup@sail.stanford.educc: masinterline-fold: noAt the cleanup committee meeting prior in Fairfax, we decided to propose this version.Issue:        DOTTED-MACRO-FORMSReferences:   forms (p54), lists and dotted lists (pp26-27),	      DEFMACRO (p145), destructuring macro arguments (p146)Category:     CLARIFICATION/CHANGEEdit history: 28-Jun-88, Version 1 by Pitman   (explicitly-vague vs allow)	      01-Oct-88, Version 2 by Masinter (disallow)	      15-Nov-88, Version 3 by Pitman   (revive allow, flush disallow)Problem Description:  CLtL is not explicit about whether macro forms may be dotted  lists.  p54 says that only certain forms are "meaningful": self-evaluating   forms, symbols, and "lists".  pp26-27 defines "list" and "dotted list". It goes on to say   ``Throughout this manual, unless otherwise specified, it is an   error to pass a dotted list to a function that is specified   to require a list as an argument.''  p146 states that in DEFMACRO destructuring, ``the argument   form that would match the parameter is treated as a   (possibly dotted) list, to be used as an argument forms list   for satisfying the parameters in the embedded lambda list.''   It goes on to say that ". var" is treated like "&rest var"   at any level of the defmacro lambda-list.Proposal (DOTTED-MACRO-FORMS:ALLOW): Define that it is permissible for a macro form (or subform) to be a dotted list when "&REST var" or ". var" is used to match it. It is the responsibility of the macro to recognize and deal with such situations.Rationale:   Some implementations permit dotted lists in macro forms at toplevel. Most or all implementations permit dotted lists in macro forms at embedded levels. This proposal makes the language internally consistent without requiring changes to existing code. Also, there's no reason to unnecessarily restrict &REST since there is no computational overhead and since there's no dispute about how to interpret programmer intent in this gray area.Test Case:  #1: (DEFMACRO MACW (&WHOLE W &REST R) `(- ,(CDR W)))      (MACW . 1) => ??  #2: (DEFMACRO MACR (&REST R) `(- ,R))      (MACR . 1) => ??  #3: (DEFMACRO MACX (&WHOLE W) `(- ,(CDR W)))      (MACX . 1)    (MACW . 1) => -1 under this proposal.    (MACR . 1) => -1 under this proposal.    (MACX . 1) is an error under CLtL semantics and is not	       changed by this proposal. The reason it is an	       error is that the argument pattern does not	       match. The pattern is dictated by the arguments	       -other than- the &WHOLE argument, so the pattern	       is () and MACX cannot be called with any arguments.Current Practice:  A. Some implementations bind W to (MACW . 1) in #1 and #3   		      and bind R to 1 in #1 and #2.  B. Some implementations bind W to (MACW . 1) in #3		      and signal a syntax error in #1 and #2.  C. Some implementations signal a syntax error in #1, #2, and #3.     Symbolics Genera is such an implementation.Cost to Implementors:   Some implementations would have to eliminate an error check. Some implementations which try to use APPLY of a normal lambda to accomplish part of the destructuring (in the non-recursive case) would have to be slightly more careful.  Cost to Users:   None. This change is upward compatible.  Benefits: People would know what to expect.Aesthetics: Mixed opinion: certainly it is better to specify whether they are allowed or an error than to be vague. Some feel that disallowing dotted macro forms helps catch syntax errors. Some feel that allowing dotted macro forms makes the language more regular.Discussion: Goldman@VAXA.ISI.EDU raised this issue on Common-Lisp. This issue came up primarily in the context of program-written programs; a macro used in the program generated code might occasionally use a dotted tail to a list to explicitly represent special conditions.  Allowing dotted macro forms may blur the data/code distinction too much,  particularly for people who are new to Lisp. On the other hand, some people argue that the point of macros is to help blur that distinction. Macro forms are data which must be translated to program, and only once the program claims to be macroexpanded ought syntax restrictions be imposed. This proposal was rewritten from `DISALLOW' to `ALLOW' after Steele pointed out in a recent meeting that dotted lists are allowed in subforms and  that permitting them at toplevel would be the most internally consistent interpretation. Pitman supports DOTTED-MACRO-FORMS:ALLOW.        TITAN 
         TITAN 
          G                     l                                                %                                 y             B                            /       
       %                                 z*start*05108 00024 US Return-Path: <X3J13-mailer@SAIL.Stanford.EDU>Received: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 07 DEC 88 18:17:22 PSTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 7 Dec 88  18:03:39 PSTReceived: from Semillon.ms by ArpaGateway.ms ; 07 DEC 88 17:12:10 PSTDate: 7 Dec 88 17:11 PSTSender: masinter.pato: x3j13@sail.stanford.eduSubject: Issue: DOTTED-MACRO-FORMS (Version 3)from: cl-cleanup@sail.stanford.edureply-to: cl-cleanup@sail.stanford.educc: masinter.paline-fold: noMessage-ID: <881207-171210-2206@Xerox>At the cleanup committee meeting prior in Fairfax, we decided to propose this version.!Issue:        DOTTED-MACRO-FORMSReferences:   forms (p54), lists and dotted lists (pp26-27),	      DEFMACRO (p145), destructuring macro arguments (p146)Category:     CLARIFICATION/CHANGEEdit history: 28-Jun-88, Version 1 by Pitman   (explicitly-vague vs allow)	      01-Oct-88, Version 2 by Masinter (disallow)	      15-Nov-88, Version 3 by Pitman   (revive allow, flush disallow)Problem Description:  CLtL is not explicit about whether macro forms may be dotted  lists.  p54 says that only certain forms are "meaningful": self-evaluating   forms, symbols, and "lists".  pp26-27 defines "list" and "dotted list". It goes on to say   ``Throughout this manual, unless otherwise specified, it is an   error to pass a dotted list to a function that is specified   to require a list as an argument.''  p146 states that in DEFMACRO destructuring, ``the argument   form that would match the parameter is treated as a   (possibly dotted) list, to be used as an argument forms list   for satisfying the parameters in the embedded lambda list.''   It goes on to say that ". var" is treated like "&rest var"   at any level of the defmacro lambda-list.Proposal (DOTTED-MACRO-FORMS:ALLOW): Define that it is permissible for a macro form (or subform) to be a dotted list when "&REST var" or ". var" is used to match it. It is the responsibility of the macro to recognize and deal with such situations.Rationale:   Some implementations permit dotted lists in macro forms at toplevel. Most or all implementations permit dotted lists in macro forms at embedded levels. This proposal makes the language internally consistent without requiring changes to existing code. Also, there's no reason to unnecessarily restrict &REST since there is no computational overhead and since there's no dispute about how to interpret programmer intent in this gray area.Test Case:  #1: (DEFMACRO MACW (&WHOLE W &REST R) `(- ,(CDR W)))      (MACW . 1) => ??  #2: (DEFMACRO MACR (&REST R) `(- ,R))      (MACR . 1) => ??  #3: (DEFMACRO MACX (&WHOLE W) `(- ,(CDR W)))      (MACX . 1)    (MACW . 1) => -1 under this proposal.    (MACR . 1) => -1 under this proposal.    (MACX . 1) is an error under CLtL semantics and is not	       changed by this proposal. The reason it is an	       error is that the argument pattern does not	       match. The pattern is dictated by the arguments	       -other than- the &WHOLE argument, so the pattern	       is () and MACX cannot be called with any arguments.Current Practice:  A. Some implementations bind W to (MACW . 1) in #1 and #3   		      and bind R to 1 in #1 and #2.  B. Some implementations bind W to (MACW . 1) in #3		      and signal a syntax error in #1 and #2.  C. Some implementations signal a syntax error in #1, #2, and #3.     Symbolics Genera is such an implementation.Cost to Implementors:   Some implementations would have to eliminate an error check. Some implementations which try to use APPLY of a normal lambda to accomplish part of the destructuring (in the non-recursive case) would have to be slightly more careful.  Cost to Users:   None. This change is upward compatible.  Benefits: People would know what to expect.Aesthetics: Mixed opinion: certainly it is better to specify whether they are allowed or an error than to be vague. Some feel that disallowing dotted macro forms helps catch syntax errors. Some feel that allowing dotted macro forms makes the language more regular.Discussion: Goldman@VAXA.ISI.EDU raised this issue on Common-Lisp. This issue came up primarily in the context of program-written programs; a macro used in the program generated code might occasionally use a dotted tail to a list to explicitly represent special conditions.  Allowing dotted macro forms may blur the data/code distinction too much,  particularly for people who are new to Lisp. On the other hand, some people argue that the point of macros is to help blur that distinction. Macro forms are data which must be translated to program, and only once the program claims to be macroexpanded ought syntax restrictions be imposed. This proposal was rewritten from `DISALLOW' to `ALLOW' after Steele pointed out in a recent meeting that dotted lists are allowed in subforms and  that permitting them at toplevel would be the most internally consistent interpretation. Pitman supports DOTTED-MACRO-FORMS:ALLOW.