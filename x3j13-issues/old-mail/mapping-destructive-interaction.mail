*start*03074 00024 USaReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU by Xerox.COM ; 07 MAR 88 13:28:22 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 7 Mar 88  13:24:38 PSTReceived: from RIO-DE-JANEIRO.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 357783; Mon 7-Mar-88 16:25:04 ESTDate: Mon, 7 Mar 88 16:24 ESTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: MAPPING-DESTRUCTIVE-INTERACTION (Version 1)To: CL-Cleanup@SAIL.Stanford.EDUMessage-ID: <880307162443.5.KMP@RIO-DE-JANEIRO.SCRC.Symbolics.COM>Issue:        MAPPING-DESTRUCTIVE-INTERACTIONReferences:   MAPCAR, MAPLIST, ... (p128);	      DOLIST (p126); MAPHASH (p285); 	      DO-SYMBOLS, DO-EXTERNAL-SYMBOLS, DO-ALL-SYMBOLS (pp187-188);	      All functions using :TEST	      Category:     CLARIFICATIONEdit history: 07-Mar-88, Version 1 by PitmanStatus:	      For Internal DiscussionProblem Description: The interaction of mapping functions and DOLIST with destructive operations on the list being operated on is unclear. For example, if you destructively modify some tail of a list being mapped down, does that affect the mapping process?Proposal (MAPPING-DESTRUCTIVE-INTERACTION:EXPLICITLY-VAGUE): Document the fact that it is an error for code run by a  "structure traversing" operation to destructively modify the set of things being traversed while the traversal operation is going on.Test Case: (LET* ((L (LIST 'A 'B 'C)) (LL L) (I 0))   (DOLIST (FOO L)     (INCF I)     (IF (EQ FOO 'B)	 (SETF (CDR LL) NIL)	 (POP LL)))   (LIST I L)) might return (2 (A B)) or (3 (A B)), for example.Rationale: The likelihood that the user will want to destructively alter a structure while it is being traversed is low. The likelihood that such code would be readable and maintainable is also low. The likelihood that a compiler could do some interesting optimization if this point were not pinned down is high enough to be the overriding consideration in this case.Current Practice: The Symbolics implementation of DOLIST returns (3 (A B)) for the test case.Cost to Implementors:  None. This simply makes the status quo explicit.Cost to Users:  Technically none. People who were mistakenly assuming that CLtL guaranteed  things which it does not might be inclined to rewrite their code in a more  portable way.Cost of Non-Adoption:  Users would be less informed.Benefits:  users would be more informed.Aesthetics:  Some might say it would be clearer to define this one way or the other, but  advocates of both camps exist and their arguments are fairly symmetric.  In any case, since this is a proposal to preserve the status quo, it has no  major impact on aesthetics.Discussion:  This idea for this proposal was suggested by the Japanese community.  Pitman drafted the formal proposal and supports   MAPPING-DESTRUCTIVE-INTERACTION:EXPLICITLY-VAGUE.*start*00742 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU by Xerox.COM ; 08 MAR 88 13:54:43 PSTReceived: from NSS.Cs.Ucl.AC.UK by SAIL.Stanford.EDU with TCP; 8 Mar 88  13:51:28 PSTReceived: from aiva.edinburgh.ac.uk by NSS.Cs.Ucl.AC.UK   via Janet with NIFTP           id aa10183; 8 Mar 88 20:41 GMTFrom: Jeff Dalton <jeff%aiva.edinburgh.ac.uk@NSS.Cs.Ucl.AC.UK>Date: Tue, 8 Mar 88 20:22:00 gmtMessage-Id: <18213.8803082022@aiva.ed.ac.uk>To: CL-Cleanup@sail.stanford.eduSubject: Issue: MAPPING-DESTRUCTIVE-INTERACTION (Version 1)Cc: KMP@scrc-stony-brook.arpaCurrent practice:  KCL and PopLog Common Lisp both return (3 (A B)) in the test case.*start*01884 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU by Xerox.COM ; 11 MAR 88 10:42:21 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 11 Mar 88  10:39:31 PSTReceived: from EUPHRATES.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 361128; Fri 11-Mar-88 13:39:35 ESTDate: Fri, 11 Mar 88 13:39 ESTFrom: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: MAPPING-DESTRUCTIVE-INTERACTION (Version 1)To: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>cc: CL-Cleanup@SAIL.STANFORD.EDUIn-Reply-To: <880307162443.5.KMP@RIO-DE-JANEIRO.SCRC.Symbolics.COM>Message-ID: <19880311183925.8.MOON@EUPHRATES.SCRC.Symbolics.COM>I favor the general idea of MAPPING-DESTRUCTIVE-INTERACTION:EXPLICITLY-VAGUE,but I have two comments:Do we want to follow the lead of MAPHASH in explicitly defining thatdestructive operations are permissible on the entry currently beingprocessed?  For example, is  (let ((l (list 0 1 2 3 4)))    (dolist (x l)      (when (oddp x)	(setq l (delete x l))))    l)a valid program that returns (0 2 4)?  Note that making this validseems to imply a restriction on the implementation of DOLIST, thatit must call CDR before evaluating the body, not after.  PersonallyI don't care whether this practice is allowed or forbidden.  Beingconsistent with MAPHASH might lead to a clearer language.The proposal needs to be expanded to include a complete list ofthe functions affected.  It also needs a clearer definition ofwhich destructive operations it covers.  For example, I imagine yourintention was to forbid SETF of CDR but to allow SETF of CAR, insideof DOLIST.  However, you didn't say that explicitly.  What aboutdestructive operations on vectors?*start*00784 00024 US Return-Path: <KMP@STONY-BROOK.SCRC.Symbolics.COM>Received: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by Xerox.COM ; 09 JUN 88 07:53:44 PDTReceived: from PEWEE.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 417137; Thu 9-Jun-88 10:53:32 EDTDate: Thu, 9 Jun 88 10:53 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Re: Issue: MAPPING-DESTRUCTIVE-INTERACTION (Version 1)To: Masinter.PAcc: KMP@STONY-BROOK.SCRC.Symbolics.COMIn-Reply-To: <880608-210951-3868@Xerox>Message-ID: <880609105331.2.KMP@PEWEE.SCRC.Symbolics.COM>I'm home now and don't have access to the proposal. I'll look at itwhen I get to work and either send you a new version or a messagesaying I don't have time.*start*05466 00024 USfReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU by Xerox.COM ; 09 JUN 88 09:54:43 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 9 Jun 88  09:53:47 PDTReceived: from PEWEE.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 417215; Thu 9-Jun-88 12:52:55 EDTDate: Thu, 9 Jun 88 12:52 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: MAPPING-DESTRUCTIVE-INTERACTION (Version 2)To: CL-Cleanup@SAIL.STANFORD.EDUcc: KMP@STONY-BROOK.SCRC.Symbolics.COMMessage-ID: <880609125240.3.KMP@PEWEE.SCRC.Symbolics.COM>At Larry's request, I went over this to try to reconcile Moon's commentswith my previous draft. I ended up updating the proposal to add ``moreconcrete vagueness.'' I'm certainly willing to believe that this part stillneeds work.Moon had asked specifically about whether we wanted to make DOLIST more likeMAPHASH by allowing deletion of the element you're at, but I decided notto follow up on that suggestion because in the case of MAPHASH you have the KEYwhich acts as a unique pointer into the structure, while in the case of DOLISTyou can have duplicated elements, and so you don't really have a pointer intothe structure. A better case might have been MAPL, but I declined to address thatbecause it was starting to seem more like an obscure point (even though I agreewith Moon that it makes things more general, the fact that it's only meaningfulin a few cases makes it seem like a special case ...)-----Issue:          MAPPING-DESTRUCTIVE-INTERACTIONReferences:     MAPCAR, MAPLIST, ... (p128);	        DOLIST (p126); MAPHASH (p285); 	        DO-SYMBOLS, DO-EXTERNAL-SYMBOLS, DO-ALL-SYMBOLS (pp187-188);	        All functions using :TEST	      Related-Issues: REMF-DESTRUCTION-UNSPECIFIED.Category:       CLARIFICATIONEdit history:   07-Mar-88, Version 1 by Pitman	        09-Jun-88, Version 2 by Pitman		   (merge Moon's comments and update current practice)Status:	        For Internal DiscussionProblem Description: The interaction of mapping functions and DOLIST with destructive operations on the list being operated on is unclear. For example, if you destructively modify some tail of a list being mapped down, does that affect the mapping process?Proposal (MAPPING-DESTRUCTIVE-INTERACTION:EXPLICITLY-VAGUE): Clarify that it in general is an error (the effect is not defined but in general no error will be signalled) for code executed during a "structure traversing" operation to destructively modify the structure in a way that might affect the ongoing traversal operation. For list traversal operations, this means that the cdr chain of the list may not be destructively modified. For array traversal operations, the array may not be adjusted and its fill-pointer, if any, may not be changed. For hash tables, new elements may not be added or deleted EXCEPT that the element corresponding to the current hash key may be changed or removed. For packages, new symbols may not be interned in or uninterned from the package being traversed or any package that it uses EXCEPT that the current symbol may be uninterned from the package being traversed in a DO-SYMBOLS. Note: This proposal is intended to clarify restrictions on user code  for use with structure manipulators which are not inherently  destructive. Other operators, such as DELETE-DUPLICATES or NREVERSE,  may have much more complicated restrictions and are intentionally not  treated by this proposal. See the issue REMF-DESTRUCTION-UNSPECIFIED  for more discussion of such issues.Test Case: (LET* ((L (LIST 'A 'B 'C)) (LL L) (I 0))   (DOLIST (FOO L)     (INCF I)     (IF (EQ FOO 'B)	 (SETF (CDR LL) NIL)	 (POP LL)))   (LIST I L)) might return (2 (A B)) or (3 (A B)), for example.Rationale: This clarifies the status quo. Also, the likelihood that the user will want to destructively alter a structure while it is being traversed is low. The likelihood that such code would be readable and maintainable is also low. The likelihood  that a compiler could do some interesting optimization if this point were not pinned down is high enough to be the overriding consideration in this case.Current Practice: The implementation of DOLIST in Symbolics Genera, KCL, and PopLog Common Lisp returns (3 (A B)) for the test case.Cost to Implementors:  None. This simply makes the status quo explicit.Cost to Users:  Technically none. People who were mistakenly assuming that CLtL guaranteed  things which it does not might be inclined to rewrite their code in a more  portable way.Cost of Non-Adoption:  Users would be less informed.Benefits:  users would be more informed.Aesthetics:  Some might say it would be clearer to define this one way or the other, but  advocates of both camps exist and their arguments are fairly symmetric.  In any case, since this is a proposal to preserve the status quo, it has no  major impact on aesthetics.Discussion:  This idea for this proposal was suggested by the Japanese community.  Pitman drafted the formal proposal and supports the EXPLICITLY-VAGUE proposal.  Moon generally supported version 1 of this proposal, but had some specific  criticisms about weakness of the wording which this version is an attempt to fix.*start*04396 00024 US Date:  8 Oct 88 20:32 PDTSender: masinter.paSubject: Issue: MAPPING-DESTRUCTIVE-INTERACTION (Version 2)From: cl-cleanup@sail.stanford.eduTo: x3j13@sail.stanford.eduREPLY-TO: cl-cleanup@sail.stanford.eduline-fold: NOcc: MasinterIssue:          MAPPING-DESTRUCTIVE-INTERACTIONReferences:     MAPCAR, MAPLIST, ... (p128);	        DOLIST (p126); MAPHASH (p285); 	        DO-SYMBOLS, DO-EXTERNAL-SYMBOLS, DO-ALL-SYMBOLS (pp187-188);	        All functions using :TEST	      Related-Issues: REMF-DESTRUCTION-UNSPECIFIED.Category:       CLARIFICATIONEdit history:   07-Mar-88, Version 1 by Pitman	        09-Jun-88, Version 2 by Pitman		   (merge Moon's comments and update current practice)Problem Description: The interaction of mapping functions and DOLIST with destructive operations on the list being operated on is unclear. For example, if you destructively modify some tail of a list being mapped down, does that affect the mapping process?Proposal (MAPPING-DESTRUCTIVE-INTERACTION:EXPLICITLY-VAGUE): Clarify that it in general is an error (the effect is not defined but in general no error will be signalled) for code executed during a "structure traversing" operation to destructively modify the structure in a way that might affect the ongoing traversal operation. For list traversal operations, this means that the cdr chain of the list may not be destructively modified. For array traversal operations, the array may not be adjusted and its fill-pointer, if any, may not be changed. For hash tables, new elements may not be added or deleted EXCEPT that the element corresponding to the current hash key may be changed or removed. For packages, new symbols may not be interned in or uninterned from the package being traversed or any package that it uses EXCEPT that the current symbol may be uninterned from the package being traversed in a DO-SYMBOLS. Note: This proposal is intended to clarify restrictions on user code  for use with structure manipulators which are not inherently  destructive. Other operators, such as DELETE-DUPLICATES or NREVERSE,  may have much more complicated restrictions and are intentionally not  treated by this proposal. See the issue REMF-DESTRUCTION-UNSPECIFIED  for more discussion of such issues.Test Case: (LET* ((L (LIST 'A 'B 'C)) (LL L) (I 0))   (DOLIST (FOO L)     (INCF I)     (IF (EQ FOO 'B)	 (SETF (CDR LL) NIL)	 (POP LL)))   (LIST I L)) might return (2 (A B)) or (3 (A B)), for example.Rationale: This clarifies the status quo. Also, the likelihood that the user will want to destructively alter a structure while it is being traversed is low. The likelihood that such code would be readable and maintainable is also low. The likelihood  that a compiler could do some interesting optimization if this point were not pinned down is high enough to be the overriding consideration in this case.Current Practice: The implementation of DOLIST in Symbolics Genera, KCL, and PopLog Common Lisp returns (3 (A B)) for the test case.Cost to Implementors:  None. This simply makes the status quo explicit.Cost to Users:  Technically none. People who were mistakenly assuming that CLtL guaranteed  things which it does not might be inclined to rewrite their code in a more  portable way.Cost of Non-Adoption:  Users would be less informed.Benefits:  users would be more informed.Aesthetics:  Some might say it would be clearer to define this one way or the other, but  advocates of both camps exist and their arguments are fairly symmetric.  In any case, since this is a proposal to preserve the status quo, it has no  major impact on aesthetics.Discussion:  This idea for this proposal was suggested by the Japanese community.  Pitman drafted the formal proposal and supports the EXPLICITLY-VAGUE proposal.  Moon generally supported version 1 of this proposal, but had some specific  criticisms about weakness of the wording which this version is an attempt to fix.        TITAN 
         TITAN 
           Ô                             ∂                                          Å              Ú       =                    ∆             ï              w              5              ¨              "       
       "                          =      µ !z∫*start*00809 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 13 OCT 88 19:26:48 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 13 Oct 88  15:39:20 PDTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 476049; Thu 13-Oct-88 18:37:28 EDTDate: Thu, 13 Oct 88 18:37 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: MAPPING-DESTRUCTIVE-INTERACTION (Version 2)To: CL-Cleanup@SAIL.Stanford.EDUMessage-ID: <881013183716.3.KMP@BOBOLINK.SCRC.Symbolics.COM>My notes from Fairfax meeting...Cleanup meeting: People seemed to think this was ready for vote.