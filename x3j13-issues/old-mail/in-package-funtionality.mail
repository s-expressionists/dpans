*start*01003 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([10.0.0.11]) by Xerox.COM ; 08 JUL 88 03:11:14 PDTReceived: from NSS.Cs.Ucl.AC.UK by SAIL.Stanford.EDU with TCP; 8 Jul 88  03:09:57 PDTReceived: from maths.bath.ac.uk by NSS.Cs.Ucl.AC.UK   via Janet with NIFTP           id aa04525; 8 Jul 88 10:07 BSTReceived: from xenakis by mordell.maths.bath.AC.UK id aa24723;          8 Jul 88 10:26 BSTTo: KMP@scrc-stony-brook.arpaCC: CL-Cleanup@sail.stanford.eduIn-reply-to: Kent M Pitman's message of Thu, 7 Jul 88 16:12 EDT <880707161211.9.KMP@RIO-DE-JANEIRO.SCRC.Symbolics.COM>Subject: Issue: IN-PACKAGE-FUNCTIONALITY (Version 1)Date: Fri, 8 Jul 88 10:26:07 BSTFrom: jpff%maths.bath.ac.uk@NSS.Cs.Ucl.AC.UKSender: jpff%maths.bath.ac.uk@NSS.Cs.Ucl.AC.UKI support strongly the IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY proposal.I have been confused by the dual use of IN-PACKAGE which is nothelpful.==John*start*04071 00024 USfReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([10.0.0.11]) by Xerox.COM ; 07 JUL 88 13:14:10 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 7 Jul 88  13:12:42 PDTReceived: from RIO-DE-JANEIRO.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 430076; Thu 7-Jul-88 16:12:27 EDTDate: Thu, 7 Jul 88 16:12 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: IN-PACKAGE-FUNCTIONALITY (Version 1)To: CL-Cleanup@SAIL.Stanford.EDUMessage-ID: <880707161211.9.KMP@RIO-DE-JANEIRO.SCRC.Symbolics.COM>Issue:          IN-PACKAGE-FUNCTIONALITYReferences:     IN-PACKAGE (p183)Category:       CHANGEEdit history:   07-Jul-88, Version 1 by PitmanRelated-Issues: DEFPACKAGEStatus:	        For Internal DiscussionProblem Description:  There are two typical uses for IN-PACKAGE -- to define/create a package  and to select a package. The fact that these two purposes have been  given to the same function has led to reduced error checking.Proposal (IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY):  Eliminate the ability of IN-PACKAGE to create a package on demand.  Require IN-PACKAGE to signal an error if the package does not exist.  Eliminate the :NICKNAMES and :USE arguments to IN-PACKAGE, since they  are no longer needed.  Clarify that DEFPACKAGE is the preferred way to declare a package,  and MAKE-PACKAGE is the preferred way to construct a package at runtime.  Eliminate the compile-time processing requirement for all package-related  functions except IN-PACKAGE and DEFPACKAGE.Test Case:  #1: (IN-PACKAGE 'NO-SUCH-PACKAGE) 		;signals an error  #2: (DEFPACKAGE FOO ...options...)		;defines/creates a package      (IN-PACKAGE 'FOO)				;selects an existing packageRationale:  This would greatly improve error checking and modularity, with only minimal  loss of functionality. Any call to IN-PACKAGE which really needed to  demand-create a package could be rewritten as a DEFPACKAGE followed by an  IN-PACKAGE.Current Practice:  Probably no one implements this behavior since it's in direct  contradiction of both the definitions and numerous examples in CLtL.Cost to Implementors:  This change would be straightforward to implement.  The cost may not be trivial in all cases, but should not be very large.Cost to Users:  In most cases, minor syntactic changes to some files would be necessary.  In many cases, no changes would be necessary since files may already be  doing IN-PACKAGE in situations where the author is hoping he's made sure  the real package declaration is already loaded.Cost of Non-Adoption:  Reduced error checking.  Less modular code.Benefits:  Errors due to demand-creation of a package by IN-PACKAGE without appropriate  uses of the :USE or :NICKNAMES or without appropriate calls to EXPORT, etc.  afterward would be easier to detect.  Modular package declarations would be encouraged.Aesthetics:  The fact that IN-PACKAGE is currently ambiguous about intent (whether the  package should exist already or not) is clearly not aesthetic. This change  would be an aesthetic improvement.Discussion:  Pitman supports IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY.  As written, this proposal is necessarily contingent on DEFPACKAGE:ADDITION.  Note, however, that the attempt by this proposal to reduce the set  of arguments allowed to IN-PACKAGE is not inconsistent with the attempt by   DEFPACKAGE:ADDITION to increase the set of arguments. That proposal,  which is a compatible addition, presupposes that IN-PACKAGE is still  usable both for selection and creation, so it correctly attempts to  generalize the arguments it requires. This proposal, which is an  incompatible change, uses DEFPACKAGE as a foothold to change the model  of how IN-PACKAGE is used -- only once that new model is in place does  it make sense to consider eliminating arguments to IN-PACKAGE.*start*00573 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([10.0.0.11]) by Xerox.COM ; 12 SEP 88 13:34:52 PDTReceived: from decwrl.dec.com by SAIL.Stanford.EDU with TCP; 12 Sep 88  13:34:21 PDTReceived: by decwrl.dec.com (5.54.5/4.7.34)	id AA12724; Mon, 12 Sep 88 13:33:02 PDTMessage-Id: <8809122033.AA12724@decwrl.dec.com>From: vanroggen%aitg.DEC@decwrl.dec.comDate: 12 Sep 88 16:21To: cl-cleanup@sail.stanford.eduSubject: Issue: IN-PACKAGE-FUNCTIONALITYThis looks OK to me.*start*01285 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 26 SEP 88 20:42:50 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 26 Sep 88  20:42:52 PDTReceived: from EUPHRATES.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 466117; Mon 26-Sep-88 23:41:34 EDTDate: Mon, 26 Sep 88 23:41 EDTFrom: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: IN-PACKAGE-FUNCTIONALITY (Version 1)To: CL-Cleanup@SAIL.Stanford.EDUIn-Reply-To: <880707161211.9.KMP@RIO-DE-JANEIRO.SCRC.Symbolics.COM>Message-ID: <19880927034132.3.MOON@EUPHRATES.SCRC.Symbolics.COM>I approve IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY even though I rarelyfavor incompatible changes.  As JonL pointed out in a recent message,the fact that Common Lisp encourages users to replicate their packagedefinitions in several places (several calls to IN-PACKAGE) leads toerrors that are difficult to diagnose and correct.Even if DEFPACKAGE is not adopted, I still favorIN-PACKAGE-FUNCTIONALITY:SELECT-ONLY, in spite of the proposal'sclaim to depend on DEFPACKAGE; MAKE-PACKAGE could be used instead.*start*02193 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 27 SEP 88 09:27:14 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 27 Sep 88  09:27:04 PDTReceived: from GRYPHON.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 466341; Tue 27-Sep-88 12:25:51 EDTDate: Tue, 27 Sep 88 12:25 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: IN-PACKAGE-FUNCTIONALITY (Version 1)To: Moon@STONY-BROOK.SCRC.Symbolics.COMcc: CL-Cleanup@SAIL.Stanford.EDU, KMP@STONY-BROOK.SCRC.Symbolics.COMIn-Reply-To: <19880927034132.3.MOON@EUPHRATES.SCRC.Symbolics.COM>Message-ID: <880927122539.0.KMP@GRYPHON.SCRC.Symbolics.COM>    Date: Mon, 26 Sep 88 23:41 EDT    From: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>    ... Even if DEFPACKAGE is not adopted, I still favor    IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY, in spite of the proposal's    claim to depend on DEFPACKAGE; MAKE-PACKAGE could be used instead.Well, one issue is that we need something that will be processed atcompile time. Replacing (IN-PACKAGE 'FOO) ;Current semanticswith (MAKE-PACKAGE 'FOO) (IN-PACKAGE 'FOO) ;New semanticswill not do because (at least in Genera and I bet in other implementationsas well), MAKE-PACKAGE signals an error if the package already exists.If you write: (UNLESS (FIND-PACKAGE 'FOO) (MAKE-PACKAGE 'FOO)) (IN-PACKAGE 'FOO) ;New semanticsyou lose because the IF isn't processed at compile time and the IN-PACKAGEwill say no such package at compile time. You have to write (EVAL-WHEN (EVAL COMPILE LOAD)   (UNLESS (FIND-PACKAGE 'FOO) (MAKE-PACKAGE 'FOO))) (IN-PACKAGE 'FOO)which I find a little on the ugly side.Technically you're right that MAKE-PACKAGE is enough, but stylisticallyIN-PACKAGE was convenient because it was so much less obscure. If DEFPACKAGEdoesn't come in, some might think we're causing them a hassle. I dunno...For now I think I'll just cross my fingers for DEFPACKAGE being adopted andhope this issue will become moot.*start*01655 00024 USmReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 28 SEP 88 14:54:37 PDTReceived: from lucid.com by SAIL.Stanford.EDU with TCP; 28 Sep 88  14:53:02 PDTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA01076g; Wed, 28 Sep 88 13:50:55 PSTReceived: by bhopal id AA09835g; Wed, 28 Sep 88 14:50:29 PDTDate: Wed, 28 Sep 88 14:50:29 PDTFrom: Jon L White <jonl@lucid.com>Message-Id: <8809282150.AA09835@bhopal>To: Moon@STONY-BROOK.SCRC.Symbolics.COM, KMP@STONY-BROOK.SCRC.Symbolics.COMCc: CL-Cleanup@SAIL.Stanford.EDUSubject: Issues: IN-PACKAGE-FUNCTIONALITY and DEFPACKAGEIn Kent's note of Tue, 27 Sep 88 12:25 EDT, he points out the action of MAKE-PACKAGE, for an existing package, is to "break" (in mostimplementations.)    It occurs to me that the DEFPACKAGE proposalis silent (hence, subject to varying interpretations) about how to handle the case of defining a package on a name that already exists.I see three possibilities:  (1) "break", just like MAKE-PACKGE  (2) Simply do the new definition (as DEFUN and DEFCLASS do), possibly      issuing a warning message based upon vendor-specific facilities.  (3) Quietly do the new definition, providing that it is essentially      compatible with the old one; signal an error if not compatible.I think I'd prefer (3), since it allows you to re-load a file thatis under development, without getting spurious breaks or warningmessages; yet it provides some assurance that you aren't about tobreak your whold world.Comments?-- JonL --*start*00805 00024 USmReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 28 SEP 88 15:21:37 PDTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 28 Sep 88  15:19:36 PDTReceived: from Cabernet.ms by ArpaGateway.ms ; 28 SEP 88 15:06:38 PDTDate: 28 Sep 88 15:06 PDTFrom: masinter.paSubject: Re: Issues: IN-PACKAGE-FUNCTIONALITY and DEFPACKAGEIn-reply-to: Jon L White <jonl@lucid.com>'s message of Wed, 28 Sep 88 14:50:29 PDTTo: Jon L White <jonl@lucid.com>cc: Moon@STONY-BROOK.SCRC.Symbolics.COM, KMP@STONY-BROOK.SCRC.Symbolics.COM, CL-Cleanup@SAIL.Stanford.EDUMessage-ID: <880928-150638-1741@Xerox>I like it, but it is necessary to define what "essentially compatible" means.Please.*start*01429 00024 USmReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 28 SEP 88 15:04:31 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 28 Sep 88  15:03:00 PDTReceived: from GRYPHON.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 467326; Wed 28-Sep-88 18:01:26 EDTDate: Wed, 28 Sep 88 18:01 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issues: IN-PACKAGE-FUNCTIONALITY and DEFPACKAGETo: jonl@lucid.comcc: Moon@STONY-BROOK.SCRC.Symbolics.COM, KMP@STONY-BROOK.SCRC.Symbolics.COM, CL-Cleanup@SAIL.Stanford.EDUIn-Reply-To: <8809282150.AA09835@bhopal>Message-ID: <880928180109.6.KMP@GRYPHON.SCRC.Symbolics.COM>I like option 3, too. But I note that all kinds of packages aregoing to be defined as just :USE LISP and nothing else, so that'snot enough safeguard to be completely sure that clobberage is notoccurring. I think we (Symbolics) will want to provide [implementation-dependent] support for complaining more forcefullyif the DEFPACKAGE is in a different file than the previous one(to help us distinguish re-loading from clobbering back and forth),so try to leave the wording vague enough to accomodate discretionabout exactly why the error might be signalled in the case of redefinition.*start*03580 00024 USfReturn-Path: <X3J13-mailer@SAIL.Stanford.EDU>Received: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 07 OCT 88 15:16:35 PDTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 7 Oct 88  15:01:43 PDTReceived: from Cabernet.ms by ArpaGateway.ms ; 07 OCT 88 14:53:48 PDTDate: 7 Oct 88 14:53 PDTFrom: masinter.paSubject: Issue: IN-PACKAGE-FUNCTIONALITY (Version 2)To: x3j13@sail.stanford.eduREPLY-TO: cl-cleanup@sail.stanford.eduline-fold: NOcc: Masinter.paMessage-ID: <881007-145348-1132@Xerox>!Issue:          IN-PACKAGE-FUNCTIONALITYReferences:     IN-PACKAGE (p183)Category:       CHANGEEdit history:   07-Jul-88, Version 1 by Pitman                 7-Oct-88, Version 2 by Masinter (discussion)Related-Issues: DEFPACKAGEProblem Description:  There are two typical uses for IN-PACKAGE -- to define/create a package  and to select a package. The fact that these two purposes have been  given to the same function has led to reduced error checking.Proposal (IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY):  Eliminate the ability of IN-PACKAGE to create a package on demand.  Require IN-PACKAGE to signal an error if the package does not exist.  Eliminate the :NICKNAMES and :USE arguments to IN-PACKAGE, since they  are no longer needed.  Clarify that DEFPACKAGE is the preferred way to declare a package,  and MAKE-PACKAGE is the preferred way to construct a package at runtime.  Eliminate the compile-time processing requirement for all package-related  functions except IN-PACKAGE and DEFPACKAGE.Test Case:  #1: (IN-PACKAGE 'NO-SUCH-PACKAGE) 		;signals an error  #2: (DEFPACKAGE FOO ...options...)		;defines/creates a package      (IN-PACKAGE 'FOO)				;selects an existing packageRationale:  This would greatly improve error checking and modularity, with only minimal  loss of functionality. Any call to IN-PACKAGE which really needed to  demand-create a package could be rewritten as a DEFPACKAGE followed by an  IN-PACKAGE.Current Practice:  Probably no one implements this behavior since it's in direct  contradiction of both the definitions and numerous examples in CLtL.Cost to Implementors:  This change would be straightforward to implement.  The cost may not be trivial in all cases, but should not be very large.Cost to Users:  In most cases, minor syntactic changes to some files would be necessary.  In many cases, no changes would be necessary since files may already be  doing IN-PACKAGE in situations where the author is hoping he's made sure  the real package declaration is already loaded.Cost of Non-Adoption:  Reduced error checking.  Less modular code.Benefits:  Errors due to demand-creation of a package by IN-PACKAGE without appropriate  uses of the :USE or :NICKNAMES or without appropriate calls to EXPORT, etc.  afterward would be easier to detect.  Modular package declarations would be encouraged.Aesthetics:  The fact that IN-PACKAGE is currently ambiguous about intent (whether the  package should exist already or not) is clearly not aesthetic. This change  would be an aesthetic improvement.Discussion:  The cleanup committee supports IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY.  The dual use of IN-PACKAGE has not been helpful and is confusing.  Some members support it only if DEFPACKAGE passes; others would like  to see IN-PACKAGE changed even if DEFPACKAGE were not added to the language.  However, there might be some compilation problems if IN-PACKAGE  changes and MAKE-PACKAGE signals an error if the package exists.*start*01662 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 13 OCT 88 15:06:48 PDTReceived: from cs.utah.edu by SAIL.Stanford.EDU with TCP; 13 Oct 88  14:56:11 PDTReceived: by cs.utah.edu (5.54/utah-2.0-cs)	id AA22083; Thu, 13 Oct 88 15:54:31 MDTReceived: by defun.utah.edu (5.54/utah-2.0-leaf)	id AA19920; Thu, 13 Oct 88 15:54:24 MDTFrom: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8810132154.AA19920@defun.utah.edu>Date: Thu, 13 Oct 88 15:54:22 MDTSubject: issue IN-PACKAGE-FUNCTIONALITYTo: cl-cleanup@sail.stanford.eduCc: cl-compiler@sail.stanford.eduThis proposal seems like a step in the right direction but I'm not entirely happy with it.I'm speaking for myself here, and not the compiler committee, but Ithink an alternate approach to this issue would simplify our work alot.  I would prefer to see the definition of IN-PACKAGE left alone,the magic compiletime behavior of *all* of the random packagefunctions removed, and a new macro introduced to do what this proposalwants IN-PACKAGE to do.  The reason for making it a macro instead of afunction is so that it can expand into an EVAL-WHEN to get the rightcompiletime behavior instead of requiring the compiler to treat justthis one function specially.  The main problem I'm having is thinkingof what it should be called (since DEFPACKAGE is already being usedfor another purpose).I'm willing to do the writeup if you cleanup people who have beenhandling the issue agree this is the right direction to proceed.  Letme know. -Sandra-------*start*00959 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 13 OCT 88 15:32:16 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 13 Oct 88  15:23:30 PDTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 476022; Thu 13-Oct-88 18:21:56 EDTDate: Thu, 13 Oct 88 18:21 EDTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: IN-PACKAGE-FUNCTIONALITY (Version 2)To: CL-Cleanup@SAIL.Stanford.EDUMessage-ID: <881013182144.6.KMP@BOBOLINK.SCRC.Symbolics.COM>My notes from the Fairfax meeting...Cleanup meeting: Ready for vote if DEFPACKAGE passes.X3J13 meeting: RWK: Compatibility reservations. A number of people seemed to want to drop the last sentence of the proposal and raise it as a separate issue.*start*02145 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 13 OCT 88 19:09:55 PDTReceived: from cs.utah.edu by SAIL.Stanford.EDU with TCP; 13 Oct 88  18:19:18 PDTReceived: by cs.utah.edu (5.54/utah-2.0-cs)	id AA29837; Thu, 13 Oct 88 17:40:45 MDTReceived: by defun.utah.edu (5.54/utah-2.0-leaf)	id AA20008; Thu, 13 Oct 88 17:40:42 MDTFrom: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8810132340.AA20008@defun.utah.edu>Date: Thu, 13 Oct 88 17:40:41 MDTSubject: Re:  issue IN-PACKAGE-FUNCTIONALITYTo: cperdue@sun.com (Cris Perdue)Cc: cl-cleanup@sail.stanford.eduIn-Reply-To: cperdue@Sun.COM (Cris Perdue), Thu, 13 Oct 88 16:00:42 PDTI'm well aware that removing the magical behavior of the packagefunctions is an incompatible change to the language and would have aconsiderable impact on users.  I think the impact would be less thanthat of the current proposal, though.  (It not only removes themagical behavior of all of the other package functions, it changesIN-PACKAGE in a way that does not allow implementations to maintainthe status quo as a compatible extension -- things that are currentlylegal and common practice would be required to cause an error to besignalled.)My intention was not to prohibit implementations from treating thepackage functions magically as an extension.  I expect that most wouldwish to do so.  In fact, I was even considering continuing to requirethem to do so, provided that the standard makes it clear that the useof IN-PACKAGE and friends for declaring a package is consideredobsolete, that the magic behavior is provided only for compatibilityreasons and may be removed in future versions of the standard, andthat the "right" way to get the desired behavior is described.  Analternate approach might be define the magical behavior as a standardfeature.It would be really nice if we could decide on a standard policy forhandling obsolete "features" of the language, because this issue wouldcertainly fall into that category. -Sandra-------*start*01055 00024 USaReturn-Path: <CL-Compiler-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 13 OCT 88 19:46:17 PDTReceived: from Sun.COM by SAIL.Stanford.EDU with TCP; 13 Oct 88  18:18:59 PDTReceived: from snail.sun.com by Sun.COM (4.0/SMI-4.0)	id AA25997; Thu, 13 Oct 88 15:57:11 PDTReceived: from clam.sun.com by snail.sun.com (4.0/SMI-4.0)	id AA24377; Thu, 13 Oct 88 16:00:04 PDTReceived: by clam.sun.com (3.2/SMI-3.2)	id AA12671; Thu, 13 Oct 88 16:00:42 PDTDate: Thu, 13 Oct 88 16:00:42 PDTFrom: cperdue@Sun.COM (Cris Perdue)Message-Id: <8810132300.AA12671@clam.sun.com>To: cl-cleanup@sail.stanford.edu, sandra%defun@cs.utah.eduSubject: Re:  issue IN-PACKAGE-FUNCTIONALITYCc: cl-compiler@sail.stanford.eduFrom what I have personally seen, removing the "magic compiletimebehavior of the random package functions" would break the majorityof all programs written in Sun Common Lisp.  Since it is unnecessary,surely this must be a bad idea.				-Cris*start*01712 00024 US Return-Path: <CL-Compiler-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 21 NOV 88 16:49:58 PSTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 21 Nov 88  16:43:51 PSTReceived: from Semillon.ms by ArpaGateway.ms ; 21 NOV 88 16:42:06 PSTDate: 21 Nov 88 16:41 PSTFrom: masinter.paSubject: Re:  issue IN-PACKAGE-FUNCTIONALITYIn-reply-to: cperdue@Sun.COM (Cris Perdue)'s message of Thu, 13 Oct 88 16:00:42 PDTTo: cl-cleanup@sail.stanford.educc: cl-compiler@sail.stanford.eduMessage-ID: <881121-164206-8723@Xerox>My belief is that we can fix the "problem" stated in this issue--namelythat the current dual purpose of IN-PACKAGE reduces error checking--bysubmitting a proposal as follows:a) this proposal should say only:  Eliminate the ability of IN-PACKAGE to create a package on demand.  Eliminate the :NICKNAMES and :USE arguments to IN-PACKAGE, since they  are no longer needed.b) the DEFPACKAGE issue itself should contain the phrase "Clarify that DEFPACKAGE is the preferred way to declare a package,  and MAKE-PACKAGE is the preferred way to construct a package at runtime."c) The proposal "Require IN-PACKAGE to signal an error if the package does not exist."should be changed; instead, the results are unspecified. Note thatimplementations of CLtL might indeed create the package. This is exactlybecause of the compatibility issue.d) the proposal"Eliminate the compile-time processing requirement for all package-related  functions except IN-PACKAGE and DEFPACKAGE."should be withdrawn at this time to be dealt with more uniformly by thecompiler committee.*start*01584 00024 US Return-Path: <cperdue@Sun.COM>Received: from Sun.COM ([10.7.0.2]) by Xerox.COM ; 30 NOV 88 18:00:26 PSTReceived: from snail.Sun.COM by Sun.COM (4.1/SMI-4.0)	id AA03106; Wed, 30 Nov 88 18:02:13 PSTReceived: from clam.sun.com by snail.Sun.COM (4.1/SMI-4.0)	id AA24999; Wed, 30 Nov 88 17:58:24 PSTReceived: by clam.sun.com (3.2/SMI-3.2)	id AA15569; Wed, 30 Nov 88 17:59:13 PSTDate: Wed, 30 Nov 88 17:59:13 PSTFrom: cperdue@Sun.COM (Cris Perdue)Message-Id: <8812010159.AA15569@clam.sun.com>To: cl-cleanup@sail.stanford.edu, masinter.paSubject: Re:  issue IN-PACKAGE-FUNCTIONALITYCc: cl-compiler@sail.stanford.edu> My belief is that we can fix the "problem" stated in this issue--namely> that the current dual purpose of IN-PACKAGE reduces error checking--by> submitting a proposal as follows:I haven't seen traffic in reply on cl-compiler, so for what it's worth,Masinter's proposal sounds right on the mark to me.Of course this is a real change to the definition of Common Lisppackage handling, but something is badly needed in this area.  DEFPACKAGElooks like it would be a big help.  When can we get a portableimplementation to try out, and from whom????It would be quite nice if the ANSI standard could do without thecurrent requirement that LOAD must interleave resolution of symbol referencesand execution of top level forms.  (p.182)  How about it KCL users?Wouldn't you all like that?  My impression is thatit would be within reason to eliminate this requirement if we adoptDEFPACKAGE.  Has that been considered?				-Cris*start*02056 00024 US Return-Path: <CL-Compiler-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 06 DEC 88 11:56:50 PSTReceived: from lucid.com by SAIL.Stanford.EDU with TCP; 6 Dec 88  11:42:31 PSTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA00618g; Mon, 5 Dec 88 18:47:02 PSTReceived: by bhopal id AA07934g; Mon, 5 Dec 88 18:47:26 PSTDate: Mon, 5 Dec 88 18:47:26 PSTFrom: Jon L White <jonl@lucid.com>Message-Id: <8812060247.AA07934@bhopal>To: cperdue@Sun.COMCc: cl-cleanup@sail.stanford.edu, cl-compiler@sail.stanford.eduIn-Reply-To: Cris Perdue's message of Wed, 30 Nov 88 17:59:13 PST <8812010159.AA15569@clam.sun.com>Subject:  issue IN-PACKAGE-FUNCTIONALITYre: It would be quite nice if the ANSI standard could do without the    current requirement that LOAD must interleave resolution of symbol     references and execution of top level forms.  (p.182)  . . .      My impression is that it would be within reason to eliminate this     requirement if we adopt DEFPACKAGE.  Has that been considered?No.  The DEFPACKAGE proposal would have no bearing on this, sincethe language is still going to include package effector functionssuch as EXPORT, UNINTERN, etc.  [The primary benefit of the DEFPACKAGEproposal is to help a programmer remember not to "distribute" hispackage definitions throught several files, and thus avoid differencesbetween loading the source and loading the compiled versions.]As long as packages are really "first class" objects, we will be stuck with the problem of sequencing on the package effector operations.This is independent of whether or not the file being loaded is compiled.My negative comments (on another issue) about "C-style loading" weremeant to highlight the distinction that LOADing a Lisp file issemantically equivalent to running a bunch of user programs *** inorder ***; but loading a (compiled) C file is a primitive operationmuch below that of the Lisp LOAD.-- JonL --*start*01655 00024 US Return-Path: <CL-Compiler-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 08 DEC 88 09:41:27 PSTReceived: from cs.utah.edu by SAIL.Stanford.EDU with TCP; 8 Dec 88  09:34:34 PSTReceived: from defun.utah.edu by cs.utah.edu (5.59/utah-2.1-cs)	id AA11514; Thu, 8 Dec 88 10:29:14 MSTReceived: by defun.utah.edu (5.59/utah-2.0-leaf)	id AA00557; Thu, 8 Dec 88 10:28:40 MSTFrom: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8812081728.AA00557@defun.utah.edu>Date: Thu, 8 Dec 88 10:28:38 MSTSubject: Re:  issue IN-PACKAGE-FUNCTIONALITYTo: cperdue@Sun.COM (Cris Perdue)Cc: jonl@lucid.com, cl-cleanup@sail.stanford.edu, cl-compiler@sail.stanford.eduIn-Reply-To: cperdue@Sun.COM (Cris Perdue), Wed, 7 Dec 88 11:00:24 PST> Date: Wed, 7 Dec 88 11:00:24 PST> From: cperdue@Sun.COM (Cris Perdue)> > To me, if there is going to be DEFPACKAGE, it is better to just> acknowledge the problems that exist when compiling files with> compile-time calls to package effectors rather than retaining the> current hack half-solution.I agree with this.  If we can't remove the magic compile-time behaviorof the N random package functions, we ought to at least deprecate theuse of this "feature". To me, there is not much advantage in removing the magic behavior ofsome (but not all) of the functions.  That is why I would rather see amacro introduced to do what this proposal wants IN-PACKAGE to do, andleave IN-PACKAGE itself alone.  The best name that I've been able tocome up with for such a macro is WITHIN-PACKAGE. -Sandra-------*start*03978 00024 USfDate:  8 Dec 88 15:24 PSTFrom: masinter.paTo: cl-cleanup@sail.stanford.eduSubject: Issue: IN-PACKAGE-FUNCTIONALITY (Version 3)cc: masinterline-fold: noIssue:          IN-PACKAGE-FUNCTIONALITYReferences:     IN-PACKAGE (p183)Category:       CHANGEEdit history:   07-Jul-88, Version 1 by Pitman                 7-Oct-88, Version 2 by Masinter (discussion)                  8-Dec-88, Version 3 by MasinterRelated-Issues: DEFPACKAGEProblem Description:  There are two typical uses for IN-PACKAGE -- to define/create a package  and to select a package. The fact that these two purposes have been  given to the same function has led to reduced error checking.Proposal (IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY):  Eliminate the ability of IN-PACKAGE to create a package on demand.  Eliminate the :NICKNAMES and :USE arguments to IN-PACKAGE, since they  are no longer needed.  The results of calling IN-PACKAGE if the package does not already  exist are implementation dependent; implementations "should signal"  an error, or otherwise provide the user with a way to recover from  the situation. Test Case:  #1: (IN-PACKAGE 'NO-SUCH-PACKAGE) 		;signals an error  #2: (DEFPACKAGE FOO ...options...)		;defines/creates a package      (IN-PACKAGE 'FOO)				;selects an existing packageRationale:  This could allow improved error checking and modularity, with only minimal  loss of functionality. Any call to IN-PACKAGE which really needed to  demand-create a package could be rewritten as a DEFPACKAGE followed by an  IN-PACKAGE.Current Practice:  Probably no one implements this behavior since it's in direct  contradiction of both the definitions and numerous examples in CLtL.Cost to Implementors:  As written, no change to implementations is required, but many  will want to make IN-PACKAGE signal an error.  This change would be straightforward to implement.  The cost may not be trivial in all cases, but should not be very large.Cost to Users:  In most cases, minor syntactic changes to some files would be necessary.  In some cases, no changes would be necessary since files may already be  doing IN-PACKAGE in situations where the author is hoping he's made sure  the real package declaration is already loaded.Cost of Non-Adoption:  Reduced error checking.  Less modular code.Benefits:  Errors due to demand-creation of a package by IN-PACKAGE without appropriate  uses of the :USE or :NICKNAMES or without appropriate calls to EXPORT, etc.  afterward would be easier to detect.  Modular package declarations would be encouraged.Aesthetics:  The fact that IN-PACKAGE is currently ambiguous about intent (whether the  package should exist already or not) is clearly not aesthetic. This change  would be an aesthetic improvement.Discussion:  The cleanup committee supports IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY.  The dual use of IN-PACKAGE has not been helpful and is confusing.  Some members support it only if DEFPACKAGE passes; others would like  to see IN-PACKAGE changed even if DEFPACKAGE were not added to the language.  However, there might be some compilation problems if IN-PACKAGE  changes and MAKE-PACKAGE signals an error if the package exists.  The issue of compile-time processing of package related functions is  complex, and full of a number of compatibility issues. Should we remove  the requirement of special compile-time handling of IN-PACKAGE?   Should we disallow mid-file switching of *PACKAGE* or package  use lists? These issues are not addressed here.        TITAN 
         TITAN 
           ]              
              1                                                 “                            Ò       1      ‰              ´              ð              ‰              ò                           2       
       û              À             ò      ø $zº*start*02077 00024 US Return-Path: <CL-Compiler-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 10 DEC 88 01:39:12 PSTReceived: from lucid.com by SAIL.Stanford.EDU with TCP; 10 Dec 88  01:34:19 PSTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA03210g; Sat, 10 Dec 88 01:31:45 PSTReceived: by bhopal id AA07836g; Sat, 10 Dec 88 01:33:40 PSTDate: Sat, 10 Dec 88 01:33:40 PSTFrom: Jon L White <jonl@lucid.com>Message-Id: <8812100933.AA07836@bhopal>To: cperdue@Sun.COMCc: cl-cleanup@sail.stanford.edu, cl-compiler@sail.stanford.eduIn-Reply-To: Cris Perdue's message of Wed, 7 Dec 88 11:00:24 PST <8812071900.AA05045@clam.sun.com>Subject:  issue IN-PACKAGE-FUNCTIONALITYre: Remember that even the strictures in CLtL are awkward: it is admitted    up front that package effectors "should appear only at top level within    a file" (p182).  That quote is out of context.  The paragraph on p.182 makes it clearthat it is talking about the creation of the package "in" which thefile is to be read; and it only says that to guarantee propercompilation of a file **** in all Common Lisp implementations  ****these functions should appear at top level.  There certainly is no advice, let alone any constraint, against calling these functions from interior levels when they bash unrelated packages.re: To me, if there is going to be DEFPACKAGE, it is better to just    acknowledge the problems that exist when compiling files with    compile-time calls to package effectors rather than retaining the    current hack half-solution.I'm afraid I haven't the foggiest idea what you are talking about here.Sandra seems to think you mean the special compile-time wrapping of the "7 Extremely Randoms" -- is that all?  Regardless of that question, the need to serialize the computations found in a Lisp file is notaffected by whether DEFPACKAGE is one top-level form or "7 random"top-level forms.  It's Lisp's view of what LOADing a file means.-- Jonl --*start*01648 00024 US Return-Path: <jonl@lucid.com>Received: from lucid.com ([192.26.25.1]) by Xerox.COM ; 10 DEC 88 01:45:42 PSTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA03238g; Sat, 10 Dec 88 01:43:49 PSTReceived: by bhopal id AA07858g; Sat, 10 Dec 88 01:45:46 PSTDate: Sat, 10 Dec 88 01:45:46 PSTFrom: Jon L White <jonl@lucid.com>Message-Id: <8812100945.AA07858@bhopal>To: masinter.paCc: cl-cleanup@sail.stanford.eduIn-Reply-To: masinter.pa@Xerox.COM's message of 8 Dec 88 15:24 PST <881208-162922-4855@Xerox>Subject: Issue: IN-PACKAGE-FUNCTIONALITY (Version 3)re: Rationale:     This could allow improved error checking and modularity, with only      minimal loss of functionality. Any call to IN-PACKAGE which really      needed to demand-create a package could be rewritten as a DEFPACKAGE      followed by an IN-PACKAGE.I think this part needs some more thought.  Maybe the second sentencedoesn't belong in a Rationale.  Note that unless the file begins with an IN-PACKAGE, then the DEFPACKAGE form will be read into totally random package, doing who knows what sort of damage.Ideally, every file of a multi-file module should begin with anIN-PACKAGE form to get "in" that module's package.  The exceptionsare files which might as start out (IN-PACKAGE "USER").   For example, the package creator file might look something like:    (in-package "USER") 	;guaranteed to exist, and not be harmful!    (defpackage :phlogiston ...)Another exception might be the DEFSYSTEM surrogate, which also wouldstart out in the USER package, and simply load the rest of the files.-- JonL --*start*04745 00024 US Date: 12 Dec 88 12:10 PSTSender: masinter.paTo: x3j13@sail.stanford.eduSubject: Issue: IN-PACKAGE-FUNCTIONALITY (Version 4)From: cl-cleanup@sail.stanford.edureply-to: cl-cleanup@sail.stanford.educc: masinterline-fold: noIssue:          IN-PACKAGE-FUNCTIONALITYReferences:     IN-PACKAGE (p183)Category:       CHANGEEdit history:   07-Jul-88, Version 1 by Pitman                 7-Oct-88, Version 2 by Masinter (discussion)                  8-Dec-88, Version 3 by Masinter                 12-Dec-88, Version 4 by MasinterRelated-Issues: DEFPACKAGEProblem Description:  There are two typical uses for IN-PACKAGE -- to define/create a package  and to select a package. The fact that these two purposes have been  given to the same function has led to reduced error checking.Proposal (IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY):  Eliminate the ability of IN-PACKAGE to create a package on demand.  Eliminate the :NICKNAMES and :USE arguments to IN-PACKAGE, since they  are no longer needed.  The results of calling IN-PACKAGE if the package does not already  exist are implementation dependent; implementations "should signal"  an error, or otherwise provide the user with a way to recover from  the situation. Examples:  #1: (IN-PACKAGE 'NO-SUCH-PACKAGE) 	;would signal an error  #2: (DEFPACKAGE FOO ...options...)	;defines/creates a package      (IN-PACKAGE 'FOO)				;selects an existing packageRationale:  This could allow improved error checking and modularity, with only minimal  loss of functionality. Current Practice:  Probably no one implements this behavior since it's in direct  contradiction of both the definitions and numerous examples in CLtL.Cost to Implementors:  As written, no change to implementations is required, but many  will want to make IN-PACKAGE signal an error.  This change would be straightforward to implement.  The cost may not be trivial in all cases, but should not be very large.Cost to Users:  In most cases, minor syntactic changes to some files would be necessary.  In some cases, no changes would be necessary since files may already be  doing IN-PACKAGE in situations where the author is hoping he's made sure  the real package declaration is already loaded.Cost of Non-Adoption:  Reduced error checking.  Less modular code.Benefits:  Errors due to demand-creation of a package by IN-PACKAGE without appropriate  uses of the :USE or :NICKNAMES or without appropriate calls to EXPORT, etc.  afterward would be easier to detect.  Modular package declarations would be encouraged.Aesthetics:  The fact that IN-PACKAGE is currently ambiguous about intent (whether the  package should exist already or not) is clearly not aesthetic. This change  would be an aesthetic improvement.Discussion:  The dual use of IN-PACKAGE has not been helpful and is confusing.  Some support this only if DEFPACKAGE passes; others would like  to see IN-PACKAGE changed even if DEFPACKAGE were not added to the language.  However, there might be some compilation problems if IN-PACKAGE  changes and MAKE-PACKAGE signals an error if the package exists.  The issue of compile-time processing of package related functions is  complex, and full of a number of compatibility issues. Should we remove  the requirement of special compile-time handling of IN-PACKAGE?   Should we disallow mid-file switching of *PACKAGE* or package  use lists? These issues are not addressed here.  The issue of the "proper" preface for files needs more thought.  Should files that need demand-created packages start with DEFPACKAGE  followed by IN-PACKAGE?".... unless the file begins with an IN-PACKAGE, then the DEFPACKAGE form will be read into totally random package, doing who knows what sort of damage.Ideally, every file of a multi-file module should begin with anIN-PACKAGE form to get "in" that module's package.  The exceptionsare files which might as start out (IN-PACKAGE "USER").   For example, the package creator file might look something like:    (in-package "USER") 	;guaranteed to exist, and not be harmful!    (defpackage :phlogiston ...)Another exception might be the DEFSYSTEM surrogate, which also wouldstart out in the USER package, and simply load the rest of the files."        TITAN 
          TITAN 
        ; -(TEXTFONT 7 (TIMESROMAN 12) NIL (CLASSIC 10))            Z              †                                                 Å                            Ò       1      ‰       
       ·              i              ‰              ò                           2       
       û              À             Ô      Î "zº*start*02177 00024 US Return-Path: <CL-Compiler-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 07 DEC 88 16:26:54 PSTReceived: from Sun.COM by SAIL.Stanford.EDU with TCP; 7 Dec 88  16:20:16 PSTReceived: from snail.Sun.COM by Sun.COM (4.1/SMI-4.0)	id AA07967; Wed, 7 Dec 88 16:22:29 PSTReceived: from clam.sun.com by snail.Sun.COM (4.1/SMI-4.0)	id AA11467; Wed, 7 Dec 88 10:59:27 PSTReceived: by clam.sun.com (3.2/SMI-3.2)	id AA05045; Wed, 7 Dec 88 11:00:24 PSTDate: Wed, 7 Dec 88 11:00:24 PSTFrom: cperdue@Sun.COM (Cris Perdue)Message-Id: <8812071900.AA05045@clam.sun.com>To: cperdue@Sun.COM, jonl@lucid.comSubject: Re:  issue IN-PACKAGE-FUNCTIONALITYCc: cl-cleanup@sail.stanford.edu, cl-compiler@sail.stanford.edu> re: It would be quite nice if the ANSI standard could do without the>     current requirement that LOAD must interleave resolution of symbol >     references and execution of top level forms.  (p.182)  . . .  >     My impression is that it would be within reason to eliminate this >     requirement if we adopt DEFPACKAGE.  Has that been considered?> > No.  The DEFPACKAGE proposal would have no bearing on this, . . .Well, one could eliminate the requirement for implementations to dothis based on the rationale that the strongest motivation is now gone.The reasoning is some kind of cousin to the reasoning that saysimplementations need not treat most package effectors as if wrappedin (EVAL-WHEN (COMPILE ... ) ... ).Remember that even the strictures in CLtL are awkward: it is admittedup front that package effectors "should appear only at top level withina file" (p182).  It isn't *possible* to accomplish the stated objective(" ... when a compiled file is loaded, all of the symbols in the fileend up in the same packages that they would occupy if the Lisp sourcefile were loaded.") -- because READ loses information.To me, if there is going to be DEFPACKAGE, it is better to justacknowledge the problems that exist when compiling files withcompile-time calls to package effectors rather than retaining thecurrent hack half-solution.*start*00984 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 23 JAN 89 02:37:57 PSTReceived: from NSS.Cs.Ucl.AC.UK by SAIL.Stanford.EDU with TCP; 23 Jan 89  02:38:08 PSTReceived: from maths.bath.ac.uk by NSS.Cs.Ucl.AC.UK   via Janet with NIFTP           id aa01380; 23 Jan 89 10:13 GMTReceived: from xenakis by mordell.maths.bath.AC.UK id aa20524;          22 Jan 89 12:25 GMTTo: sandra <@cs.utah.edu:sandra@defun>CC: masinter.pa, cl-cleanup@sail.stanford.eduIn-reply-to: sandra (Sandra J Loosemore)'s message of Fri, 20 Jan 89 15:35:50 MST <8901202235.AA17390@defun.utah.edu>Subject: issue IN-PACKAGE-FUNCTIONALITY, version 5Date: Sun, 22 Jan 89 12:26:26 GMTFrom: jpff%maths.bath.ac.uk@NSS.Cs.Ucl.AC.UKSender: jpff%maths.bath.ac.uk@NSS.Cs.Ucl.AC.UKThis is a very good idea.  I have been caught by the two useds ofin-package many times too much.==Johjn*start*08423 00024 US Return-Path: <sandra%defun@cs.utah.edu>Received: from cs.utah.edu ([128.110.4.21]) by Xerox.COM ; 20 JAN 89 14:59:33 PSTReceived: from defun.utah.edu by cs.utah.edu (5.59/utah-2.1-cs)	id AA00699; Fri, 20 Jan 89 16:00:22 MSTReceived: by defun.utah.edu (5.59/utah-2.0-leaf)	id AA17390; Fri, 20 Jan 89 15:35:52 MSTFrom: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8901202235.AA17390@defun.utah.edu>Date: Fri, 20 Jan 89 15:35:50 MSTSubject: issue IN-PACKAGE-FUNCTIONALITY, version 5To: masinter.pa, cl-cleanup@sail.stanford.eduHere is a new writeup on this issue, incorporating the NEW-MACROproposal I had written on a slide at the meeting.  I have made a fewslight rearrangements and rewordings but the basic content isunchanged. Putting on my hat as the chair of the compiler committee, I willrepeat what I said at the meeting: if people think that this is hasbecome a compiler issue rather than a cleanup issue, we are willing totake it off your hands.  Let me know.Issue:          IN-PACKAGE-FUNCTIONALITYReferences:     IN-PACKAGE (p182-183)Category:       CHANGEEdit history:   07-Jul-88, Version 1 by Pitman                7-Oct-88, Version 2 by Masinter (discussion)                8-Dec-88, Version 3 by Masinter                12-Dec-88, Version 4 by Masinter	        20-Jan-89, Version 5 by LoosemoreRelated-Issues: DEFPACKAGE (passed)		CONSTANT-COMPILABLE-TYPESProblem Description:  There are two typical uses for IN-PACKAGE -- to define/create a package  and to select a package. The fact that these two purposes have been  given to the same function has led to reduced error checking.  A more general problem is that the "Put In Seven Extremely Randoms"   convention described in CLtL is now recognized by many people as being  unsatisfactory for both package definition and package selection.  The DEFPACKAGE macro provides a much cleaner mechanism for package  definition, but there is still a need for a convenient way to select  a package and a concise statement of the requirements for  compile/load consistency.Proposal (IN-PACKAGE-FUNCTIONALITY:NEW-MACRO):  Add a new macro:    WITHIN-PACKAGE name						[macro]    This macro causes *PACKAGE* to be set to the package named NAME,    which must be a symbol or string.  An error is signalled if the    package does not already exist.  Everything this macro does is also    performed at compile time if the call appears at top-level.  Remove the function IN-PACKAGE from the standard.  Remove the second paragraph of section 11.7 in CLtL.  (This includes  the requirement for special compile-time treatment of the various  package functions.)  Replace it with the following language:    When a compiled file is loaded, the symbols it contains are interned    in the same package they occupied when the file was compiled.  A    necessary condition for a program contained in a file to be a    conforming Common Lisp program is that, when the source file is    processed by COMPILE-FILE, all of the symbols in the file be interned    in the same package they would occupy if the source file were    loaded directly with LOAD.  Rationale:    This could allow improved error checking and modularity, with only    minimal loss of functionality.    Making WITHIN-PACKAGE a macro rather than a function means that there    is no need to require COMPILE-FILE to handle it specially.    The rationale for proposing WITHIN-PACKAGE as a replacement for    IN-PACKAGE, rather than simply changing IN-PACKAGE to have this     behavior, is that such an incompatible change would be confusing to    many people, and would make it more difficult to detect obsolete    usages.  There is nothing in this proposal that would prevent    implementations from continuing to provide IN-PACKAGE as an extension.    The language in section 11.7 of CLtL puts the burden on    implementations of ensuring that all symbols in a file which is    compiled and loaded end up in the same package that they would if the    source file were loaded interpretively.  No implementation can    possibly meet this requirement because, in general, the runtime    behavior of the program cannot be determined by the compiler.  The    new language specifies a conformance requirement that is both    well-defined and implementable.  Current Practice:    Probably no one implements this behavior exactly since it's an     incompatible change to CLtL.  Cost to Implementors:    The WITHIN-PACKAGE macro can be implemented trivially by using     EVAL-WHEN in its expansion.    The changes required to COMPILE-FILE to support the new conformance    requirements are also likely to be small.  Cost to Users:    In most cases, minor syntactic changes to some files would be    necessary.  Cost of Non-Adoption:    The specification of COMPILE-FILE will be much more difficult to    understand.    The standard will place requirements on implementations which are    impossible to meet.  Benefits:    Modular package declarations would be encouraged and errors due    to demand-creation of packages would be easier to detect.    The specification of COMPILE-FILE will be simplified.    There will be a clear statement of the requirements for program    conformance, as relating to usage of packages.  Aesthetics:    The fact that IN-PACKAGE is currently ambiguous about intent (whether    the package should exist already or not) is clearly not aesthetic.    Removing it can't be any worse.    The fact that the currently stated requirements for handling of    the package functions by the compiler are not implementable is    clearly not aesthetic.  Proposal (IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY):  Eliminate the ability of IN-PACKAGE to create a package on demand.  Eliminate the :NICKNAMES and :USE arguments to IN-PACKAGE, since they  are no longer needed.  The results of calling IN-PACKAGE if the package does not already  exist are implementation dependent; implementations "should signal"  an error, or otherwise provide the user with a way to recover from  the situation.   Examples:    #1: (IN-PACKAGE 'NO-SUCH-PACKAGE) 	;would signal an error    #2: (DEFPACKAGE FOO ...options...)	;defines/creates a package        (IN-PACKAGE 'FOO)		;selects an existing package  Rationale:    This could allow improved error checking and modularity, with only    minimal loss of functionality.   Current Practice:    Probably no one implements this behavior since it's in direct    contradiction of both the definitions and numerous examples in CLtL.  Cost to Implementors:    As written, no change to implementations is required, but many will    want to make IN-PACKAGE signal an error.  This change would be    straightforward to implement.  The cost may not be trivial in all    cases, but should not be very large.  Cost to Users:    In most cases, minor syntactic changes to some files would be    necessary.    In some cases, no changes would be necessary since files may    already be doing IN-PACKAGE in situations where the author is    hoping he's made sure the real package declaration is already    loaded.  Cost of Non-Adoption:    Reduced error checking.    Less modular code.  Benefits:    Errors due to demand-creation of a package by IN-PACKAGE without    appropriate uses of the :USE or :NICKNAMES or without appropriate    calls to EXPORT, etc. afterward would be easier to detect.    Modular package declarations would be encouraged.  Aesthetics:    The fact that IN-PACKAGE is currently ambiguous about intent (whether    the package should exist already or not) is clearly not aesthetic.    Some people feel this change would be an aesthetic improvement.    Others feel that an incompatible change to IN-PACKAGE would merely    be confusing.Discussion:  The dual use of IN-PACKAGE has not been helpful and is confusing.  Both proposals represent an incompatible change to the language as  described in CLtL and will break any program that uses the "Put In  Seven Extremely Randoms" convention described in section 11.9.  Some people may find proposal NEW-MACRO more palatable if it merely  deprecated IN-PACKAGE, instead of removing it entirely.  Loosemore and Moon support proposal IN-PACKAGE-FUNCTIONALITY:NEW-MACRO.-------*start*02587 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 25 JAN 89 05:23:21 PSTReceived: from lucid.com by SAIL.Stanford.EDU with TCP; 25 Jan 89  05:23:26 PSTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA00905g; Wed, 25 Jan 89 05:18:41 PSTReceived: by bhopal id AA08217g; Wed, 25 Jan 89 05:20:59 PSTDate: Wed, 25 Jan 89 05:20:59 PSTFrom: Jon L White <jonl@lucid.com>Message-Id: <8901251320.AA08217@bhopal>To: sandra%defun@cs.utah.eduCc: cl-cleanup@sail.stanford.eduIn-Reply-To: Sandra J Loosemore's message of Tue, 24 Jan 89 11:41:18 MST <8901241841.AA19619@defun.utah.edu>Subject: issue IN-PACKAGE-FUNCTIONALITY, version 5re: > Conforming to what?  This statement is incredibly imprecise, since the    > packagification of symbols depends on more than simply the text of the    > file.  For example, what do you mean by "all of the symbols in the    > file"?  Suppose I have a macro that does something like    >    (foo x)    ==>  (internal-subr (list x))    > and suppose further I have a file with just the one form (foo 3) in it.    > Now, is FOO a symbol in the file?  Is INTERNAL-SUBR a symbol in the file?    I think my statement is at least as precise as the language in CLtL it    replaces, which also includes the phrase about "all the symbols in the    file".  If you have some alternative language you would like to propose,    please do so.Well, I might love to work on this problem, Sandra, but I do have otherresponsibilities.  Yes, I agree that CLtL is "incredibly imprecise"about the semantics of compiling out symbols; but that is no excuseto jump from the frying pan into the fire.  [In fact, I don't thinkany single issue has caused more trouble amongst even wizard Lispusers as this one -- the re-internment of symbols into a "new" image by a compiled file.]re: > I think I read this as yet another attempt to resurrect the very     > misleading plan of compiling symbols out by package-qualifying each     > and every one of them.      Ummm, this is almost exactly what the cl-compiler issue    CONSTANT-COMPILABLE-TYPES says . . .   I    seem to remember that you were one of the people who argued *for*    specifying that particular handling of symbols.Absolutely not!  You must be thinking of someone else.  The last timethis was discussed on Common-Lisp@SAIL, I remember RWK supporting the position I held -- and for similar reasons; but not many others did.-- JonL --*start*03445 00024 US Return-Path: <jonl@lucid.com>Received: from lucid.com ([192.26.25.1]) by Xerox.COM ; 24 JAN 89 03:25:59 PSTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA01267g; Tue, 24 Jan 89 03:22:36 PSTReceived: by bhopal id AA04366g; Tue, 24 Jan 89 03:24:57 PSTDate: Tue, 24 Jan 89 03:24:57 PSTFrom: Jon L White <jonl@lucid.com>Message-Id: <8901241124.AA04366@bhopal>To: sandra%defun@cs.utah.eduCc: masinter.pa, cl-cleanup@sail.stanford.eduIn-Reply-To: Sandra J Loosemore's message of Fri, 20 Jan 89 15:35:50 MST <8901202235.AA17390@defun.utah.edu>Subject: issue IN-PACKAGE-FUNCTIONALITY, version 5I don't see the new macro name solving any fundamental problem that isworth a tremendous incompatible change.  In fact, it doesn't even solvethe specification problem, since you would now have to remove the linesthat talked about special treatment (read: evaluation when found attop-level of compile-file) and add virtually identical lines specifying what the macro expansion of WITHIN-PACKAGE does.Beyond that, there are some sections that I have problems with:re:     This macro causes *PACKAGE* to be set to the package named NAME,When?  At macro expansion time?  or do you mean it is a trivialexpansion into (setq *package* ...)?re:  . . . Everything this macro does is also    performed at compile time if the call appears at top-level.Oh really?  Then structurally, the specification is identical to IN-PACKAGE?re:     When a compiled file is loaded, the symbols it contains are interned	in the same package they occupied when the file was compiled.  I think I read this as yet another attempt to resurrect the very misleadingplan of compiling symbols out by package-qualifying each and every one ofthem.  Think about making this requirement on PRINT.  Under this rule, it would be hopeless for a source file and compiled file to "do the same thing",since the original source had most symbols unqualified, and the "processed"version had all symbols qualified.  Thus in later loadings, the originalsource would simply "float" to wherever the current inheritance of symbolscame from; but the "dumped" version would (incompatibly) require them to be in specific packages.   This is too long an issue to debate over the mails, but I wonder how many readers have themselves gone through the enlightening phase of trying out "qualify all symbols" and finding the flaws in it?re:     A  necessary condition for a program contained in a file to be a	conforming Common Lisp program is that, when the source file is	processed by COMPILE-FILE, all of the symbols in the file be interned	in the same package they would occupy if the source file were	loaded directly with LOAD.Conforming to what?  This statement is incredibly imprecise, since thepackagification of symbols depends on more than simply the text of thefile.  For example, what do you mean by "all of the symbols in thefile"?  Suppose I have a macro that does something like   (foo x)    ==>  (internal-subr (list x))and suppose further I have a file with just the one form (foo 3) in it.Now, is FOO a symbol in the file?  Is INTERNAL-SUBR a symbol in the file?and what guarantee is there that FOO expands the same way when "in thecompiler" as when running interpretively?  [many implementations doprovide a way to find out kludgily whether or not you are "in thecompiler"].-- JonL --*start*03966 00024 US Return-Path: <sandra%defun@cs.utah.edu>Received: from cs.utah.edu ([128.110.4.21]) by Xerox.COM ; 24 JAN 89 10:41:43 PSTReceived: from defun.utah.edu by cs.utah.edu (5.59/utah-2.1-cs)	id AA08779; Tue, 24 Jan 89 11:41:28 MSTReceived: by defun.utah.edu (5.59/utah-2.0-leaf)	id AA19619; Tue, 24 Jan 89 11:41:20 MSTFrom: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8901241841.AA19619@defun.utah.edu>Date: Tue, 24 Jan 89 11:41:18 MSTSubject: Re: issue IN-PACKAGE-FUNCTIONALITY, version 5To: Jon L White <jonl@lucid.com>Cc: sandra%defun@cs.utah.edu, masinter.pa, cl-cleanup@sail.stanford.eduIn-Reply-To: Jon L White <jonl@lucid.com>, Tue, 24 Jan 89 03:24:57 PST> Date: Tue, 24 Jan 89 03:24:57 PST> From: Jon L White <jonl@lucid.com>> > I don't see the new macro name solving any fundamental problem that is> worth a tremendous incompatible change.  In fact, it doesn't even solve> the specification problem, since you would now have to remove the lines> that talked about special treatment (read: evaluation when found at> top-level of compile-file) and add virtually identical lines specifying > what the macro expansion of WITHIN-PACKAGE does.The reason why WITHIN-PACKAGE is a macro is because it allows itsspecial treatment by compile-file to be explained by it expanding intoan EVAL-WHEN, rather than by requiring the compiler to treat it as aspecial form.  You yourself have argued that this is how othercompile-time magic (such as DEFMACRO) ought to be explained.> re:     This macro causes *PACKAGE* to be set to the package named NAME,> > When?  At macro expansion time?  or do you mean it is a trivial> expansion into (setq *package* ...)?> > re:  . . . Everything this macro does is also>     performed at compile time if the call appears at top-level.> > Oh really?  Then structurally, the specification is identical to IN-PACKAGE?Well, what I had in mind was something like    (defmacro within-package (name)        `(eval-when (eval compile load)	     (setq *package*	           (or (find-package ',name)		       (error "Package ~s does not exist." ',name)))))Yes, you're right that the specification is virtually identical towhat the SELECT-ONLY proposal specifies for IN-PACKAGE, except thatWITHIN-PACKAGE is a macro. > re:     When a compiled file is loaded, the symbols it contains are interned> 	in the same package they occupied when the file was compiled.  > > I think I read this as yet another attempt to resurrect the very misleading> plan of compiling symbols out by package-qualifying each and every one of> them.  Ummm, this is almost exactly what the cl-compiler issueCONSTANT-COMPILABLE-TYPES says about symbols ("If the symbol isinterned, its name and the name of its home package identify it").  Iseem to remember that you were one of the people who argued *for*specifying that particular handling of symbols.> re:     A  necessary condition for a program contained in a file to be a> 	conforming Common Lisp program is that, when the source file is> 	processed by COMPILE-FILE, all of the symbols in the file be interned> 	in the same package they would occupy if the source file were> 	loaded directly with LOAD.> > Conforming to what?  This statement is incredibly imprecise, since the> packagification of symbols depends on more than simply the text of the> file.  For example, what do you mean by "all of the symbols in the> file"?  Suppose I have a macro that does something like>    (foo x)    ==>  (internal-subr (list x))> and suppose further I have a file with just the one form (foo 3) in it.> Now, is FOO a symbol in the file?  Is INTERNAL-SUBR a symbol in the file?I think my statement is at least as precise as the language in CLtL itreplaces, which also includes the phrase about "all the symbols in thefile".  If you have some alternative language you would like to propose,please do so.-Sandra-------*start*05244 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 29 JAN 89 14:28:37 PSTReceived: from cs.utah.edu by SAIL.Stanford.EDU with TCP; 29 Jan 89  14:28:40 PSTReceived: from defun.utah.edu by cs.utah.edu (5.59/utah-2.1-cs)	id AA23795; Sun, 29 Jan 89 15:27:08 MSTReceived: by defun.utah.edu (5.59/utah-2.0-leaf)	id AA23517; Sun, 29 Jan 89 15:27:00 MSTFrom: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8901292227.AA23517@defun.utah.edu>Date: Sun, 29 Jan 89 15:26:58 MSTSubject: Re: issue IN-PACKAGE-FUNCTIONALITY, version 5To: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Cc: Sandra J Loosemore <sandra%defun@cs.utah.edu>, cl-cleanup@SAIL.STANFORD.EDU, cl-compiler@sail.stanford.eduIn-Reply-To: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>, Fri, 27 Jan 89 21:42 ESTHere is some wording that borrows from what you used, that says prettymuch what I intended to say in my original proposal.   When a compiled file is loaded, the interned symbols it references are  found by calling INTERN at load time with two arguments, the name of  the symbol and the package with the same name as the compile-time  symbol's home package.  If no such package exists, an error is  signalled. As far as I can make out, there are two situations where the twoproposals specify different behavior:(1) The situation where there is a symbol accessible in thecompile-time value of *PACKAGE*, but with another home package.  Yourproposal would have the loader INTERN the symbol in the load-timevalue of *PACKAGE*, and mine would have it INTERN the symbol in itscompile-time home package.  Unless there is an existing symbol withthe appropriate name that is accessible in both packages, theload-time home package of the resulting symbol would differ under thetwo proposals.(2) The situation where a symbol is external at compile time, butwhere there is no such external symbol at load time.  Your proposalwould quietly INTERN it as internal symbol in *PACKAGE* if the symbolwere accessible in the compile-time *PACKAGE*, and otherwise signal anerror.  Mine would always just quietly INTERN the symbol as internalin its home package. The more I think about this, the more I have come to believe that noconforming program ought to cause either of these two situations toarise, and that we could just leave the behavior unspecified in thesecases.  It's a user interface issue, much like what happens when youincompatibly redefine a DEFSTRUCT.  Or, to give a stronger parallel,it's like what happens when you load a file that was compiled withsome DEFSTRUCT definitions that are incompatible with the DEFSTRUCTdefinitions that happen to be around at load time.  (ProposalCOMPILE-ENVIRONMENT-CONSISTENCY says that the behavior is unspecifiedin that situation.)As I understand it, one rationale for the proposal you suggest is thatit makes LOADing compiled files more like LOADing source files, in thatsymbols that would be interned in *PACKAGE* when the source file is loaded ought to also be interned in *PACKAGE* when the compiled fileis loaded, regardless of what the compile-time value of *PACKAGE* was.Here is an example to explain why I believe that the compile-timevalue of *PACKAGE* -does- matter.  PCLS has two different packages,the PSL package and the LISP package, which do not use each other.Many functions, macros, and special forms with the same names exist inboth packages as distinct symbols with different definitions.  If Ihave a file that really wants to use the Common Lisp definitions,rather than the PSL definitions, the symbols from LISP package -must-be accessible at compile time in order for the compiler to apply theright set of macro expansions and use the right set of special formcompilers.  If the compile-time *PACKAGE* is such that the PSL packagemacros get used instead, then the compiled file would end upreferencing functions that don't even exist in the LISP package, andunder your proposal you'd lose no matter what the load-time value of*PACKAGE* is.  This is why PCLS ended up including an explicit packageprefix on all symbols in compiled files.  The same considerationsapply equally well when talking about user-defined macros and all theother kinds of things that the compiler is allowed to "wire in" to thecode it compiles. Basically, what I would like to do is come up with a unified proposalthat is compatible with both of the existing ones where they agree,and leave what happens in the situations where they disagree to beexplicitly vague.  In other words, it would place some additionalCOMPILE-FILE/LOAD consistency requirements on conforming programs --something along the lines of saying that the compile-time value of*PACKAGE* must be the same as the load-time value, any symbolsreferenced in the compiled file that are accessible in *PACKAGE* butwith another home package at compile-time must also be accessible inboth packages at load-time, etc.  (I'll obviously have to think aboutthis some more to get all the details right.)Do you approve of this general direction?-Sandra-------*start*02638 00024 US Return-Path: <sandra%defun@cs.utah.edu>Received: from cs.utah.edu ([128.110.4.21]) by Xerox.COM ; 28 JAN 89 10:10:07 PSTReceived: from defun.utah.edu by cs.utah.edu (5.59/utah-2.1-cs)	id AA04670; Sat, 28 Jan 89 11:09:52 MSTReceived: by defun.utah.edu (5.59/utah-2.0-leaf)	id AA22944; Sat, 28 Jan 89 11:09:43 MSTFrom: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8901281809.AA22944@defun.utah.edu>Date: Sat, 28 Jan 89 11:09:42 MSTSubject: Re: issue IN-PACKAGE-FUNCTIONALITY, version 5To: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Cc: Sandra J Loosemore <sandra%defun@cs.utah.edu>, masinter.pa, cl-cleanup@SAIL.STANFORD.EDUIn-Reply-To: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>, Fri, 27 Jan 89 21:42 ESTA few comments on your amendment:I am not sure why you think NIL must be treated specially, any morethan any other external symbol in the Lisp package.I think the idea of trying to confine WITHIN-PACKAGE to being thefirst form in the file is bogus, and the difficulty you have indefining "first" is one reason why.  Another thing is that the obviousreplacement for the "Put In Seven Extremely Randoms" convention is toput a DEFPACKAGE at the top of the file, followed by a WITHIN-PACKAGE.(I know that this convention is generally regarded as broken at leastin the case of multiple files in the same package, but many users havetried to follow the recommendation given in CLtL, and this is areasonable thing to do if you've got a short module all in one file.)The compile-time effects of WITHIN-PACKAGE can be well-definedregardless of whether or not it appears first in the file, anyway.Perhaps if I think about this a while longer I can come up with analternate specification that will still let you include the special casefor symbols accessible in *PACKAGE* and avoid the kind of problems Imentioned in my previous message.As to splitting this up as a separate issue, that might be a good ideasince it appears there will be at least two alternatives.  I thinkIN-PACKAGE-FUNCTIONALITY:NEW-MACRO ought to include the parts aboutadding WITHIN-PACKAGE, removing IN-PACKAGE, and deleting thetroublesome paragraph in CLtL that implies COMPILE-FILE has to treatthe package functions specially (since the whole motivation for makingWITHIN-PACKAGE a macro is to avoid this requirement).  I will start anew compiler issue (called COMPILE-FILE-SYMBOL-HANDLING, unless I geta better suggestion), that combines the parts from this issue andissue CONSTANT-COMPILABLE-TYPES that deal with what package symbols endup in.  Sound OK?-Sandra-------*start*03433 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 27 JAN 89 18:44:01 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 27 Jan 89  18:44:11 PSTReceived: from EUPHRATES.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 528651; Fri 27-Jan-89 21:41:30 ESTDate: Fri, 27 Jan 89 21:42 ESTFrom: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Subject: issue IN-PACKAGE-FUNCTIONALITY, version 5To: Sandra J Loosemore <sandra%defun@cs.utah.edu>cc: masinter.pa, cl-cleanup@SAIL.STANFORD.EDUIn-Reply-To: <8901202235.AA17390@defun.utah.edu>Message-ID: <19890128024204.1.MOON@EUPHRATES.SCRC.Symbolics.COM>Line-fold: NoI fully agree with the first part of this proposal (remove IN-PACKAGE,add WITHIN-PACKAGE).  Like JonL, I disagree with the second part (whatCOMPILE-FILE does with symbols).  Part of the problem is it uses thewords "interned" and "occupied" which are not given precise definitions.Here is a suggested recasting of that paragraph of your proposal usingthe words defined at the beginning of the chapter:    When a compiled file is loaded, the interned symbols it references    are found by the following procedure.  The rules are applied in the    order listed and only the first applicable rule has any effect.    (1) The distinguished empty list symbol NIL retains its identity.        (2) Any symbol accessible at compile time in the package that is the    value of *PACKAGE* is found by calling INTERN at load time with one    argument, the name of the symbol.    (3) A keyword symbol is found by finding or creating a keyword    symbol with the same name.        (4) A symbol that at compile time is an external symbol of its home    package is found at load time by finding the package with the same    name as the compile-time home package, and then finding an exported    symbol of that package with the same name as the compile-time    symbol.  If no such package exists, no such symbol exists, or the    symbol is not exported, an error is signalled.    (5) Any other symbol is found by calling INTERN at load time with    two arguments, the name of the symbol and the package with the same    name as the compile-time symbol's home package.  If no such package    exists, an error is signalled.The goal of this procedure is for each symbol reference to beresolved to the same symbol when a compiled file is loaded as whenthe source file is loaded directly with LOAD.  It is possible tocreate package structures that make that impossible; for example, itis possible for a symbol to be inaccessible from its own homepackage.  A conforming program cannot depend on any symbolresolution behavior that is not provided by the above five rules.If any top level form in a compiled file changes the value of*PACKAGE*, other than a WITHIN-PACKAGE appearing as the firsteffective top level form in the file, the results are unspecified.[What I mean by "effective top level form" is to include x inconstructs like (PROGN x ...) and macros that expand into x.  Do youcompiler people have a name for this?  That is, a WITHIN-PACKAGEmust be the first top level form that has any effect.]Perhaps this should be a separate proposal from IN-PACKAGE-FUNCTIONALITY?*start*01412 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 30 JAN 89 09:10:38 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 30 Jan 89  09:10:46 PSTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 529981; Mon 30-Jan-89 12:07:19 ESTDate: Mon, 30 Jan 89 12:07 ESTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: issue IN-PACKAGE-FUNCTIONALITY, version 5To: Moon@STONY-BROOK.SCRC.Symbolics.COMcc: sandra%defun@cs.utah.edu, masinter.pa, cl-cleanup@SAIL.STANFORD.EDUIn-Reply-To: <19890128024204.1.MOON@EUPHRATES.SCRC.Symbolics.COM>Message-ID: <890130120708.8.KMP@BOBOLINK.SCRC.Symbolics.COM>I happen not to like the name WITHIN-PACKAGE.All of the other package operations are verbs. USE-xxx, MAKE-xxx,EXPORT-xxx, etc. IN-PACKAGE has always been a glaring exception,perhaps deliberately due to its dual role, perhaps due to oversight.Anyway, I would just as soon see this use a verb, too.Also, if IN-PACKAGE is retained for compatibility, I predict thatpeople will confuse it with WITHIN-PACKAGE often enough to bean annoyance. I think that if we can conveniently avoid that gratuitous confusion, we should do so.I suggest the name SELECT-PACKAGE.*start*00992 00024 US Return-Path: <sandra%defun@cs.utah.edu>Received: from cs.utah.edu ([128.110.4.21]) by Xerox.COM ; 30 JAN 89 09:13:28 PSTReceived: from defun.utah.edu by cs.utah.edu (5.59/utah-2.1-cs)	id AA10192; Mon, 30 Jan 89 10:11:52 MSTReceived: by defun.utah.edu (5.59/utah-2.0-leaf)	id AA25499; Mon, 30 Jan 89 10:11:37 MSTFrom: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8901301711.AA25499@defun.utah.edu>Date: Mon, 30 Jan 89 10:11:36 MSTSubject: Re: issue IN-PACKAGE-FUNCTIONALITY, version 5To: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Cc: Moon@STONY-BROOK.SCRC.Symbolics.COM, sandra%defun@cs.utah.edu, masinter.pa, cl-cleanup@SAIL.STANFORD.EDUIn-Reply-To: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>, Mon, 30 Jan 89 12:07 ESTSELECT-PACKAGE is fine with me.  I was never very happy withWITHIN-PACKAGE myself, but it was the best I could come up with (and Ididn't get any better suggestions the last time I asked).-Sandra-------*start*01264 00024 US Return-Path: <KMP@STONY-BROOK.SCRC.Symbolics.COM>Received: from STONY-BROOK.SCRC.Symbolics.COM ([128.81.41.144]) by Xerox.COM ; 30 JAN 89 09:35:32 PSTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 529981; Mon 30-Jan-89 12:07:19 ESTDate: Mon, 30 Jan 89 12:07 ESTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: issue IN-PACKAGE-FUNCTIONALITY, version 5To: Moon@STONY-BROOK.SCRC.Symbolics.COMcc: sandra%defun@cs.utah.edu, masinter.pa, cl-cleanup@SAIL.STANFORD.EDUIn-Reply-To: <19890128024204.1.MOON@EUPHRATES.SCRC.Symbolics.COM>Message-ID: <890130120708.8.KMP@BOBOLINK.SCRC.Symbolics.COM>I happen not to like the name WITHIN-PACKAGE.All of the other package operations are verbs. USE-xxx, MAKE-xxx,EXPORT-xxx, etc. IN-PACKAGE has always been a glaring exception,perhaps deliberately due to its dual role, perhaps due to oversight.Anyway, I would just as soon see this use a verb, too.Also, if IN-PACKAGE is retained for compatibility, I predict thatpeople will confuse it with WITHIN-PACKAGE often enough to bean annoyance. I think that if we can conveniently avoid that gratuitous confusion, we should do so.I suggest the name SELECT-PACKAGE.*start*08492 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 30 JAN 89 18:27:08 PSTReceived: from cs.utah.edu by SAIL.Stanford.EDU with TCP; 30 Jan 89  18:26:34 PSTReceived: from defun.utah.edu by cs.utah.edu (5.59/utah-2.1-cs)	id AA07555; Mon, 30 Jan 89 19:24:53 MSTReceived: by defun.utah.edu (5.59/utah-2.0-leaf)	id AA25846; Mon, 30 Jan 89 19:24:50 MSTFrom: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8901310224.AA25846@defun.utah.edu>Date: Mon, 30 Jan 89 19:24:48 MSTSubject: issue IN-PACKAGE-FUNCTIONALITY, version 6To: cl-cleanup@sail.stanford.eduCc: cl-compiler@sail.stanford.eduHere is a new version of the writeup on this issue which incorporatesall of the suggestions I've received so far.  In particular, all of theparts dealing with compile/load package consistency requirements havebeen split off to a new cl-compiler issue, COMPILE-FILE-SYMBOL-HANDLING (I'm working on a draft writeup).  And, the name of the macro has been changed to SELECT-PACKAGE.Issue:          IN-PACKAGE-FUNCTIONALITYReferences:     IN-PACKAGE (p182-183)Category:       CHANGEEdit history:   07-Jul-88, Version 1 by Pitman                7-Oct-88, Version 2 by Masinter (discussion)                8-Dec-88, Version 3 by Masinter                12-Dec-88, Version 4 by Masinter	        20-Jan-89, Version 5 by Loosemore		30-Jan-89, Version 6 by LoosemoreRelated-Issues: DEFPACKAGE (passed)		COMPILE-FILE-SYMBOL-HANDLINGProblem Description:  There are two typical uses for IN-PACKAGE -- to define/create a package  and to select a package. The fact that these two purposes have been  given to the same function has led to reduced error checking.  A more general problem is that the "Put In Seven Extremely Randoms"   convention described in CLtL is now recognized by many people as being  unsatisfactory for both package definition and package selection.  The DEFPACKAGE macro provides a much cleaner mechanism for package  definition, but there is still a need for a convenient way to select  a package that has well-defined compilation semantics.Proposal (IN-PACKAGE-FUNCTIONALITY:NEW-MACRO):  Add a new macro:    SELECT-PACKAGE name						[macro]    This macro causes *PACKAGE* to be set to the package named NAME,    which must be a symbol or string.  An error is signalled if the    package does not already exist.  Everything this macro does is also    performed at compile time if the call appears at top-level.  Remove the function IN-PACKAGE from the standard.  Remove the second paragraph of section 11.7 in CLtL.  (This includes  the requirement for special compile-time treatment of the various  package functions.)  Rationale:    This could allow improved error checking and modularity, with only    minimal loss of functionality.    The rationale for proposing SELECT-PACKAGE as a replacement for    IN-PACKAGE, rather than simply changing IN-PACKAGE to have this     behavior, is that such an incompatible change would be confusing to    many people, and would make it more difficult to detect obsolete    usages.  There is nothing in this proposal that would prevent    implementations from continuing to provide IN-PACKAGE as an extension.    Making SELECT-PACKAGE a macro rather than a function means that there    is no need to require COMPILE-FILE to handle it specially.  Since    DEFPACKAGE is also defined to side-effect the compilation environment,    there is no need to require any of the package functions to be treated    specially by the compiler.    The language in section 11.7 of CLtL puts the burden on    implementations of ensuring that all symbols in a file which is    compiled and loaded end up in the same package that they would if the    source file were loaded interpretively.  No implementation can    possibly meet this requirement because, in general, the runtime    behavior of the program cannot be predicted by the compiler.  Current Practice:    Probably no one implements this behavior exactly since it's an     incompatible change to CLtL.  Cost to Implementors:    The SELECT-PACKAGE macro can be implemented trivially by using     EVAL-WHEN in its expansion:    (defmacro within-package (name)        `(eval-when (eval compile load)	     (setq *package*	           (or (find-package ',name)		       (error "Package ~s does not exist." ',name)))))    The changes required to COMPILE-FILE to remove the magic treatment    of the package functions are also likely to be small.  Cost to Users:    In most cases, minor syntactic changes to some files would be    necessary.  Programmers that are now using the "Put In Seven    Extremely Randoms" convention will probably find it straightforward    to convert their code to do a DEFPACKAGE followed by a     SELECT-PACKAGE.  Cost of Non-Adoption:    The specification of COMPILE-FILE will be much more difficult to    understand.    The standard will require compilers to solve the halting problem.  Benefits:    Modular package declarations would be encouraged and errors due    to demand-creation of packages would be easier to detect.    The specification of COMPILE-FILE will be simplified.    There will be a clear statement of the requirements for program    conformance, as relating to usage of packages.  Aesthetics:    The fact that IN-PACKAGE is currently ambiguous about intent (whether    the package should exist already or not) is clearly not aesthetic.    Removing it can't be any worse.    The fact that the currently stated requirements for handling of    the package functions by the compiler are not implementable is    clearly not aesthetic.Proposal (IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY):  Eliminate the ability of IN-PACKAGE to create a package on demand.  Eliminate the :NICKNAMES and :USE arguments to IN-PACKAGE, since they  are no longer needed.  The results of calling IN-PACKAGE if the package does not already  exist are implementation dependent; implementations "should signal"  an error, or otherwise provide the user with a way to recover from  the situation.   Examples:    #1: (IN-PACKAGE 'NO-SUCH-PACKAGE) 	;would signal an error    #2: (DEFPACKAGE FOO ...options...)	;defines/creates a package        (IN-PACKAGE 'FOO)		;selects an existing package  Rationale:    This could allow improved error checking and modularity, with only    minimal loss of functionality.   Current Practice:    Probably no one implements this behavior since it's in direct    contradiction of both the definitions and numerous examples in CLtL.  Cost to Implementors:    As written, no change to implementations is required, but many will    want to make IN-PACKAGE signal an error.  This change would be    straightforward to implement.  The cost may not be trivial in all    cases, but should not be very large.  Cost to Users:    In most cases, minor syntactic changes to some files would be    necessary.    In some cases, no changes would be necessary since files may    already be doing IN-PACKAGE in situations where the author is    hoping he's made sure the real package declaration is already    loaded.  Cost of Non-Adoption:    Reduced error checking.    Less modular code.  Benefits:    Errors due to demand-creation of a package by IN-PACKAGE without    appropriate uses of the :USE or :NICKNAMES or without appropriate    calls to EXPORT, etc. afterward would be easier to detect.    Modular package declarations would be encouraged.  Aesthetics:    The fact that IN-PACKAGE is currently ambiguous about intent (whether    the package should exist already or not) is clearly not aesthetic.    Some people feel this change would be an aesthetic improvement.    Others feel that an incompatible change to IN-PACKAGE would merely    be confusing.Discussion:  The dual use of IN-PACKAGE has not been helpful and is confusing.  Both proposals represent an incompatible change to the language as  described in CLtL and will break any program that uses the "Put In  Seven Extremely Randoms" convention described in section 11.9.  Some people may find proposal NEW-MACRO more palatable if it merely  deprecated IN-PACKAGE, instead of removing it entirely.  Loosemore and Moon support proposal IN-PACKAGE-FUNCTIONALITY:NEW-MACRO.-------*start*00782 00024 US Return-Path: <sandra%defun@cs.utah.edu>Received: from cs.utah.edu ([128.110.4.21]) by Xerox.COM ; 06 MAR 89 08:22:49 PSTReceived: from defun.utah.edu by cs.utah.edu (5.61/utah-2.1-cs)	id AA15324; Mon, 6 Mar 89 09:22:43 -0700Received: by defun.utah.edu (5.61/utah-2.0-leaf)	id AA06489; Mon, 6 Mar 89 09:22:41 -0700From: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8903061622.AA06489@defun.utah.edu>Date: Mon, 6 Mar 89 09:22:40 MSTSubject: Re: issue IN-PACKAGE-FUNCTIONALITYTo: masinter.paIn-Reply-To: masinter.pa@Xerox.COM, 6 Mar 89 08:19 PSTFine.  I was just wondering if there had been some additional discussionon the issue that hadn't been cc'ed to me, that you were expecting to getsome response from me on.-Sandra-------*start*01071 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 09 MAR 89 13:34:16 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 9 Mar 89  13:34:10 PSTReceived: from EUPHRATES.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 554064; Thu 9-Mar-89 16:31:08 ESTDate: Thu, 9 Mar 89 16:30 ESTFrom: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Subject: issue IN-PACKAGE-FUNCTIONALITY, version 6To: Sandra J Loosemore <sandra%defun@cs.utah.edu>cc: cl-cleanup@sail.stanford.edu, cl-compiler@sail.stanford.eduIn-Reply-To: <8901310224.AA25846@defun.utah.edu>Message-ID: <19890309213057.3.MOON@EUPHRATES.SCRC.Symbolics.COM>IN-PACKAGE-FUNCTIONALITY:NEW-MACRO is fine with me.  Typo:the name of the new macro is misspelled in the example codein the cost to implementors section.I don't like the alternate IN-PACKAGE-FUNCTIONALITY:SELECT-ONLYproposal as well.*start*01011 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 09 MAR 89 15:41:46 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 9 Mar 89  15:40:56 PSTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 554242; Thu 9-Mar-89 18:38:22 ESTDate: Thu, 9 Mar 89 18:38 ESTFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: issue IN-PACKAGE-FUNCTIONALITY, version 6To: sandra%defun@cs.utah.educc: cl-cleanup@sail.stanford.eduIn-Reply-To: <8901310224.AA25846@defun.utah.edu>Message-ID: <890309183811.7.KMP@BOBOLINK.SCRC.Symbolics.COM>I support NEW-MACRO, though would really prefer you change "remove" to"deprecate".  Making this an incompatible change is gratuitous.In either case, I agree with Moon that removing the SELECT-ONLYoption would eliminate some clutter.*start*06111 00024 USfReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 10 MAR 89 09:16:01 PSTReceived: from cs.utah.edu by SAIL.Stanford.EDU with TCP; 10 Mar 89  09:15:59 PSTReceived: from defun.utah.edu by cs.utah.edu (5.61/utah-2.1-cs)	id AA24750; Fri, 10 Mar 89 10:13:52 -0700Received: by defun.utah.edu (5.61/utah-2.0-leaf)	id AA10642; Fri, 10 Mar 89 10:13:50 -0700From: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8903101713.AA10642@defun.utah.edu>Date: Fri, 10 Mar 89 10:13:48 MSTSubject: issue IN-PACKAGE-FUNCTIONALITY, version 7To: cl-cleanup@sail.stanford.eduCc: cl-compiler@sail.stanford.eduHere's a new version of the writeup for this issue.  Since Pitman hasindicated he wants to withdraw the SELECT-ONLY proposal, it has goneaway.  I also fixed the typo noted by Moon. Issue:          IN-PACKAGE-FUNCTIONALITYReferences:     IN-PACKAGE (p182-183)Category:       CHANGEEdit history:   07-Jul-88, Version 1 by Pitman                7-Oct-88, Version 2 by Masinter (discussion)                8-Dec-88, Version 3 by Masinter                12-Dec-88, Version 4 by Masinter	        20-Jan-89, Version 5 by Loosemore		30-Jan-89, Version 6 by Loosemore		10-Mar-89, Version 7 by LoosemoreRelated-Issues: DEFPACKAGE (passed)		COMPILE-FILE-SYMBOL-HANDLINGProblem Description:  There are two typical uses for IN-PACKAGE -- to define/create a package  and to select a package. The fact that these two purposes have been  given to the same function has led to reduced error checking.  A more general problem is that the "Put In Seven Extremely Randoms"   convention described in CLtL is now recognized by many people as being  unsatisfactory for both package definition and package selection.  The DEFPACKAGE macro provides a much cleaner mechanism for package  definition, but there is still a need for a convenient way to select  a package that has well-defined compilation semantics.Proposal (IN-PACKAGE-FUNCTIONALITY:NEW-MACRO):  Add a new macro:    SELECT-PACKAGE name						[macro]    This macro causes *PACKAGE* to be set to the package named NAME,    which must be a symbol or string.  An error is signalled if the    package does not already exist.  Everything this macro does is also    performed at compile time if the call appears at top-level.  Remove the function IN-PACKAGE from the standard.  Remove the second paragraph of section 11.7 in CLtL.  (This includes  the requirement for special compile-time treatment of the various  package functions.)  Rationale:    This could allow improved error checking and modularity, with only    minimal loss of functionality.    The rationale for proposing SELECT-PACKAGE as a replacement for    IN-PACKAGE, rather than simply changing IN-PACKAGE to have this     behavior, is that such an incompatible change would be confusing to    many people, and would make it more difficult to detect obsolete    usages.  There is nothing in this proposal that would prevent    implementations from continuing to provide IN-PACKAGE as an extension.    Making SELECT-PACKAGE a macro rather than a function means that there    is no need to require COMPILE-FILE to handle it specially.  Since    DEFPACKAGE is also defined to side-effect the compilation environment,    there is no need to require any of the package functions to be treated    specially by the compiler.    The language in section 11.7 of CLtL puts the burden on    implementations of ensuring that all symbols in a file which is    compiled and loaded end up in the same package that they would if the    source file were loaded interpretively.  No implementation can    possibly meet this requirement because, in general, the runtime    behavior of the program cannot be predicted by the compiler.  Current Practice:    Probably no one implements this behavior exactly since it's an     incompatible change to CLtL.  Cost to Implementors:    The SELECT-PACKAGE macro can be implemented trivially by using     EVAL-WHEN in its expansion:    (defmacro select-package (name)        `(eval-when (eval compile load)	     (setq *package*	           (or (find-package ',name)		       (error "Package ~s does not exist." ',name)))))    The changes required to COMPILE-FILE to remove the magic treatment    of the package functions are also likely to be small.  Cost to Users:    In most cases, minor syntactic changes to some files would be    necessary.  Programmers that are now using the "Put In Seven    Extremely Randoms" convention will probably find it straightforward    to convert their code to do a DEFPACKAGE followed by a     SELECT-PACKAGE.  Cost of Non-Adoption:    The specification of COMPILE-FILE will be much more difficult to    understand.    The standard will require compilers to solve the halting problem.  Benefits:    Modular package declarations would be encouraged and errors due    to demand-creation of packages would be easier to detect.    The specification of COMPILE-FILE will be simplified.    There will be a clear statement of the requirements for program    conformance, as relating to usage of packages.  Aesthetics:    The fact that IN-PACKAGE is currently ambiguous about intent (whether    the package should exist already or not) is clearly not aesthetic.    Removing it can't be any worse.    The fact that the currently stated requirements for handling of    the package functions by the compiler are not implementable is    clearly not aesthetic.Discussion:  The dual use of IN-PACKAGE has not been helpful and is confusing.  Some people may find proposal NEW-MACRO more palatable if it merely  deprecated IN-PACKAGE, instead of removing it entirely.  Loosemore and Moon support proposal IN-PACKAGE-FUNCTIONALITY:NEW-MACRO.  Pitman says:    I support NEW-MACRO, though would really prefer you change "remove" to    "deprecate".  Making this an incompatible change is gratuitous.-------*start*00880 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 10 MAR 89 10:00:26 PSTReceived: from STONY-BROOK.SCRC.Symbolics.COM (SCRC-STONY-BROOK.ARPA) by SAIL.Stanford.EDU with TCP; 10 Mar 89  09:59:57 PSTReceived: from EUPHRATES.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via INTERNET with SMTP id 554628; 10 Mar 89 12:55:40 ESTDate: Fri, 10 Mar 89 12:55 ESTFrom: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>Subject: issue IN-PACKAGE-FUNCTIONALITY, version 7To: Sandra J Loosemore <sandra%defun@cs.utah.edu>cc: cl-cleanup@sail.stanford.edu, cl-compiler@sail.stanford.eduIn-Reply-To: <8903101713.AA10642@defun.utah.edu>Message-ID: <19890310175523.4.MOON@EUPHRATES.SCRC.Symbolics.COM>IN-PACKAGE-FUNCTIONALITY:NEW-MACRO is okay with me.*start*00899 00024 US Return-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 10 MAR 89 15:53:29 PSTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 10 Mar 89  15:53:15 PSTReceived: from Semillon.ms by ArpaGateway.ms ; 10 MAR 89 15:50:29 PSTDate: 10 Mar 89 15:49 PSTFrom: masinter.paSubject: Re: issue IN-PACKAGE-FUNCTIONALITY, version 7In-reply-to: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>'s message of Fri, 10 Mar 89 12:55 ESTTo: David A. Moon <Moon@STONY-BROOK.SCRC.Symbolics.COM>cc: Sandra J Loosemore <sandra%defun@cs.utah.edu>, cl-cleanup@sail.stanford.edu, cl-compiler@sail.stanford.eduMessage-ID: <890310-155029-16287@Xerox>maybe I'm late, but I still liked SELECT-ONLY better than NEW-MACRO. Justto calibrate, I didn't like removing REQUIRE & PROVIDE, either.*start*00675 00024 US Return-Path: <sandra%defun@cs.utah.edu>Received: from cs.utah.edu ([128.110.4.21]) by Xerox.COM ; 10 MAR 89 16:12:42 PSTReceived: from defun.utah.edu by cs.utah.edu (5.61/utah-2.1-cs)	id AA13439; Fri, 10 Mar 89 17:12:24 -0700Received: by defun.utah.edu (5.61/utah-2.0-leaf)	id AA11141; Fri, 10 Mar 89 17:12:22 -0700From: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8903110012.AA11141@defun.utah.edu>Date: Fri, 10 Mar 89 17:12:21 MSTSubject: Re: issue IN-PACKAGE-FUNCTIONALITY, version 7To: masinter.paIn-Reply-To: masinter.pa@Xerox.COM, 10 Mar 89 15:49 PSTI won't object if you want to restore SELECT-ONLY.-Sandra-------*start*00641 00024 USaReturn-Path: <sandra%defun@cs.utah.edu>Received: from cs.utah.edu ([128.110.4.21]) by Xerox.COM ; 05 MAR 89 19:18:33 PSTReceived: from defun.utah.edu by cs.utah.edu (5.61/utah-2.1-cs)	id AA04197; Sun, 5 Mar 89 20:18:28 -0700Received: by defun.utah.edu (5.61/utah-2.0-leaf)	id AA06011; Sun, 5 Mar 89 20:18:26 -0700From: sandra%defun@cs.utah.edu (Sandra J Loosemore)Message-Id: <8903060318.AA06011@defun.utah.edu>Date: Sun, 5 Mar 89 20:18:24 MSTSubject: issue IN-PACKAGE-FUNCTIONALITYTo: masinter.paHas anything been happening on this issue (or not happening), that Iought to be aware of?-Sandra-------*start*08332 00024 US GV-Info: X3J13-mailer@SAIL.Stanford.EDU at 15-Mar-89 06:50:58 from AGReturn-Path: <X3J13-mailer@SAIL.Stanford.EDU>Received: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 15 MAR 89 06:50:44 PSTReceived: from Xerox.COM by SAIL.Stanford.EDU with TCP; 15 Mar 89  06:35:51 PSTReceived: from Semillon.ms by ArpaGateway.ms ; 15 MAR 89 06:27:41 PSTDate: 15 Mar 89 06:27 PSTFrom: masinter.paSubject: Issue IN-PACKAGE-FUNCTIONALITY (Version 8)To: X3J13@sail.stanford.edureply-to: cl-cleanup@sail.stanford.eduline-fold: NOMessage-ID: <890315-062741-3597@Xerox>Version 4 of this issue (with only a version ofthe SELECT-ONLY proposal) was discussed and tabledat the last meeting. This version includes two proposals; NEW-MACRO (favored by many members of the cleanup committee)and a new version of SELECT-ONLY.!Issue:          IN-PACKAGE-FUNCTIONALITYReferences:     IN-PACKAGE (p182-183)Category:       CHANGEEdit history:   07-Jul-88, Version 1 by Pitman                 7-Oct-88, Version 2 by Masinter (discussion)                 8-Dec-88, Version 3 by Masinter                12-Dec-88, Version 4 by Masinter                20-Jan-89, Version 5 by Loosemore                30-Jan-89, Version 6 by Loosemore                10-Mar-89, Version 7 by Loosemore                15-Mar-89, Version 8 by Masinter 						(add back SELECT-ONLY)Related-Issues: DEFPACKAGE (passed)		COMPILE-FILE-SYMBOL-HANDLINGProblem Description:  There are two typical uses for IN-PACKAGE -- to define/create a package  and to select a package. The fact that these two purposes have been  given to the same function has led to reduced error checking.  A more general problem is that the "Put In Seven Extremely Randoms"   convention described in CLtL is now recognized by many people as being  unsatisfactory for both package definition and package selection.  The DEFPACKAGE macro provides a much cleaner mechanism for package  definition, but there is still a need for a convenient way to select  a package that has well-defined compilation semantics.Proposal (IN-PACKAGE-FUNCTIONALITY:NEW-MACRO):  Add a new macro:    SELECT-PACKAGE name						[macro]    This macro causes *PACKAGE* to be set to the package named NAME,    which must be a symbol or string.  An error is signalled if the    package does not already exist.  Everything this macro does is also    performed at compile time if the call appears at top-level.  Remove the function IN-PACKAGE from the standard.  Remove the second paragraph of section 11.7 in CLtL.  (This includes  the requirement for special compile-time treatment of the various  package functions.)  Rationale:    This could allow improved error checking and modularity, with only    minimal loss of functionality.    The rationale for proposing SELECT-PACKAGE as a replacement for    IN-PACKAGE, rather than simply changing IN-PACKAGE to have this     behavior, is that such an incompatible change would be confusing to    many people, and would make it more difficult to detect obsolete    usages.  There is nothing in this proposal that would prevent    implementations from continuing to provide IN-PACKAGE as an extension.    Making SELECT-PACKAGE a macro rather than a function means that there    is no need to require COMPILE-FILE to handle it specially.  Since    DEFPACKAGE is also defined to side-effect the compilation environment,    there is no need to require any of the package functions to be treated    specially by the compiler.    The language in section 11.7 of CLtL puts the burden on    implementations of ensuring that all symbols in a file which is    compiled and loaded end up in the same package that they would if the    source file were loaded interpretively.  No implementation can    possibly meet this requirement because, in general, the runtime    behavior of the program cannot be predicted by the compiler.  Current Practice:    Probably no one implements this behavior exactly since it's an     incompatible change to CLtL.  Cost to Implementors:    The SELECT-PACKAGE macro can be implemented trivially by using     EVAL-WHEN in its expansion:    (defmacro select-package (name)        `(eval-when (eval compile load)	     (setq *package*	           (or (find-package ',name)		       (error "Package ~s does not exist." ',name)))))    The changes required to COMPILE-FILE to remove the magic treatment    of the package functions are also likely to be small.  Cost to Users:    In most cases, minor syntactic changes to some files would be    necessary.  Programmers that are now using the "Put In Seven    Extremely Randoms" convention will probably find it straightforward    to convert their code to do a DEFPACKAGE followed by a     SELECT-PACKAGE.  Cost of Non-Adoption:    The specification of COMPILE-FILE will be much more difficult to    understand.    The standard will require compilers to solve the halting problem.  Benefits:    Modular package declarations would be encouraged and errors due    to demand-creation of packages would be easier to detect.    The specification of COMPILE-FILE will be simplified.    There will be a clear statement of the requirements for program    conformance, as relating to usage of packages.  Aesthetics:    The fact that IN-PACKAGE is currently ambiguous about intent (whether    the package should exist already or not) is clearly not aesthetic.    Removing it can't be any worse.    The fact that the currently stated requirements for handling of    the package functions by the compiler are not implementable is    clearly not aesthetic.!Proposal (IN-PACKAGE-FUNCTIONALITY:SELECT-ONLY):  Eliminate the ability of IN-PACKAGE to create a package on demand.  Eliminate the :NICKNAMES and :USE arguments to IN-PACKAGE, since they  are no longer needed.  The results of calling IN-PACKAGE if the package does not already  exist are implementation dependent; implementations "should signal"  an error, or otherwise provide the user with a way to recover from  the situation.   Examples:    #1: (IN-PACKAGE 'NO-SUCH-PACKAGE) 	;would signal an error    #2: (DEFPACKAGE FOO ...options...)	;defines/creates a package        (IN-PACKAGE 'FOO)		;selects an existing package  Rationale:    This could allow improved error checking and modularity, with only    minimal loss of functionality.   Current Practice:    Probably no one implements this behavior since it's in direct    contradiction of both the definitions and numerous examples in CLtL.  Cost to Implementors:    As written, no change to implementations is required, but many will    want to make IN-PACKAGE signal an error.  This change would be    straightforward to implement.  The cost may not be trivial in all    cases, but should not be very large.  Cost to Users:    In most cases, minor syntactic changes to some files would be    necessary.    In some cases, no changes would be necessary since files may    already be doing IN-PACKAGE in situations where the author is    hoping he's made sure the real package declaration is already    loaded.  Cost of Non-Adoption:    Reduced error checking.    Less modular code.  Benefits:    Errors due to demand-creation of a package by IN-PACKAGE without    appropriate uses of the :USE or :NICKNAMES or without appropriate    calls to EXPORT, etc. afterward would be easier to detect.    Modular package declarations would be encouraged.  Aesthetics:    The fact that IN-PACKAGE is currently ambiguous about intent (whether    the package should exist already or not) is clearly not aesthetic.    Some people feel this change would be an aesthetic improvement.    Others feel that an incompatible change to IN-PACKAGE would merely    be confusing.!Discussion:  The dual use of IN-PACKAGE has not been helpful and is confusing.  Some people may find proposal NEW-MACRO more palatable if it merely  deprecated IN-PACKAGE, instead of removing it entirely.  Loosemore and Moon support proposal IN-PACKAGE-FUNCTIONALITY:NEW-MACRO.  Pitman says:    I support NEW-MACRO, though would really prefer you change "remove" to    "deprecate".  Making this an incompatible change is gratuitous.*start*01559 00024 US Date: 25 Mar 89 23:31 PSTFrom: jonl%lucid:COM:XeroxSubject: issue IN-PACKAGE-FUNCTIONALITY, version 7In-Reply-to: masinter.pa@Xerox.COM's message of 10 Mar 89 15:49 PST <890310-155029-16287@Xerox>To: masinter:PA:XeroxGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVFrom: Jon L White <jonl@lucid.com>To: masinter.paIn-Reply-To: masinter.pa@Xerox.COM's message of 10 Mar 89 15:49 PST <890310-155029-16287@Xerox>Subject: issue IN-PACKAGE-FUNCTIONALITY, version 7Return-Path: <jonl@lucid.com>Received: from lucid.com ([192.26.25.1]) by Xerox.COM ; 25 MAR 89 23:31:13 PSTReceived: from bhopal ([192.9.200.13]) by heavens-gate.lucid.com id AA07266g; Sat, 25 Mar 89 23:25:44 PSTReceived: by bhopal id AA08898g; Sat, 25 Mar 89 23:27:56 PSTOriginal-Date: Sat, 25 Mar 89 23:27:56 PSTMessage-Id: <8903260727.AA08898@bhopal>GVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVre: maybe I'm late, but I still liked SELECT-ONLY better than NEW-MACRO. Just    to calibrate, I didn't like removing REQUIRE & PROVIDE, either.If you by chance read this before leaving for Fairfax . . . Well, I agree 100% on both these matters.  In fact, because of an protestfrom some quarters in Lucid's user community, I feel obliged to askfor a reconsideration of the removal vote on REQUIRE & PROVIDE.  Therule ought to be: "If you can't fix it, the bloody well don't breakit."   By admission, the various persons who worked on the issue couldn'tcome to agreement for a "fix"; thus the matter should simply be leftalone.-- JonL --*start*02040 00024 US Date:  4 Apr 89 12:09 PDTSender: CL-Cleanup-mailer%SAIL.Stanford:EDU:XeroxFrom: KMP%STONY-BROOK.SCRC.Symbolics:COM:XeroxSubject: Issue: IN-PACKAGE-FUNCTIONALITYTo: CL-Cleanup%SAIL.Stanford:EDU:XeroxGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVFrom: Kent M Pitman <KMP@STONY-BROOK.SCRC.Symbolics.COM>Subject: Issue: IN-PACKAGE-FUNCTIONALITYTo: CL-Cleanup@SAIL.Stanford.EDUReturn-Path: <CL-Cleanup-mailer@SAIL.Stanford.EDU>Redistributed: xerox-cl-cleanup^.paReceived: from SAIL.Stanford.EDU ([36.86.0.194]) by Xerox.COM ; 04 APR 89 11:51:44 PDTReceived: from STONY-BROOK.SCRC.Symbolics.COM by SAIL.Stanford.EDU with TCP; 4 Apr 89  11:48:54 PDTReceived: from BOBOLINK.SCRC.Symbolics.COM by STONY-BROOK.SCRC.Symbolics.COM via CHAOS with CHAOS-MAIL id 571162; Tue 4-Apr-89 14:48:52 EDTOriginal-Date: Tue, 4 Apr 89 14:48 EDTMessage-ID: <890404144827.5.KMP@BOBOLINK.SCRC.Symbolics.COM>GVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVGVFrom my notes... On Tuesday, we took a straw poll.   0 opposed both proposals.  15 liked NEW-MACRO.   7 liked SELECT-ONLY. ``Keeping IN-PACKAGE makes no difference to compatibility.'' --Moon Pitman moved to amend this to say "deprecate" instead of remove. The motion to amend failed 3-N. The NEW-MACRO proposal passed unamended 12-4. On Thursday, Aaron Larson and JonL asked that the issue be reconsidered. The motion to reconsider passed N-1. There was a motion to rename the SELECT-PACKAGE which we'd voted in to IN-PACKAGE -- so that the compatible syntax (IN-PACKAGE "FOO") would work in CLtL and ANSI CL. Steele requested verbal clarification that we were not trying to solve the ``dusty file'' problem but rather to make it possible to write new code that worked in old and new situations -- it was agreed that this was a correct characterization of the proposal. JonL's amendment passed 13-1. Then the amended proposal was voted in 14-0.The net effect is that NEW-MACRO passed with the name of SELECT-PACKAGEchanged to IN-PACKAGE.